import{_ as t,c as a,o as s,ag as i}from"./chunks/framework.Ds6Eueu6.js";const h=JSON.parse('{"title":"Enabling Segment Mirroring","description":"","frontmatter":{},"headers":[],"relativePath":"docs/7x/admin_guide/ha/enabling-segment-mirroring.md","filePath":"docs/7x/admin_guide/ha/enabling-segment-mirroring.md"}'),r={name:"docs/7x/admin_guide/ha/enabling-segment-mirroring.md"};function o(n,e,d,l,p,m){return s(),a("div",null,e[0]||(e[0]=[i(`<h1 id="enabling-segment-mirroring" tabindex="-1">Enabling Segment Mirroring <a class="header-anchor" href="#enabling-segment-mirroring" aria-label="Permalink to &quot;Enabling Segment Mirroring&quot;">​</a></h1><hr><p>Mirror segments allow database queries to fail over to a backup segment if the primary segment is unavailable. By default, mirrors are configured on the same array of hosts as the primary segments. You may choose a completely different set of hosts for your mirror segments so they do not share machines with any of your primary segments.</p><blockquote><p><strong>Important</strong> During the online data replication process, WarehousePG should be in a quiescent state, workloads and other queries should not be running.</p></blockquote><h2 id="to-add-segment-mirrors-to-an-existing-system-same-hosts-as-primaries" tabindex="-1"><a id="ki169450"></a>To add segment mirrors to an existing system (same hosts as primaries) <a class="header-anchor" href="#to-add-segment-mirrors-to-an-existing-system-same-hosts-as-primaries" aria-label="Permalink to &quot;&lt;a id=&quot;ki169450&quot;&gt;&lt;/a&gt;To add segment mirrors to an existing system \\(same hosts as primaries\\)&quot;">​</a></h2><ol><li><p>Allocate the data storage area for mirror data on all segment hosts. The data storage area must be different from your primary segments&#39; file system location.</p></li><li><p>Use <a href="./../../utility_guide/ref/gpssh-exkeys.html">gpssh-exkeys</a> to ensure that the segment hosts can SSH and remote sync to each other without a password prompt.</p></li><li><p>Run the <a href="./../../utility_guide/ref/gpaddmirrors.html">gpaddmirrors</a> utility to enable mirroring in your WarehousePG cluster. For example, to add 10000 to your primary segment port numbers to calculate the mirror segment port numbers:</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>$ gpaddmirrors -p 10000</span></span></code></pre></div><p>Where <code>-p</code> specifies the number to add to your primary segment port numbers. Mirrors are added with the default group mirroring configuration.</p></li></ol><h2 id="to-add-segment-mirrors-to-an-existing-system-different-hosts-from-primaries" tabindex="-1"><a id="toadd"></a>To add segment mirrors to an existing system (different hosts from primaries) <a class="header-anchor" href="#to-add-segment-mirrors-to-an-existing-system-different-hosts-from-primaries" aria-label="Permalink to &quot;&lt;a id=&quot;toadd&quot;&gt;&lt;/a&gt;To add segment mirrors to an existing system \\(different hosts from primaries\\)&quot;">​</a></h2><ol><li><p>Ensure the WarehousePG software is installed on all hosts. See the <em>WarehousePG Installation Guide</em> for detailed installation instructions.</p></li><li><p>Allocate the data storage area for mirror data, and tablespaces if needed, on all segment hosts.</p></li><li><p>Use <code>gpssh-exkeys</code> to ensure the segment hosts can SSH and remote sync to each other without a password prompt.</p></li><li><p>Create a configuration file that lists the host names, ports, and data directories on which to create mirrors. To create a sample configuration file to use as a starting point, run:</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>$ gpaddmirrors -o &lt;filename&gt;</span></span></code></pre></div><p>The format of the mirror configuration file is:</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>&lt;row_id&gt;=&lt;contentID&gt;|&lt;address&gt;|&lt;port&gt;|&lt;data_dir&gt;</span></span></code></pre></div><p>Where <code>row_id</code> is the row in the file, contentID is the segment instance content ID, address is the host name or IP address of the segment host, port is the communication port, and <code>data_dir</code> is the segment instance data directory.</p><p>For example, this is contents of a mirror configuration file for two segment hosts and two segment instances per host:</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>0=2|sdw1-1|41000|/data/mirror1/gp2</span></span>
<span class="line"><span>1=3|sdw1-2|41001|/data/mirror2/gp3</span></span>
<span class="line"><span>2=0|sdw2-1|41000|/data/mirror1/gp0</span></span>
<span class="line"><span>3=1|sdw2-2|41001|/data/mirror2/gp1</span></span></code></pre></div></li><li><p>Run the <code>gpaddmirrors</code> utility to enable mirroring in your WarehousePG cluster:</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>$ gpaddmirrors -i &lt;mirror_config_file&gt;</span></span></code></pre></div><p>The <code>-i</code> option specifies the mirror configuration file you created.</p></li></ol><p><strong>Parent topic:</strong> <a href="./../ha/enabling-mirroring-in-warehousepg.html">Enabling Mirroring in WarehousePG</a></p>`,9)]))}const c=t(r,[["render",o]]);export{h as __pageData,c as default};

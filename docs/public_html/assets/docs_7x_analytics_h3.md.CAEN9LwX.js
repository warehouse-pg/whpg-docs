import{_ as a,c as n,o as e,ag as t}from"./chunks/framework.Ds6Eueu6.js";const g=JSON.parse('{"title":"Geospatial Indexing with H3 and H3-PG","description":"","frontmatter":{},"headers":[],"relativePath":"docs/7x/analytics/h3.md","filePath":"docs/7x/analytics/h3.md"}'),i={name:"docs/7x/analytics/h3.md"};function p(o,s,l,d,c,h){return e(),n("div",null,s[0]||(s[0]=[t(`<h1 id="geospatial-indexing-with-h3-and-h3-pg" tabindex="-1">Geospatial Indexing with H3 and H3-PG <a class="header-anchor" href="#geospatial-indexing-with-h3-and-h3-pg" aria-label="Permalink to &quot;Geospatial Indexing with H3 and H3-PG&quot;">​</a></h1><hr><p>H3 is a geospatial indexing system using a hexagonal grid that can be (approximately) subdivided into finer and finer hexagonal grids. It includes functions for converting from latitude and longitude coordinates to the containing H3 cell, finding the center of H3 cells, finding the boundary geometry of H3 cells, finding neighbors of H3 cells, and more.</p><p>H3-PG is a PostgreSQL extension that adds bindings for H3 functions and compatibility with PostGIS defined types.</p><p>For information about H3, see <a href="https://h3geo.org/" target="_blank" rel="noreferrer">https://h3geo.org/</a></p><h2 id="warehousepg-h3-pg-extension" tabindex="-1"><a id="topic1"></a>WarehousePG H3-PG Extension <a class="header-anchor" href="#warehousepg-h3-pg-extension" aria-label="Permalink to &quot;&lt;a id=&quot;topic1&quot;&gt;&lt;/a&gt;WarehousePG H3-PG Extension&quot;">​</a></h2><p>The WarehousePG H3-PG extension package is installed with WarehousePG.</p><p>WarehousePG supports the H3 extension with these component versions:</p><ul><li>H3 4.1.3</li><li>PostGIS 3.3.2</li></ul><p>For information about the supported WarehousePG extension packages and software versions, see <a href="./../install_guide/platform-requirements.html#topic_eyc_l2h_zz">Extensions</a>.</p><p>For information about WarehousePG PostGIS feature support, see <a href="./postGIS.html">WarehousePG PostGIS</a>.</p><h2 id="enabling-h3-support" tabindex="-1"><a id="topic2"></a>Enabling H3 Support <a class="header-anchor" href="#enabling-h3-support" aria-label="Permalink to &quot;&lt;a id=&quot;topic2&quot;&gt;&lt;/a&gt;Enabling H3 Support&quot;">​</a></h2><p>To enable H3 support first enable plpython3u support with the <code>CREATE LANGUAGE plpython3u</code> command on your target database. If your database already has this language enabled you can skip this step. Next, use the <code>CREATE EXTENSION h3_postgis CASCADE</code> command on your target database. This command will install the following extensions: <code>postgis</code>, <code>postgis_raster</code>, <code>h3</code>, and <code>h3_postgis</code>.</p><h3 id="removing-h3-support" tabindex="-1"><a id="topic3"></a>Removing H3 Support <a class="header-anchor" href="#removing-h3-support" aria-label="Permalink to &quot;&lt;a id=&quot;topic3&quot;&gt;&lt;/a&gt;Removing H3 Support&quot;">​</a></h3><p>You use the <code>DROP EXTENSION</code> command to remove support for the H3 extension and the extensions that are used with H3.</p><blockquote><p><strong>Caution</strong> Removing H3 support from a database drops H3 database objects from the database without warning. Users accessing H3 objects might interfere with the dropping of H3 objects. Please refer to the following note from PostGIS documentation for a detailed explanation: <a href="./postGIS.html#postgis_note">Notes</a>.</p></blockquote><h4 id="using-the-drop-extension-command" tabindex="-1"><a id="drop_postgis_cmd"></a>Using the DROP EXTENSION Command <a class="header-anchor" href="#using-the-drop-extension-command" aria-label="Permalink to &quot;&lt;a id=&quot;drop_postgis_cmd&quot;&gt;&lt;/a&gt;Using the DROP EXTENSION Command&quot;">​</a></h4><p>Depending on the extensions you enabled for PostGIS, drop support for the extensions in the database.</p><ol><li><p>Use the following commands to drop the H3-PG SQL bindings and H3 library.</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>DROP EXTENSION IF EXISTS h3_postgis;</span></span>
<span class="line"><span>DROP EXTENSION IF EXISTS h3;</span></span></code></pre></div></li><li><p>If you want to drop support for PostGIS and PostGIS raster as well, use the following commands.</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>DROP EXTENSION IF EXISTS postgis_raster;</span></span>
<span class="line"><span>DROP EXTENSION IF EXISTS postgis;</span></span></code></pre></div></li></ol><h2 id="usage" tabindex="-1"><a id="topic7"></a>Usage <a class="header-anchor" href="#usage" aria-label="Permalink to &quot;&lt;a id=&quot;topic7&quot;&gt;&lt;/a&gt;Usage&quot;">​</a></h2><p>Create a table with a geometry column. The <code>INSERT</code> statements add 10 geopoints to the table.</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>DROP TABLE IF EXISTS test_buildings;</span></span>
<span class="line"><span>CREATE TABLE test_buildings (gid INTEGER, type VARCHAR(32), center GEOGRAPHY) DISTRIBUTED BY (gid);</span></span>
<span class="line"><span></span></span>
<span class="line"><span>INSERT INTO test_buildings (gid, type, center)</span></span>
<span class="line"><span>VALUES (1, &#39;&#39;, &#39;POINT(-78.88054167312363 43.03597938296738)&#39;);</span></span>
<span class="line"><span>INSERT INTO test_buildings (gid, type, center)</span></span>
<span class="line"><span>VALUES (2, &#39;&#39;, &#39;POINT(-78.25103469999999 42.987796800000005)&#39;);</span></span>
<span class="line"><span>INSERT INTO test_buildings (gid, type, center)</span></span>
<span class="line"><span>VALUES (3, &#39;&#39;, &#39;POINT(-77.278319 43.056357)&#39;);</span></span>
<span class="line"><span>INSERT INTO test_buildings (gid, type, center)</span></span>
<span class="line"><span>VALUES (4, &#39;&#39;, &#39;POINT(-76.53755992503561 42.486039090444734)&#39;);</span></span>
<span class="line"><span>INSERT INTO test_buildings (gid, type, center)</span></span>
<span class="line"><span>VALUES (5, &#39;&#39;, &#39;POINT(-77.35210400000001 42.745183)&#39;);</span></span>
<span class="line"><span>INSERT INTO test_buildings (gid, type, center)</span></span>
<span class="line"><span>VALUES (6, &#39;&#39;, &#39;POINT(-76.4586205 42.20662450000001)&#39;);</span></span>
<span class="line"><span>INSERT INTO test_buildings (gid, type, center)</span></span>
<span class="line"><span>VALUES (7, &#39;&#39;, &#39;POINT(-73.99734793983018 41.99385572155095)&#39;);</span></span>
<span class="line"><span>INSERT INTO test_buildings (gid, type, center)</span></span>
<span class="line"><span>VALUES (8, &#39;house&#39;, &#39;POINT(-72.97949770000001 40.83532615000001)&#39;);</span></span>
<span class="line"><span>INSERT INTO test_buildings (gid, type, center)</span></span>
<span class="line"><span>VALUES (9, &#39;house&#39;, &#39;POINT(-72.95980417527308 40.8958175447567)&#39;);</span></span>
<span class="line"><span>INSERT INTO test_buildings (gid, type, center)</span></span>
<span class="line"><span>VALUES (10, &#39;house&#39;, &#39;POINT(-72.46734516736213 41.046857297778395)&#39;);</span></span></code></pre></div><p>Find H3 indexes at resolution 7 and redistribute the data.</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>SELECT h3_redistribute_table(&#39;test_buildings&#39;, &#39;h3_test_buildings&#39;, &#39;gid&#39;, &#39;center&#39;, 7, &#39;type&#39;);</span></span></code></pre></div><p>Create a different table with existing H3 indexes.</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>DROP TABLE IF EXISTS h3_test_incidents;</span></span>
<span class="line"><span>CREATE TABLE h3_test_incidents (gid INTEGER, h3_res7 h3index) DISTRIBUTED BY (gid);</span></span>
<span class="line"><span></span></span>
<span class="line"><span>INSERT INTO h3_test_incidents (gid, h3_res7)</span></span>
<span class="line"><span>VALUES (1,&#39;872a1070bffffff&#39;);</span></span>
<span class="line"><span>INSERT INTO h3_test_incidents (gid, h3_res7)</span></span>
<span class="line"><span>VALUES (2,&#39;872a10764ffffff&#39;);</span></span>
<span class="line"><span>INSERT INTO h3_test_incidents (gid, h3_res7)</span></span>
<span class="line"><span>VALUES (3,&#39;872a1072dffffff&#39;);</span></span>
<span class="line"><span>INSERT INTO h3_test_incidents (gid, h3_res7)</span></span>
<span class="line"><span>VALUES (4,&#39;872a10743ffffff&#39;);</span></span>
<span class="line"><span>INSERT INTO h3_test_incidents (gid, h3_res7)</span></span>
<span class="line"><span>VALUES (5,&#39;872a100d9ffffff&#39;);</span></span>
<span class="line"><span>INSERT INTO h3_test_incidents (gid, h3_res7)</span></span>
<span class="line"><span>VALUES (6,&#39;872a1070bffffff&#39;);</span></span>
<span class="line"><span>INSERT INTO h3_test_incidents (gid, h3_res7)</span></span>
<span class="line"><span>VALUES (7,&#39;872a10764ffffff&#39;);</span></span>
<span class="line"><span>INSERT INTO h3_test_incidents (gid, h3_res7)</span></span>
<span class="line"><span>VALUES (8,&#39;872a10740ffffff&#39;);</span></span>
<span class="line"><span>INSERT INTO h3_test_incidents (gid, h3_res7)</span></span>
<span class="line"><span>VALUES (9,&#39;872a10741ffffff&#39;);</span></span>
<span class="line"><span>INSERT INTO h3_test_incidents (gid, h3_res7)</span></span>
<span class="line"><span>VALUES (10,&#39;872a10763ffffff&#39;);</span></span></code></pre></div><p>Find every incident that happened within 50 hexes for each building.</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>DROP TABLE IF EXISTS h3_out_table;</span></span>
<span class="line"><span>SELECT h3_dwithin_batch(&#39;h3_test_buildings&#39;, &#39;h3_test_incidents&#39;, &#39;h3_out_table&#39;, &#39;gid&#39;, &#39;gid&#39;, &#39;__h3_res7&#39;, &#39;h3_res7&#39;, 50);</span></span>
<span class="line"><span>SELECT * FROM h3_out_table ORDER BY 1,2;</span></span></code></pre></div><p>Find the hex distance and approximate real world distance between every building of type &#39;house&#39; and every incident.</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>DROP TABLE IF EXISTS h3_out_table;</span></span>
<span class="line"><span>CREATE VIEW h3_test_buildings_view AS SELECT * FROM h3_test_buildings WHERE type = &#39;house&#39;;</span></span>
<span class="line"><span>SELECT h3_distance_batch(&#39;h3_test_buildings_view&#39;, &#39;h3_test_incidents&#39;, &#39;h3_out_table&#39;, &#39;gid&#39;, &#39;gid&#39;, &#39;__h3_res7&#39;, &#39;h3_res7&#39;);</span></span>
<span class="line"><span>SELECT * FROM h3_out_table ORDER BY 1,2;</span></span></code></pre></div>`,30)]))}const u=a(i,[["render",p]]);export{g as __pageData,u as default};

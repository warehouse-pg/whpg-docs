import{_ as t,c as a,o as s,ag as o}from"./chunks/framework.Ds6Eueu6.js";const p=JSON.parse('{"title":"Checking for Failed Segments","description":"","frontmatter":{},"headers":[],"relativePath":"docs/7x/admin_guide/ha/checking-for-failed-segments.md","filePath":"docs/7x/admin_guide/ha/checking-for-failed-segments.md"}'),i={name:"docs/7x/admin_guide/ha/checking-for-failed-segments.md"};function n(l,e,c,r,g,d){return s(),a("div",null,e[0]||(e[0]=[o(`<h1 id="checking-for-failed-segments" tabindex="-1">Checking for Failed Segments <a class="header-anchor" href="#checking-for-failed-segments" aria-label="Permalink to &quot;Checking for Failed Segments&quot;">​</a></h1><hr><p>With mirroring enabled, you can have failed segment instances in the system without interruption of service or any indication that a failure has occurred. You can verify the status of your system using the <code>gpstate</code> utility, by examing the contents of the <code>gp_segment_configuration</code> catalog table, or by checking log files.</p><h2 id="check-for-failed-segments-using-gpstate" tabindex="-1"><a id="use_gpstate"></a>Check for failed segments using gpstate <a class="header-anchor" href="#check-for-failed-segments-using-gpstate" aria-label="Permalink to &quot;&lt;a id=&quot;use_gpstate&quot;&gt;&lt;/a&gt;Check for failed segments using gpstate&quot;">​</a></h2><p>The <code>gpstate</code> utility provides the status of each individual component of a WarehousePG cluster, including primary segments, mirror segments, coordinator, and standby coordinator.</p><p>On the coordinator host, run the <a href="./../../utility_guide/ref/gpstate.html">gpstate</a> utility with the <code>-e</code> option to show segment instances with error conditions:</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>$ gpstate -e</span></span></code></pre></div><p>If the utility lists <code>Segments with Primary and Mirror Roles Switched</code>, the segment is not in its <em>preferred role</em> (the role to which it was assigned at system initialization). This means the system is in a potentially unbalanced state, as some segment hosts may have more active segments than is optimal for top system performance.</p><p>Segments that display the <code>Config status</code> as <code>Down</code> indicate the corresponding mirror segment is down.</p><p>See <a href="./recovering-from-segment-failures.html">Recovering from Segment Failures</a> for instructions to fix this situation.</p><h2 id="check-for-failed-segments-using-the-gp-segment-configuration-table" tabindex="-1"><a id="select_from_table"></a>Check for failed segments using the gp_segment_configuration table <a class="header-anchor" href="#check-for-failed-segments-using-the-gp-segment-configuration-table" aria-label="Permalink to &quot;&lt;a id=&quot;select_from_table&quot;&gt;&lt;/a&gt;Check for failed segments using the gp\\_segment\\_configuration table&quot;">​</a></h2><p>To get detailed information about failed segments, you can check the <a href="./../../ref_guide/system_catalogs/gp_segment_configuration.html">gp_segment_configuration</a> catalog table. For example:</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>$ psql postgres -c &quot;SELECT * FROM gp_segment_configuration WHERE status=&#39;d&#39;;&quot;</span></span></code></pre></div><p>For failed segment instances, note the host, port, preferred role, and data directory. This information will help determine the host and segment instances to troubleshoot. To display information about mirror segment instances, run:</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>$ gpstate -m</span></span></code></pre></div><h2 id="check-for-failed-segments-by-examining-log-files" tabindex="-1"><a id="check_log_files"></a>Check for failed segments by examining log files <a class="header-anchor" href="#check-for-failed-segments-by-examining-log-files" aria-label="Permalink to &quot;&lt;a id=&quot;check_log_files&quot;&gt;&lt;/a&gt;Check for failed segments by examining log files&quot;">​</a></h2><p>Log files can provide information to help determine an error&#39;s cause. The coordinator and segment instances each have their own log file in <code>log</code> of the data directory. The coordinator log file contains the most information and you should always check it first.</p><p>Use the <a href="./../../utility_guide/ref/gplogfilter.html">gplogfilter</a> utility to check the WarehousePG log files for additional information. To check the segment log files, run <code>gplogfilter</code> on the segment hosts using <a href="./../../utility_guide/ref/gpssh.html">gpssh</a>.</p><h2 id="to-check-the-log-files" tabindex="-1"><a id="ki170080"></a>To check the log files <a class="header-anchor" href="#to-check-the-log-files" aria-label="Permalink to &quot;&lt;a id=&quot;ki170080&quot;&gt;&lt;/a&gt;To check the log files&quot;">​</a></h2><ol><li><p>Use <code>gplogfilter</code> to check the coordinator log file for <code>WARNING</code>, <code>ERROR</code>, <code>FATAL</code> or <code>PANIC</code> log level messages:</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>$ gplogfilter -t</span></span></code></pre></div></li><li><p>Use <code>gpssh</code> to check for <code>WARNING</code>, <code>ERROR</code>, <code>FATAL</code>, or <code>PANIC</code> log level messages on each segment instance. For example:</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>$ gpssh -f seg_hosts_file -e &#39;source </span></span>
<span class="line"><span>/usr/local/greenplum-db/greenplum_path.sh ; gplogfilter -t </span></span>
<span class="line"><span>/data1/primary/*/log/gpdb*.log&#39; &gt; seglog.out</span></span></code></pre></div></li></ol><p><strong>Parent topic:</strong> <a href="./../ha/detecting-a-failed-segment.html">How WarehousePG Detects a Failed Segment</a></p>`,21)]))}const m=t(i,[["render",n]]);export{p as __pageData,m as default};

import{_ as e,c as s,o as t,ag as n}from"./chunks/framework.Ds6Eueu6.js";const u=JSON.parse('{"title":"PL/R Language","description":"","frontmatter":{},"headers":[],"relativePath":"docs/7x/analytics/pl_r.md","filePath":"docs/7x/analytics/pl_r.md"}'),o={name:"docs/7x/analytics/pl_r.md"};function i(l,a,p,r,c,d){return t(),s("div",null,a[0]||(a[0]=[n(`<h1 id="pl-r-language" tabindex="-1">PL/R Language <a class="header-anchor" href="#pl-r-language" aria-label="Permalink to &quot;PL/R Language&quot;">​</a></h1><hr><p>This chapter contains the following information:</p><ul><li><a href="#topic2">About WarehousePG PL/R</a></li><li><a href="#topic_irz_m3l_v3b">Installing R</a></li><li><a href="#topic3">Installing PL/R</a></li><li><a href="#topic6">Uninstalling PL/R</a></li><li><a href="#topic5">Enabling PL/R Language Support</a></li><li><a href="#topic9">Examples</a></li><li><a href="#topic13">Downloading and Installing R Packages</a></li><li><a href="#topic14">Displaying R Library Information</a></li><li><a href="#topic_g12_gwt_3gb">Loading R Modules at Startup</a></li><li><a href="#topic15">References</a></li></ul><h2 id="about-warehousepg-pl-r" tabindex="-1"><a id="topic2"></a>About WarehousePG PL/R <a class="header-anchor" href="#about-warehousepg-pl-r" aria-label="Permalink to &quot;&lt;a id=&quot;topic2&quot;&gt;&lt;/a&gt;About WarehousePG PL/R&quot;">​</a></h2><p>PL/R is a procedural language. With the WarehousePG PL/R extension you can write database functions in the R programming language and use R packages that contain R functions and data sets.</p><p>For information about supported PL/R versions, see the <em>WarehousePG Release Notes</em>.</p><h3 id="installing-r" tabindex="-1"><a id="topic_irz_m3l_v3b"></a>Installing R <a class="header-anchor" href="#installing-r" aria-label="Permalink to &quot;&lt;a id=&quot;topic_irz_m3l_v3b&quot;&gt;&lt;/a&gt;Installing R&quot;">​</a></h3><p>For RHEL/Oracle/Rocky, installing the PL/R package installs R in <code>$GPHOME/ext/R-&lt;version&gt;</code> and updates <code>$GPHOME/greenplum_path.sh</code> for WarehousePG to use R.</p><blockquote><p><strong>Note</strong> You can use the <a href="./../utility_guide/ref/gpssh.html">gpssh</a> utility to run bash shell commands on multiple remote hosts.</p></blockquote><ol><li><p>To install R, run these <code>apt</code> commands on all host systems.</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>$ sudo apt update &amp;&amp; sudo apt install r-base</span></span></code></pre></div><p>Installing <code>r-base</code> also installs dependent packages including <code>r-base-core</code>.</p></li><li><p>To configure WarehousePG to use R, add the <code>R_HOME</code> environment variable to <code>$GPHOME/greenplum_path.sh</code> on all hosts. This example command returns the R home directory.</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>$ R RHOME</span></span>
<span class="line"><span>/usr/lib/R</span></span></code></pre></div><p>Using the previous R home directory as an example, add this line to the file on all hosts.</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>export R_HOME=/usr/lib/R</span></span></code></pre></div></li><li><p>Source <code>$GPHOME/greenplum_path.sh</code> and restart WarehousePG. For example, run these commands on the WarehousePG coordinator host.</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>$ source $GPHOME/greenplum_path.sh</span></span>
<span class="line"><span>$ gpstop -r</span></span></code></pre></div></li></ol><h3 id="installing-pl-r" tabindex="-1"><a id="topic3"></a>Installing PL/R <a class="header-anchor" href="#installing-pl-r" aria-label="Permalink to &quot;&lt;a id=&quot;topic3&quot;&gt;&lt;/a&gt;Installing PL/R&quot;">​</a></h3><p>The PL/R extension is available as a package.</p><h4 id="installing-the-extension-package" tabindex="-1"><a id="topic4"></a>Installing the Extension Package <a class="header-anchor" href="#installing-the-extension-package" aria-label="Permalink to &quot;&lt;a id=&quot;topic4&quot;&gt;&lt;/a&gt;Installing the Extension Package&quot;">​</a></h4><p>Before you install the PL/R extension, make sure that your WarehousePG is running, you have sourced <code>greenplum_path.sh</code>, and that the <code>$COORDINATOR_DATA_DIRECTORY</code> and <code>$GPHOME</code> variables are set.</p><ol><li><p>Download the PL/R extension package.</p></li><li><p>Follow the instructions in <a href="./../install_guide/verify_sw.html">Verifying the WarehousePG Software Download</a> to verify the integrity of the <strong>WarehousePG Procedural Languages PL/R</strong> software.</p></li><li><p>Copy the PL/R package to the WarehousePG coordinator host.</p></li><li><p>Install the software extension package</p></li><li><p>Source the file <code>$GPHOME/greenplum_path.sh</code>.</p></li><li><p>Restart WarehousePG.</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>$ gpstop -r</span></span></code></pre></div></li></ol><h3 id="enabling-pl-r-language-support" tabindex="-1"><a id="topic5"></a>Enabling PL/R Language Support <a class="header-anchor" href="#enabling-pl-r-language-support" aria-label="Permalink to &quot;&lt;a id=&quot;topic5&quot;&gt;&lt;/a&gt;Enabling PL/R Language Support&quot;">​</a></h3><p>For each database that requires its use, register the PL/R language with the SQL command <code>CREATE EXTENSION</code>. Because PL/R is an untrusted language, only superusers can register PL/R with a database. For example, run this command as the <code>gpadmin</code> user to register the language with the database named <code>testdb</code>:</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>$ psql -d testdb -c &#39;CREATE EXTENSION plr;&#39;</span></span></code></pre></div><p>PL/R is registered as an untrusted language.</p><h3 id="uninstalling-pl-r" tabindex="-1"><a id="topic6"></a>Uninstalling PL/R <a class="header-anchor" href="#uninstalling-pl-r" aria-label="Permalink to &quot;&lt;a id=&quot;topic6&quot;&gt;&lt;/a&gt;Uninstalling PL/R&quot;">​</a></h3><ul><li><a href="#topic7">Remove PL/R Support for a Database</a></li><li><a href="#topic8">Uninstall the Extension Package</a></li><li><a href="#topic_ifv_tsf_w3b">Uninstall R (Ubuntu)</a></li></ul><p>When you remove PL/R language support from a database, the PL/R routines that you created in the database will no longer work.</p><h4 id="remove-pl-r-support-for-a-database" tabindex="-1"><a id="topic7"></a>Remove PL/R Support for a Database <a class="header-anchor" href="#remove-pl-r-support-for-a-database" aria-label="Permalink to &quot;&lt;a id=&quot;topic7&quot;&gt;&lt;/a&gt;Remove PL/R Support for a Database&quot;">​</a></h4><p>For a database that no longer requires the PL/R language, remove support for PL/R with the SQL command <code>DROP EXTENSION</code>. Because PL/R is an untrusted language, only superusers can remove support for the PL/R language from a database. For example, run this command as the <code>gpadmin</code> user to remove support for PL/R from the database named <code>testdb</code>:</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>$ psql -d testdb -c &#39;DROP EXTENSION plr;&#39;</span></span></code></pre></div><p>The default command fails if any existing objects (such as functions) depend on the language. Specify the <code>CASCADE</code> option to also drop all dependent objects, including functions that you created with PL/R.</p><h4 id="uninstall-the-extension-package" tabindex="-1"><a id="topic8"></a>Uninstall the Extension Package <a class="header-anchor" href="#uninstall-the-extension-package" aria-label="Permalink to &quot;&lt;a id=&quot;topic8&quot;&gt;&lt;/a&gt;Uninstall the Extension Package&quot;">​</a></h4><p>If no databases have PL/R as a registered language, uninstall the WarehousePG PL/R extension with the <code>gppkg</code> utility. This example uninstalls PL/R package version 3.1.0.</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>$ gppkg remove plr-3.1.0</span></span></code></pre></div><p>On RHEL/Oracle/Rocky systems, uninstalling the extension uninstalls the R software that was installed with the extension.</p><p>You can run the <code>gppkg</code> utility with the <code>query</code> option to list the installed extensions and their versions.</p><h4 id="uninstall-r-ubuntu" tabindex="-1"><a id="topic_ifv_tsf_w3b"></a>Uninstall R (Ubuntu) <a class="header-anchor" href="#uninstall-r-ubuntu" aria-label="Permalink to &quot;&lt;a id=&quot;topic_ifv_tsf_w3b&quot;&gt;&lt;/a&gt;Uninstall R \\(Ubuntu\\)&quot;">​</a></h4><p>For Ubuntu systems, remove R from all WarehousePG host systems. These commands remove R from an Ubuntu system.</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>$ sudo apt remove r-base</span></span>
<span class="line"><span>$ sudo apt remove r-base-core</span></span></code></pre></div><p>Removing <code>r-base</code> does not uninstall the R executable. Removing <code>r-base-core</code> uninstalls the R executable.</p><h3 id="examples" tabindex="-1"><a id="topic9"></a>Examples <a class="header-anchor" href="#examples" aria-label="Permalink to &quot;&lt;a id=&quot;topic9&quot;&gt;&lt;/a&gt;Examples&quot;">​</a></h3><p>The following are simple PL/R examples.</p><h4 id="example-1-using-pl-r-for-single-row-operators" tabindex="-1"><a id="topic10"></a>Example 1: Using PL/R for single row operators <a class="header-anchor" href="#example-1-using-pl-r-for-single-row-operators" aria-label="Permalink to &quot;&lt;a id=&quot;topic10&quot;&gt;&lt;/a&gt;Example 1: Using PL/R for single row operators&quot;">​</a></h4><p>This function generates an array of numbers with a normal distribution using the R function <code>rnorm()</code>.</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>CREATE OR REPLACE FUNCTION r_norm(n integer, mean float8,</span></span>
<span class="line"><span>  std_dev float8) RETURNS float8[ ] AS</span></span>
<span class="line"><span>$$</span></span>
<span class="line"><span>  x&lt;-rnorm(n,mean,std_dev)</span></span>
<span class="line"><span>  return(x)</span></span>
<span class="line"><span>$$</span></span>
<span class="line"><span>LANGUAGE &#39;plr&#39;;</span></span></code></pre></div><p>The following <code>CREATE TABLE</code> command uses the <code>r_norm()</code> function to populate the table. The <code>r_norm()</code> function creates an array of 10 numbers.</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>CREATE TABLE test_norm_var</span></span>
<span class="line"><span>  AS SELECT id, r_norm(10,0,1) as x</span></span>
<span class="line"><span>  FROM (SELECT generate_series(1,30:: bigint) AS ID) foo</span></span>
<span class="line"><span>  DISTRIBUTED BY (id);</span></span></code></pre></div><h4 id="example-2-returning-pl-r-data-frames-in-tabular-form" tabindex="-1"><a id="topic11"></a>Example 2: Returning PL/R data.frames in Tabular Form <a class="header-anchor" href="#example-2-returning-pl-r-data-frames-in-tabular-form" aria-label="Permalink to &quot;&lt;a id=&quot;topic11&quot;&gt;&lt;/a&gt;Example 2: Returning PL/R data.frames in Tabular Form&quot;">​</a></h4><p>Assuming your PL/R function returns an R <code>data.frame</code> as its output, unless you want to use arrays of arrays, some work is required to see your <code>data.frame</code> from PL/R as a simple SQL table:</p><ul><li><p>Create a <code>TYPE</code> in a WarehousePG with the same dimensions as your R <code>data.frame:</code></p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>CREATE TYPE t1 AS ...</span></span></code></pre></div></li><li><p>Use this <code>TYPE</code> when defining your PL/R function</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>... RETURNS SET OF t1 AS ...</span></span></code></pre></div></li></ul><p>Sample SQL for this is given in the next example.</p><h4 id="example-3-hierarchical-regression-using-pl-r" tabindex="-1"><a id="topic12"></a>Example 3: Hierarchical Regression using PL/R <a class="header-anchor" href="#example-3-hierarchical-regression-using-pl-r" aria-label="Permalink to &quot;&lt;a id=&quot;topic12&quot;&gt;&lt;/a&gt;Example 3: Hierarchical Regression using PL/R&quot;">​</a></h4><p>The SQL below defines a <code>TYPE</code> and runs hierarchical regression using PL/R:</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>--Create TYPE to store model results</span></span>
<span class="line"><span>DROP TYPE IF EXISTS wj_model_results CASCADE;</span></span>
<span class="line"><span>CREATE TYPE wj_model_results AS (</span></span>
<span class="line"><span>  cs text, coefext float, ci_95_lower float, ci_95_upper float,</span></span>
<span class="line"><span>  ci_90_lower float, ci_90_upper float, ci_80_lower float,</span></span>
<span class="line"><span>  ci_80_upper float);</span></span>
<span class="line"><span></span></span>
<span class="line"><span>--Create PL/R function to run model in R</span></span>
<span class="line"><span>DROP FUNCTION IF EXISTS wj_plr_RE(float [ ], text [ ]);</span></span>
<span class="line"><span>CREATE FUNCTION wj_plr_RE(response float [ ], cs text [ ])</span></span>
<span class="line"><span>RETURNS SETOF wj_model_results AS</span></span>
<span class="line"><span>$$</span></span>
<span class="line"><span>  library(arm)</span></span>
<span class="line"><span>  y&lt;- log(response)</span></span>
<span class="line"><span>  cs&lt;- cs</span></span>
<span class="line"><span>  d_temp&lt;- data.frame(y,cs)</span></span>
<span class="line"><span>  m0 &lt;- lmer (y ~ 1 + (1 | cs), data=d_temp)</span></span>
<span class="line"><span>  cs_unique&lt;- sort(unique(cs))</span></span>
<span class="line"><span>  n_cs_unique&lt;- length(cs_unique)</span></span>
<span class="line"><span>  temp_m0&lt;- data.frame(matrix0,n_cs_unique, 7))</span></span>
<span class="line"><span>  for (i in 1:n_cs_unique){temp_m0[i,]&lt;-</span></span>
<span class="line"><span>    c(exp(coef(m0)$cs[i,1] + c(0,-1.96,1.96,-1.65,1.65,</span></span>
<span class="line"><span>      -1.28,1.28)*se.ranef(m0)$cs[i]))}</span></span>
<span class="line"><span>  names(temp_m0)&lt;- c(&quot;Coefest&quot;, &quot;CI_95_Lower&quot;,</span></span>
<span class="line"><span>    &quot;CI_95_Upper&quot;, &quot;CI_90_Lower&quot;, &quot;CI_90_Upper&quot;,</span></span>
<span class="line"><span>   &quot;CI_80_Lower&quot;, &quot;CI_80_Upper&quot;)</span></span>
<span class="line"><span>  temp_m0_v2&lt;- data.frames(cs_unique, temp_m0)</span></span>
<span class="line"><span>  return(temp_m0_v2)</span></span>
<span class="line"><span>$$</span></span>
<span class="line"><span>LANGUAGE &#39;plr&#39;;</span></span>
<span class="line"><span></span></span>
<span class="line"><span>--Run modeling plr function and store model results in a</span></span>
<span class="line"><span>--table</span></span>
<span class="line"><span>DROP TABLE IF EXISTS wj_model_results_roi;</span></span>
<span class="line"><span>CREATE TABLE wj_model_results_roi AS SELECT *</span></span>
<span class="line"><span>  FROM wj_plr_RE(&#39;{1,1,1}&#39;, &#39;{&quot;a&quot;, &quot;b&quot;, &quot;c&quot;}&#39;);</span></span></code></pre></div><h3 id="downloading-and-installing-r-packages" tabindex="-1"><a id="topic13"></a>Downloading and Installing R Packages <a class="header-anchor" href="#downloading-and-installing-r-packages" aria-label="Permalink to &quot;&lt;a id=&quot;topic13&quot;&gt;&lt;/a&gt;Downloading and Installing R Packages&quot;">​</a></h3><p>R packages are modules that contain R functions and data sets. You can install R packages to extend R and PL/R functionality in WarehousePG.</p><p>WarehousePG provides a collection of data science-related R libraries that can be used with the WarehousePG PL/R language. For information about the libraries, see <a href="./../install_guide/install_r_dslib.html#topic1">R Data Science Library Package</a>.</p><blockquote><p><strong>Note</strong> If you expand WarehousePG and add segment hosts, you must install the R packages in the R installation of the new hosts.</p></blockquote><ol><li><p>For an R package, identify all dependent R packages and each package web URL. The information can be found by selecting the given package from the following navigation page:</p><p><a href="https://cran.r-project.org/web/packages/available_packages_by_name.html" target="_blank" rel="noreferrer">https://cran.r-project.org/web/packages/available_packages_by_name.html</a></p><p>As an example, the page for the R package arm indicates that the package requires the following R libraries: Matrix, lattice, lme4, R2WinBUGS, coda, abind, foreign, and MASS.</p><p>You can also try installing the package with <code>R CMD INSTALL</code> command to determine the dependent packages.</p><p>For the R installation included with the WarehousePG PL/R extension, the required R packages are installed with the PL/R extension. However, the Matrix package requires a newer version.</p></li><li><p>From the command line, use the <code>wget</code> utility to download the <code>tar.gz</code> files for the arm package to the WarehousePG coordinator host:</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>wget https://cran.r-project.org/src/contrib/Archive/arm/arm_1.5-03.tar.gz</span></span></code></pre></div><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>wget https://cran.r-project.org/src/contrib/Archive/Matrix/Matrix_0.9996875-1.tar.gz</span></span></code></pre></div></li><li><p>Use the <a href="./../utility_guide/ref/gpsync.html">gpsync</a> utility and the <code>hosts_all</code> file to copy the <code>tar.gz</code> files to the same directory on all nodes of the WarehousePG cluster. The <code>hosts_all</code> file contains a list of all the WarehousePG segment hosts. You might require root access to do this.</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>gpsync -f hosts_all Matrix_0.9996875-1.tar.gz =:/home/gpadmin</span></span></code></pre></div><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>gpsync -f /hosts_all arm_1.5-03.tar.gz =:/home/gpadmin</span></span></code></pre></div></li><li><p>Use the <code>gpssh</code> utility in interactive mode to log into each WarehousePG segment host (<code>gpssh -f all_hosts</code>). Install the packages from the command prompt using the <code>R CMD INSTALL</code> command. Note that this may require root access. For example, this R install command installs the packages for the arm package.</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>$R_HOME/bin/R CMD INSTALL Matrix_0.9996875-1.tar.gz   arm_1.5-03.tar.gz</span></span></code></pre></div></li><li><p>Ensure that the package is installed in the <code>$R_HOME/library</code> directory on all the segments (the <code>gpssh</code> can be used to install the package). For example, this <code>gpssh</code> command list the contents of the R library directory.</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>gpssh -s -f all_hosts &quot;ls $R_HOME/library&quot;</span></span></code></pre></div><p>The <code>gpssh</code> option <code>-s</code> sources the <code>greenplum_path.sh</code> file before running commands on the remote hosts.</p></li><li><p>Test if the R package can be loaded.</p><p>This function performs a simple test to determine if an R package can be loaded:</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>CREATE OR REPLACE FUNCTION R_test_require(fname text)</span></span>
<span class="line"><span>RETURNS boolean AS</span></span>
<span class="line"><span>$BODY$</span></span>
<span class="line"><span>    return(require(fname,character.only=T))</span></span>
<span class="line"><span>$BODY$</span></span>
<span class="line"><span>LANGUAGE &#39;plr&#39;;</span></span></code></pre></div><p>This SQL command checks if the R package arm can be loaded:</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>SELECT R_test_require(&#39;arm&#39;);</span></span></code></pre></div></li></ol><h3 id="displaying-r-library-information" tabindex="-1"><a id="topic14"></a>Displaying R Library Information <a class="header-anchor" href="#displaying-r-library-information" aria-label="Permalink to &quot;&lt;a id=&quot;topic14&quot;&gt;&lt;/a&gt;Displaying R Library Information&quot;">​</a></h3><p>You can use the R command line to display information about the installed libraries and functions on the WarehousePG host. You can also add and remove libraries from the R installation. To start the R command line on the host, log into the host as the <code>gadmin</code> user and run the script R from the directory <code>$GPHOME/ext/R-3.3.3/bin</code>.</p><p>This R function lists the available R packages from the R command line:</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>&gt; library()</span></span></code></pre></div><p>Display the documentation for a particular R package</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>&gt; library(help=&quot;&lt;package_name&gt;&quot;)</span></span>
<span class="line"><span>&gt; help(package=&quot;&lt;package_name&gt;&quot;)</span></span></code></pre></div><p>Display the help file for an R function:</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>&gt; help(&quot;&lt;function_name&gt;&quot;)</span></span>
<span class="line"><span>&gt; ?&lt;function_name&gt;</span></span></code></pre></div><p>To see what packages are installed, use the R command <code>installed.packages()</code>. This will return a matrix with a row for each package that has been installed. Below, we look at the first 5 rows of this matrix.</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>&gt; installed.packages()</span></span></code></pre></div><p>Any package that does not appear in the installed packages matrix must be installed and loaded before its functions can be used.</p><p>An R package can be installed with <code>install.packages()</code>:</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>&gt; install.packages(&quot;&lt;package_name&gt;&quot;)</span></span>
<span class="line"><span>&gt; install.packages(&quot;mypkg&quot;, dependencies = TRUE, type=&quot;source&quot;)</span></span></code></pre></div><p>Load a package from the R command line.</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>&gt; library(&quot; &lt;package_name&gt; &quot;)</span></span></code></pre></div><p>An R package can be removed with <code>remove.packages</code></p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>&gt; remove.packages(&quot;&lt;package_name&gt;&quot;)</span></span></code></pre></div><p>You can use the R command <code>-e</code> option to run functions from the command line. For example, this command displays help on the R package MASS.</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>$ R -e &#39;help(&quot;MASS&quot;)&#39;</span></span></code></pre></div><h3 id="loading-r-modules-at-startup" tabindex="-1"><a id="topic_g12_gwt_3gb"></a>Loading R Modules at Startup <a class="header-anchor" href="#loading-r-modules-at-startup" aria-label="Permalink to &quot;&lt;a id=&quot;topic_g12_gwt_3gb&quot;&gt;&lt;/a&gt;Loading R Modules at Startup&quot;">​</a></h3><p>PL/R can automatically load saved R code during interpreter initialization. To use this feature, you create the <code>plr_modules</code> database table and then insert the R modules you want to auto-load into the table. If the table exists, PL/R will load the code it contains into the interpreter.</p><p>In a WarehousePG cluster, table rows are usually distributed so that each row exists at only one segment instance. The R interpreter at each segment instance, however, needs to load all of the modules, so a normally distributed table will not work. You must create the <code>plr_modules</code> table as a <em>replicated table</em> in the default schema so that all rows in the table are present at every segment instance. For example:</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>CREATE TABLE public.plr_modules {</span></span>
<span class="line"><span>  modseq int4,</span></span>
<span class="line"><span>  modsrc text</span></span>
<span class="line"><span>) DISTRIBUTED REPLICATED;</span></span></code></pre></div><p>See <a href="https://www.joeconway.com/plr/doc/plr-module-funcs.html" target="_blank" rel="noreferrer">https://www.joeconway.com/plr/doc/plr-module-funcs.html</a> for more information about using the PL/R auto-load feature.</p><h3 id="references" tabindex="-1"><a id="topic15"></a>References <a class="header-anchor" href="#references" aria-label="Permalink to &quot;&lt;a id=&quot;topic15&quot;&gt;&lt;/a&gt;References&quot;">​</a></h3><p><a href="https://www.r-project.org/" target="_blank" rel="noreferrer">https://www.r-project.org/</a> - The R Project home page.</p><p><a href="https://cran.r-project.org/web/packages/PivotalR/" target="_blank" rel="noreferrer">https://cran.r-project.org/web/packages/PivotalR/</a> - The home page for PivotalR, a package that provides an R interface to operate on WarehousePG tables and views that is similar to the R data.frame. PivotalR also supports using the machine learning package <a href="https://madlib.apache.org/" target="_blank" rel="noreferrer">MADlib</a> directly from R.</p><p>The following links highlight key topics from the <a href="https://www.joeconway.com/doc/doc.html" target="_blank" rel="noreferrer">R documentation</a>.</p><ul><li>R Functions and Arguments - <a href="https://www.joeconway.com/doc/plr-funcs.html" target="_blank" rel="noreferrer">https://www.joeconway.com/doc/plr-funcs.html</a></li><li>Passing Data Values in R - <a href="https://www.joeconway.com/doc/plr-data.html" target="_blank" rel="noreferrer">https://www.joeconway.com/doc/plr-data.html</a></li><li>Aggregate Functions in R - <a href="https://www.joeconway.com/doc/plr-aggregate-funcs.html" target="_blank" rel="noreferrer">https://www.joeconway.com/doc/plr-aggregate-funcs.html</a></li></ul>`,84)]))}const g=e(o,[["render",i]]);export{u as __pageData,g as default};

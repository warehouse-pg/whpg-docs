import{_ as a,c as t,o as n,ag as o}from"./chunks/framework.Ds6Eueu6.js";const p=JSON.parse('{"title":"Creating and Using Sequences","description":"","frontmatter":{},"headers":[],"relativePath":"docs/7x/admin_guide/ddl/ddl-sequence.md","filePath":"docs/7x/admin_guide/ddl/ddl-sequence.md"}'),s={name:"docs/7x/admin_guide/ddl/ddl-sequence.md"};function c(i,e,d,l,u,r){return n(),t("div",null,e[0]||(e[0]=[o('<h1 id="creating-and-using-sequences" tabindex="-1">Creating and Using Sequences <a class="header-anchor" href="#creating-and-using-sequences" aria-label="Permalink to &quot;Creating and Using Sequences&quot;">​</a></h1><hr><p>A WarehousePG sequence object is a special single row table that functions as a number generator. You can use a sequence to generate unique integer identifiers for a row that you add to a table. Declaring a column of type <code>SERIAL</code> implicitly creates a sequence counter for use in that table column.</p><p>WarehousePG provides commands to create, alter, and drop a sequence. WarehousePG also provides built-in functions to return the next value in the sequence (<code>nextval()</code>) or to set the sequence to a specific start value (<code>setval()</code>).</p><blockquote><p><strong>Note</strong> The PostgreSQL <code>currval()</code> and <code>lastval()</code> sequence functions are not supported in WarehousePG.</p></blockquote><p>Attributes of a sequence object include the name of the sequence, its increment value, and the last, minimum, and maximum values of the sequence counter. Sequences also have a special boolean attribute named <code>is_called</code> that governs the auto-increment behavior of a <code>nextval()</code> operation on the sequence counter. When a sequence&#39;s <code>is_called</code> attribute is <code>true</code>, <code>nextval()</code> increments the sequence counter before returning the value. When the <code>is_called</code> attribute value of a sequence is <code>false</code>, <code>nextval()</code> does not increment the counter before returning the value.</p><p><strong>Parent topic:</strong> <a href="./../ddl/ddl.html">DDL: Defining Database Objects</a></p><h2 id="creating-a-sequence" tabindex="-1"><a id="topic87"></a>Creating a Sequence <a class="header-anchor" href="#creating-a-sequence" aria-label="Permalink to &quot;&lt;a id=&quot;topic87&quot;&gt;&lt;/a&gt;Creating a Sequence&quot;">​</a></h2><p>The <a href="./../../ref_guide/sql_commands/CREATE_SEQUENCE.html">CREATE SEQUENCE</a> command creates and initializes a sequence with the given sequence name and optional start value. The sequence name must be distinct from the name of any other sequence, table, index, or view in the same schema. For example:</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>CREATE SEQUENCE myserial START 101;</span></span></code></pre></div><p>When you create a new sequence, WarehousePG sets the sequence <code>is_called</code> attribute to <code>false</code>. Invoking <code>nextval()</code> on a newly-created sequence does not increment the sequence counter, but returns the sequence start value and sets <code>is_called</code> to <code>true</code>.</p><h2 id="using-a-sequence" tabindex="-1"><a id="topic88"></a>Using a Sequence <a class="header-anchor" href="#using-a-sequence" aria-label="Permalink to &quot;&lt;a id=&quot;topic88&quot;&gt;&lt;/a&gt;Using a Sequence&quot;">​</a></h2><p>After you create a sequence with the <code>CREATE SEQUENCE</code> command, you can examine the sequence and use the sequence built-in functions.</p><h3 id="examining-sequence-attributes" tabindex="-1"><a id="exseq"></a>Examining Sequence Attributes <a class="header-anchor" href="#examining-sequence-attributes" aria-label="Permalink to &quot;&lt;a id=&quot;exseq&quot;&gt;&lt;/a&gt;Examining Sequence Attributes&quot;">​</a></h3><p>To examine the current attributes of a sequence, query the sequence directly. For example, to examine a sequence named <code>myserial</code>:</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>SELECT * FROM myserial;</span></span></code></pre></div><h3 id="returning-the-next-sequence-counter-value" tabindex="-1"><a id="retnex"></a>Returning the Next Sequence Counter Value <a class="header-anchor" href="#returning-the-next-sequence-counter-value" aria-label="Permalink to &quot;&lt;a id=&quot;retnex&quot;&gt;&lt;/a&gt;Returning the Next Sequence Counter Value&quot;">​</a></h3><p>You can invoke the <code>nextval()</code> built-in function to return and use the next value in a sequence. The following command inserts the next value of the sequence named <code>myserial</code> into the first column of a table named <code>vendors</code>:</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>INSERT INTO vendors VALUES (nextval(&#39;myserial&#39;), &#39;acme&#39;);</span></span></code></pre></div><p><code>nextval()</code> uses the sequence&#39;s <code>is_called</code> attribute value to determine whether or not to increment the sequence counter before returning the value. <code>nextval()</code> advances the counter when <code>is_called</code> is <code>true</code>. <code>nextval()</code> sets the sequence <code>is_called</code> attribute to <code>true</code> before returning.</p><p>A <code>nextval()</code> operation is never rolled back. A fetched value is considered used, even if the transaction that performed the <code>nextval()</code> fails. This means that failed transactions can leave unused holes in the sequence of assigned values.</p><blockquote><p><strong>Note</strong> You cannot use the <code>nextval()</code> function in <code>UPDATE</code> or <code>DELETE</code> statements if mirroring is enabled in WarehousePG.</p></blockquote><h3 id="setting-the-sequence-counter-value" tabindex="-1"><a id="setseq"></a>Setting the Sequence Counter Value <a class="header-anchor" href="#setting-the-sequence-counter-value" aria-label="Permalink to &quot;&lt;a id=&quot;setseq&quot;&gt;&lt;/a&gt;Setting the Sequence Counter Value&quot;">​</a></h3><p>You can use the WarehousePG <code>setval()</code> built-in function to set the counter value for a sequence. For example, the following command sets the counter value of the sequence named <code>myserial</code> to <code>201</code>:</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>SELECT setval(&#39;myserial&#39;, 201);</span></span></code></pre></div><p><code>setval()</code> has two function signatures: <code>setval(sequence, start_val)</code> and <code>setval(sequence, start_val, is_called)</code>. The default behaviour of <code>setval(sequence, start_val)</code> sets the sequence <code>is_called</code> attribute value to <code>true</code>.</p><p>If you do not want the sequence counter advanced on the next <code>nextval()</code> call, use the <code>setval(sequence, start_val, is_called)</code> function signature, passing a <code>false</code> argument:</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>SELECT setval(&#39;myserial&#39;, 201, false);</span></span></code></pre></div><p><code>setval()</code> operations are never rolled back.</p><h3 id="nextval-and-setval-caution" tabindex="-1"><a id="notes"></a> nextval() and setval() Caution <a class="header-anchor" href="#nextval-and-setval-caution" aria-label="Permalink to &quot;&lt;a id=&quot;notes&quot;&gt;&lt;/a&gt; nextval() and setval() Caution&quot;">​</a></h3><p>To avoid blocking concurrent transactions that obtain numbers from the same sequence, the value obtained by <code>nextval()</code> is not reclaimed for re-use if the calling transaction later aborts. As such, transaction aborts or database crashes can result in gaps in the sequence of assigned values. This situation can occur without a transaction abort, also. For example, an <code>INSERT</code> with an <code>ON CONFLICT</code> clause will compute the to-be-inserted tuple, including invoking any required <code>nextval()</code> calls, before detecting any conflict that would cause it to follow the <code>ON CONFLICT</code> rule instead. Consequently, you cannot use WarehousePG sequence objects to obtain &quot;gapless&quot; sequences.</p><p>Similarly, sequence state changes made by <code>setval()</code> are immediately visible to other transactions, and are not undone if the calling transaction rolls back.</p><p>If the database cluster crashes before committing a transaction containing a <code>nextval()</code> or <code>setval()</code> call, the sequence state change may not have been propogated to persistent storage, so that it is uncertain whether the sequence has its original or updated state after the cluster restarts. This is harmless for usage of the sequence within the database, since other effects of uncommitted transactions are visible either. However, if you wish to use a sequence value for persistent outside-the-database purposes, ensure that the <code>nextval()</code> call has been committed before doing so.</p><h2 id="altering-a-sequence" tabindex="-1"><a id="topic89"></a>Altering a Sequence <a class="header-anchor" href="#altering-a-sequence" aria-label="Permalink to &quot;&lt;a id=&quot;topic89&quot;&gt;&lt;/a&gt;Altering a Sequence&quot;">​</a></h2><p>The <a href="./../../ref_guide/sql_commands/ALTER_SEQUENCE.html">ALTER SEQUENCE</a> command changes the attributes of an existing sequence. You can alter the sequence start, minimum, maximum, and increment values. You can also restart the sequence at the start value or at a specified value.</p><p>Any parameters not set in the <code>ALTER SEQUENCE</code> command retain their prior settings.</p><p><code>ALTER SEQUENCE sequence START WITH start_value</code> sets the sequence&#39;s <code>start_value</code> attribute to the new starting value. It has no effect on the <code>last_value</code> attribute or the value returned by the <code>nextval(sequence)</code> function.</p><p><code>ALTER SEQUENCE sequence RESTART</code> resets the sequence&#39;s <code>last_value</code> attribute to the current value of the <code>start_value</code> attribute and the <code>is_called</code> attribute to <code>false</code>. The next call to the <code>nextval(sequence)</code> function returns <code>start_value</code>.</p><p><code>ALTER SEQUENCE sequence RESTART WITH restart_value</code> sets the sequence&#39;s <code>last_value</code> attribute to the new value and the <code>is_called</code> attribute to <code>false</code>. The next call to the <code>nextval(sequence)</code> returns <code>restart_value</code>. This is the equivalent of calling <code>setval(sequence, restart_value, false)</code>.</p><p>The following command restarts the sequence named <code>myserial</code> at value <code>105</code>:</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>ALTER SEQUENCE myserial RESTART WITH 105;</span></span></code></pre></div><h2 id="dropping-a-sequence" tabindex="-1"><a id="topic90"></a>Dropping a Sequence <a class="header-anchor" href="#dropping-a-sequence" aria-label="Permalink to &quot;&lt;a id=&quot;topic90&quot;&gt;&lt;/a&gt;Dropping a Sequence&quot;">​</a></h2><p>The <a href="./../../ref_guide/sql_commands/DROP_SEQUENCE.html">DROP SEQUENCE</a> command removes a sequence. For example, the following command removes the sequence named <code>myserial</code>:</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>DROP SEQUENCE myserial;</span></span></code></pre></div><h2 id="specifying-a-sequence-as-the-default-value-for-a-column" tabindex="-1"><a id="topic91"></a>Specifying a Sequence as the Default Value for a Column <a class="header-anchor" href="#specifying-a-sequence-as-the-default-value-for-a-column" aria-label="Permalink to &quot;&lt;a id=&quot;topic91&quot;&gt;&lt;/a&gt;Specifying a Sequence as the Default Value for a Column&quot;">​</a></h2><p>You can reference a sequence directly in the <a href="./../../ref_guide/sql_commands/CREATE_TABLE.html">CREATE TABLE</a> command in addition to using the <code>SERIAL</code> or <code>BIGSERIAL</code> types. For example:</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>CREATE TABLE tablename ( id INT4 DEFAULT nextval(&#39;myserial&#39;), name text );</span></span></code></pre></div><p>You can also alter a table column to set its default value to a sequence counter:</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>ALTER TABLE tablename ALTER COLUMN id SET DEFAULT nextval(&#39;myserial&#39;);</span></span></code></pre></div><h2 id="sequence-wraparound" tabindex="-1"><a id="topic92"></a>Sequence Wraparound <a class="header-anchor" href="#sequence-wraparound" aria-label="Permalink to &quot;&lt;a id=&quot;topic92&quot;&gt;&lt;/a&gt;Sequence Wraparound&quot;">​</a></h2><p>By default, a sequence does not wrap around. That is, when a sequence reaches the max value (<code>+32767</code> for <code>SMALLSERIAL</code>, <code>+2147483647</code> for <code>SERIAL</code>, <code>+9223372036854775807</code> for <code>BIGSERIAL</code>), every subsequent <code>nextval()</code> call produces an error. You can alter a sequence to make it cycle around and start at <code>1</code> again:</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>ALTER SEQUENCE myserial CYCLE;</span></span></code></pre></div><p>You can also specify the wraparound behaviour when you create the sequence:</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>CREATE SEQUENCE myserial CYCLE;</span></span></code></pre></div>',54)]))}const g=a(s,[["render",c]]);export{p as __pageData,g as default};

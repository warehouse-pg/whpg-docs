import{_ as e,c as t,o as s,ag as i}from"./chunks/framework.Ds6Eueu6.js";const k=JSON.parse('{"title":"CREATE TRANSFORM","description":"","frontmatter":{},"headers":[],"relativePath":"docs/7x/ref_guide/sql_commands/CREATE_TRANSFORM.md","filePath":"docs/7x/ref_guide/sql_commands/CREATE_TRANSFORM.md"}'),n={name:"docs/7x/ref_guide/sql_commands/CREATE_TRANSFORM.md"};function o(l,a,h,p,r,d){return s(),t("div",null,a[0]||(a[0]=[i(`<h1 id="create-transform" tabindex="-1">CREATE TRANSFORM <a class="header-anchor" href="#create-transform" aria-label="Permalink to &quot;CREATE TRANSFORM&quot;">​</a></h1><p>Defines a new transform</p><h2 id="synopsis" tabindex="-1"><a id="section2"></a>Synopsis <a class="header-anchor" href="#synopsis" aria-label="Permalink to &quot;&lt;a id=&quot;section2&quot;&gt;&lt;/a&gt;Synopsis&quot;">​</a></h2><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>CREATE [ OR REPLACE ] TRANSFORM FOR &lt;type_name&gt; LANGUAGE &lt;lang_name&gt; (</span></span>
<span class="line"><span>  FROM SQL WITH FUNCTION &lt;from_sql_function_name&gt; [ (&lt;argument_type&gt; [, ...]) ],</span></span>
<span class="line"><span>  TO SQL WITH FUNCTION &lt;to_sql_function_name&gt; [ (&lt;argument_type&gt; [, ...]) ]</span></span>
<span class="line"><span>);</span></span></code></pre></div><h2 id="description" tabindex="-1"><a id="section3"></a>Description <a class="header-anchor" href="#description" aria-label="Permalink to &quot;&lt;a id=&quot;section3&quot;&gt;&lt;/a&gt;Description&quot;">​</a></h2><p><code>CREATE TRANSFORM</code> defines a new transform. <code>CREATE OR REPLACE TRANSFORM</code> will either create a new transform, or replace an existing definition.</p><p>A transform specifies how to adapt a data type to a procedural language. For example, when writing a function in PL/Python using the <code>hstore</code> type, PL/Python has no prior knowledge how to present <code>hstore</code> values in the Python environment. Language implementations usually default to using the text representation, but that is inconvenient when, for example, an associative array or a list would be more appropriate.</p><p>A transform specifies two functions:</p><ul><li><p>A &quot;from SQL&quot; function that converts the type from the SQL environment to the language. This function will be invoked on the arguments of a function written in the language.</p></li><li><p>A &quot;to SQL&quot; function that converts the type from the language to the SQL environment. This function will be invoked on the return value of a function written in the language.</p></li></ul><p>It is not necessary to provide both of these functions. If one is not specified, the language-specific default behavior will be used if necessary. (To prevent a transformation in a certain direction from happening at all, you could also write a transform function that always errors out.)</p><p>To create a transform, you must own and have <code>USAGE</code> privilege on the type, have <code>USAGE</code> privilege on the language, and own and have <code>EXECUTE</code> privilege on the from-SQL and to-SQL functions, if specified.</p><h2 id="parameters" tabindex="-1"><a id="section4"></a>Parameters <a class="header-anchor" href="#parameters" aria-label="Permalink to &quot;&lt;a id=&quot;section4&quot;&gt;&lt;/a&gt;Parameters&quot;">​</a></h2><p>type_name : The name of the data type of the transform.</p><p>lang_name : The name of the language of the transform.</p><p>from_sql_function_name[(argument_type [, ...])] : The name of the function for converting the type from the SQL environment to the language. It must take a single argument of type <code>internal</code> and return type <code>internal</code>. The actual argument will be of the type for the transform, and the function should be coded as if it were. (An SQL-level function returning <code>internal</code> must declare at least one argument of type <code>internal</code>.) The actual return value will be something specific to the language implementation. If no argument list is specified, the function name must be unique in its schema.</p><p>to_sql_function_name[(argument_type [, ...])] : The name of the function for converting the type from the language to the SQL environment. It must take a single argument of type <code>internal</code> and return the type that is the type for the transform. The actual argument value will be something specific to the language implementation. If no argument list is specified, the function name must be unique in its schema.</p><h2 id="notes" tabindex="-1"><a id="section5"></a>Notes <a class="header-anchor" href="#notes" aria-label="Permalink to &quot;&lt;a id=&quot;section5&quot;&gt;&lt;/a&gt;Notes&quot;">​</a></h2><p>Use <a href="./DROP_TRANSFORM.html">DROP TRANSFORM</a> to remove transforms.</p><h2 id="examples" tabindex="-1"><a id="section6"></a>Examples <a class="header-anchor" href="#examples" aria-label="Permalink to &quot;&lt;a id=&quot;section6&quot;&gt;&lt;/a&gt;Examples&quot;">​</a></h2><p>To create a transform for type <code>hstore</code> and language <code>plpython3u</code>, first set up the type and the language:</p><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">CREATE</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> EXTENSION </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">IF</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> NOT</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> EXISTS</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> hstore;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">CREATE</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> EXTENSION plpython3u;</span></span></code></pre></div><p>Then create the necessary functions:</p><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">CREATE</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> FUNCTION</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> hstore_to_plpython</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(val internal) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">RETURNS</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> internal</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">LANGUAGE</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> C STRICT IMMUTABLE</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">AS</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ...;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">CREATE</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> FUNCTION</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> plpython_to_hstore</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(val internal) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">RETURNS</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> hstore</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">LANGUAGE</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> C STRICT IMMUTABLE</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">AS</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ...;</span></span></code></pre></div><p>And finally create the transform to connect them all together:</p><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">CREATE</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> TRANSFORM </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">FOR</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> hstore </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">LANGUAGE</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> plpython3u (</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    FROM</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> SQL</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> WITH</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> FUNCTION</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> hstore_to_plpython(internal),</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    TO</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> SQL</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> WITH</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> FUNCTION</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> plpython_to_hstore(internal)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre></div><p>In practice, these commands would be wrapped up in an extension.</p><h2 id="compatibility" tabindex="-1"><a id="section7"></a>Compatibility <a class="header-anchor" href="#compatibility" aria-label="Permalink to &quot;&lt;a id=&quot;section7&quot;&gt;&lt;/a&gt;Compatibility&quot;">​</a></h2><p>This form of <code>CREATE TRANSFORM</code> is a WarehousePG extension. There is a <code>CREATE TRANSFORM</code> command in the SQL standard, but it is for adapting data types to client languages. That usage is not supported by WarehousePG.</p><h2 id="see-also" tabindex="-1"><a id="section8"></a>See Also <a class="header-anchor" href="#see-also" aria-label="Permalink to &quot;&lt;a id=&quot;section8&quot;&gt;&lt;/a&gt;See Also&quot;">​</a></h2><p><a href="./CREATE_FUNCTION.html">CREATE FUNCTION</a>, <a href="./CREATE_LANGUAGE.html">CREATE LANGUAGE</a>, <a href="./CREATE_TYPE.html">CREATE TYPE</a>, <a href="./DROP_TRANSFORM.html">DROP TRANSFORM</a></p><p><strong>Parent topic:</strong> <a href="./../sql_commands/sql_ref.html">SQL Commands</a></p>`,31)]))}const u=e(n,[["render",o]]);export{k as __pageData,u as default};

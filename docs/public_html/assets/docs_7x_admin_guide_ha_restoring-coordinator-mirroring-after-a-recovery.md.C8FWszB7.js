import{_ as t,c as e,o as a,ag as i}from"./chunks/framework.Ds6Eueu6.js";const g=JSON.parse('{"title":"Restoring Coordinator Mirroring After a Recovery","description":"","frontmatter":{},"headers":[],"relativePath":"docs/7x/admin_guide/ha/restoring-coordinator-mirroring-after-a-recovery.md","filePath":"docs/7x/admin_guide/ha/restoring-coordinator-mirroring-after-a-recovery.md"}'),r={name:"docs/7x/admin_guide/ha/restoring-coordinator-mirroring-after-a-recovery.md"};function n(s,o,d,c,p,h){return a(),e("div",null,o[0]||(o[0]=[i('<h1 id="restoring-coordinator-mirroring-after-a-recovery" tabindex="-1">Restoring Coordinator Mirroring After a Recovery <a class="header-anchor" href="#restoring-coordinator-mirroring-after-a-recovery" aria-label="Permalink to &quot;Restoring Coordinator Mirroring After a Recovery&quot;">​</a></h1><hr><p>After you activate a standby coordinator for recovery, the standby coordinator becomes the primary coordinator. You can continue running that instance as the primary coordinator if it has the same capabilities and dependability as the original coordinator host.</p><p>You must initialize a new standby coordinator to continue providing coordinator mirroring unless you have already done so while activating the prior standby coordinator. Run <a href="./../../utility_guide/ref/gpinitstandby.html">gpinitstandby</a> on the active coordinator host to configure a new standby coordinator. See <a href="./enabling-coordinator-mirroring.html">Enabling Coordinator Mirroring</a>.</p><p>You can restore the primary and standby coordinator instances on the original hosts. This process swaps the roles of the primary and standby coordinator hosts, and it should be performed only if you strongly prefer to run the coordinator instances on the same hosts they occupied prior to the recovery scenario.</p><blockquote><p><strong>Important</strong> Restoring the primary and standby coordinator instances to their original hosts is not an online operation. The coordinator host must be stopped to perform the operation.</p></blockquote><p>For information about the WarehousePG utilities, see the <em>WarehousePG Utility Guide</em>.</p><p><strong>Parent topic:</strong> <a href="./../ha/recovering-a-failed-coordinator.html">Recovering a Failed Coordinator</a></p><h2 id="to-restore-the-coordinator-mirroring-after-a-recovery" tabindex="-1"><a id="topic_us3_md4_npb"></a>To restore the coordinator mirroring after a recovery <a class="header-anchor" href="#to-restore-the-coordinator-mirroring-after-a-recovery" aria-label="Permalink to &quot;&lt;a id=&quot;topic_us3_md4_npb&quot;&gt;&lt;/a&gt;To restore the coordinator mirroring after a recovery&quot;">​</a></h2><ol><li><p>Ensure the original coordinator host is in dependable running condition; ensure the cause of the original failure is fixed.</p></li><li><p>On the original coordinator host, move or remove the data directory, <code>gpseg-1</code>. This example moves the directory to <code>backup_gpseg-1</code>:</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>$ mv /data/coordinator/gpseg-1 /data/coordinator/backup_gpseg-1</span></span></code></pre></div><p>You can remove the backup directory once the standby is successfully configured.</p></li><li><p>Initialize a standby coordinator on the original coordinator host. For example, run this command from the current coordinator host, scdw:</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>$ gpinitstandby -s cdw</span></span></code></pre></div></li><li><p>After the initialization completes, check the status of standby coordinator, cdw. Run <a href="./../../utility_guide/ref/gpstate.html">gpstate</a> with the <code>-f</code> option to check the standby coordinator status:</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>$ gpstate -f</span></span></code></pre></div><p>The standby coordinator status should be <code>passive</code>, and the WAL sender state should be <code>streaming</code>.</p></li></ol><h2 id="to-restore-the-coordinator-and-standby-instances-on-original-hosts-optional" tabindex="-1"><a id="topic_dr3_ld4_npb"></a>To restore the coordinator and standby instances on original hosts (optional) <a class="header-anchor" href="#to-restore-the-coordinator-and-standby-instances-on-original-hosts-optional" aria-label="Permalink to &quot;&lt;a id=&quot;topic_dr3_ld4_npb&quot;&gt;&lt;/a&gt;To restore the coordinator and standby instances on original hosts \\(optional\\)&quot;">​</a></h2><blockquote><p><strong>Note</strong> Before performing the steps in this section, be sure you have followed the steps to restore coordinator mirroring after a recovery, as described in the <a href="#topic_us3_md4_npb">To restore the coordinator mirroring after a recovery</a>previous section.</p></blockquote><ol><li><p>Stop the WarehousePG coordinator instance on the standby coordinator. For example:</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>$ gpstop -m</span></span></code></pre></div></li><li><p>Run the <code>gpactivatestandby</code> utility from the original coordinator host, cdw, that is currently a standby coordinator. For example:</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>$ gpactivatestandby -d $COORDINATOR_DATA_DIRECTORY</span></span></code></pre></div><p>Where the <code>-d</code> option specifies the data directory of the host you are activating.</p><blockquote><p><strong>NOTE</strong> Before running <code>gpactivatestandby</code>, be sure to run <code>gpstate -f</code> to confirm that the standby coordinator is synchronized with the current coordinator node. If synchronized, the final line of the <code>gpstate -f</code> output will look similar to this: <code>20230607:06:50:06:004205 gpstate:test1-m:gpadmin-[INFO]:--Sync state: sync</code></p></blockquote></li><li><p>After the utility completes, run <code>gpstate</code> with the <code>-b</code> option to display a summary of the system status:</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>$ gpstate -b</span></span></code></pre></div><p>The coordinator instance status should be <code>Active</code>. When a standby coordinator is not configured, the command displays <code>No coordinator standby configured</code> for the standby coordinator state.</p></li><li><p>On the standby coordinator host, move or remove the data directory, <code>gpseg-1</code>. This example moves the directory:</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>$ mv /data/coordinator/gpseg-1 /data//backup_gpseg-1</span></span></code></pre></div><p>You can remove the backup directory once the standby is successfully configured.</p></li><li><p>After the original coordinator host runs the primary WarehousePG coordinator, you can initialize a standby coordinator on the original standby coordinator host. For example:</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>$ gpinitstandby -s scdw</span></span></code></pre></div><p>After the command completes, you can run the <code>gpstate -f</code> command on the primary coordinator host, to check the standby coordinator status.</p></li></ol><h2 id="to-check-the-status-of-the-coordinator-mirroring-process-optional" tabindex="-1"><a id="topic_i1h_kd4_npb"></a>To check the status of the coordinator mirroring process (optional) <a class="header-anchor" href="#to-check-the-status-of-the-coordinator-mirroring-process-optional" aria-label="Permalink to &quot;&lt;a id=&quot;topic_i1h_kd4_npb&quot;&gt;&lt;/a&gt;To check the status of the coordinator mirroring process \\(optional\\)&quot;">​</a></h2><p>You can run the <code>gpstate</code> utility with the <code>-f</code> option to display details of the standby coordinator host.</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>$ gpstate -f</span></span></code></pre></div><p>The standby coordinator status should be <code>passive</code>, and the WAL sender state should be <code>streaming</code>.</p><p>For information about the <a href="./../../utility_guide/ref/gpstate.html">gpstate</a> utility, see the <em>WarehousePG Utility Guide</em>.</p>',18)]))}const u=t(r,[["render",n]]);export{g as __pageData,u as default};

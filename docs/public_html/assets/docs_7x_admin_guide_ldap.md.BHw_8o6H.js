import{_ as a,c as t,o as i,ag as s}from"./chunks/framework.Ds6Eueu6.js";const u=JSON.parse('{"title":"Using LDAP Authentication with TLS/SSL","description":"","frontmatter":{},"headers":[],"relativePath":"docs/7x/admin_guide/ldap.md","filePath":"docs/7x/admin_guide/ldap.md"}'),n={name:"docs/7x/admin_guide/ldap.md"};function o(p,e,l,c,d,r){return i(),t("div",null,e[0]||(e[0]=[s(`<h1 id="using-ldap-authentication-with-tls-ssl" tabindex="-1">Using LDAP Authentication with TLS/SSL <a class="header-anchor" href="#using-ldap-authentication-with-tls-ssl" aria-label="Permalink to &quot;Using LDAP Authentication with TLS/SSL&quot;">​</a></h1><hr><p>You can control access to WarehousePG with an LDAP server and, optionally, secure the connection with encryption by adding parameters to pg_hba.conf file entries.</p><p>WarehousePG supports LDAP authentication with the TLS/SSL protocol to encrypt communication with an LDAP server:</p><ul><li>LDAP authentication with STARTTLS and TLS protocol – STARTTLS starts with a clear text connection (no encryption) and upgrades it to a secure connection (with encryption).</li><li>LDAP authentication with a secure connection and TLS/SSL (LDAPS) – WarehousePG uses the TLS or SSL protocol based on the protocol that is used by the LDAP server.</li></ul><p>If no protocol is specified, WarehousePG communicates with the LDAP server with a clear text connection.</p><p>To use LDAP authentication, the WarehousePG coordinator host must be configured as an LDAP client. See your LDAP documentation for information about configuring LDAP clients.</p><h2 id="enabling-ldap-authentication-with-starttls-and-tls" tabindex="-1"><a id="enldap"></a>Enabling LDAP Authentication with STARTTLS and TLS <a class="header-anchor" href="#enabling-ldap-authentication-with-starttls-and-tls" aria-label="Permalink to &quot;&lt;a id=&quot;enldap&quot;&gt;&lt;/a&gt;Enabling LDAP Authentication with STARTTLS and TLS&quot;">​</a></h2><p>To enable STARTTLS with the TLS protocol, in the pg_hba.conf file, add an <code>ldap</code> line and specify the <code>ldaptls</code> parameter with the value 1. The default port is 389. In this example, the authentication method parameters include the <code>ldaptls</code> parameter.</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>ldap ldapserver=myldap.com ldaptls=1 ldapprefix=&quot;uid=&quot; ldapsuffix=&quot;,ou=People,dc=example,dc=com&quot;</span></span></code></pre></div><p>Specify a non-default port with the <code>ldapport</code> parameter. In this example, the authentication method includes the <code>ldaptls</code> parameter and the <code>ldapport</code> parameter to specify the port 500.</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>ldap ldapserver=myldap.com ldaptls=1 ldapport=500 ldapprefix=&quot;uid=&quot; ldapsuffix=&quot;,ou=People,dc=example,dc=com&quot;</span></span></code></pre></div><h2 id="enabling-ldap-authentication-with-a-secure-connection-and-tls-ssl" tabindex="-1"><a id="enldapauth"></a>Enabling LDAP Authentication with a Secure Connection and TLS/SSL <a class="header-anchor" href="#enabling-ldap-authentication-with-a-secure-connection-and-tls-ssl" aria-label="Permalink to &quot;&lt;a id=&quot;enldapauth&quot;&gt;&lt;/a&gt;Enabling LDAP Authentication with a Secure Connection and TLS/SSL&quot;">​</a></h2><p>To enable a secure connection with TLS/SSL, add <code>ldaps://</code> as the prefix to the LDAP server name specified in the <code>ldapserver</code> parameter. The default port is 636.</p><p>This example <code>ldapserver</code> parameter specifies a secure connection and the TLS/SSL protocol for the LDAP server <code>myldap.com</code>.</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>ldapserver=ldaps://myldap.com</span></span></code></pre></div><p>To specify a non-default port, add a colon (:) and the port number after the LDAP server name. This example <code>ldapserver</code> parameter includes the <code>ldaps://</code> prefix and the non-default port 550.</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>ldapserver=ldaps://myldap.com:550</span></span></code></pre></div><h2 id="configuring-authentication-with-a-system-wide-openldap-system" tabindex="-1"><a id="conauth"></a>Configuring Authentication with a System-wide OpenLDAP System <a class="header-anchor" href="#configuring-authentication-with-a-system-wide-openldap-system" aria-label="Permalink to &quot;&lt;a id=&quot;conauth&quot;&gt;&lt;/a&gt;Configuring Authentication with a System-wide OpenLDAP System&quot;">​</a></h2><p>If you have a system-wide OpenLDAP system and logins are configured to use LDAP with TLS or SSL in the pg_hba.conf file, logins may fail with the following message:</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>could not start LDAP TLS session: error code &#39;-11&#39;</span></span></code></pre></div><p>To use an existing OpenLDAP system for authentication, WarehousePG must be set up to use the LDAP server&#39;s CA certificate to validate user certificates. Follow these steps on both the coordinator and standby hosts to configure WarehousePG:</p><ol><li><p>Copy the base64-encoded root CA chain file from the Active Directory or LDAP server to the WarehousePG coordinator and standby coordinator hosts. This example uses the directory <code>/etc/pki/tls/certs</code>.</p></li><li><p>Change to the directory where you copied the CA certificate file and, as the root user, generate the hash for OpenLDAP:</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span># cd /etc/pki/tls/certs  </span></span>
<span class="line"><span># openssl x509 -noout -hash -in &lt;ca-certificate-file&gt;  </span></span>
<span class="line"><span># ln -s &lt;ca-certificate-file&gt; &lt;ca-certificate-file&gt;.0</span></span></code></pre></div></li><li><p>Configure an OpenLDAP configuration file for WarehousePG with the CA certificate directory and certificate file specified.</p><p>As the root user, edit the OpenLDAP configuration file <code>/etc/openldap/ldap.conf</code>:</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>SASL_NOCANON on</span></span>
<span class="line"><span> URI ldaps://ldapA.example.priv ldaps://ldapB.example.priv ldaps://ldapC.example.priv</span></span>
<span class="line"><span> BASE dc=example,dc=priv</span></span>
<span class="line"><span> TLS_CACERTDIR /etc/pki/tls/certs</span></span>
<span class="line"><span> TLS_CACERT /etc/pki/tls/certs/&lt;ca-certificate-file&gt;</span></span></code></pre></div><blockquote><p><strong>Note</strong> For certificate validation to succeed, the hostname in the certificate must match a hostname in the URI property. Otherwise, you must also add <code>TLS_REQCERT allow</code> to the file.</p></blockquote></li><li><p>As the gpadmin user, edit <code>/usr/local/greenplum-db/greenplum_path.sh</code> and add the following line.</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>export LDAPCONF=/etc/openldap/ldap.conf</span></span></code></pre></div></li></ol><h2 id="notes" tabindex="-1"><a id="notes2"></a>Notes <a class="header-anchor" href="#notes" aria-label="Permalink to &quot;&lt;a id=&quot;notes2&quot;&gt;&lt;/a&gt;Notes&quot;">​</a></h2><p>WarehousePG logs an error if the following are specified in an pg_hba.conf file entry:</p><ul><li>If both the <code>ldaps://</code> prefix and the <code>ldaptls=1</code> parameter are specified.</li><li>If both the <code>ldaps://</code> prefix and the <code>ldapport</code> parameter are specified.</li></ul><p>Enabling encrypted communication for LDAP authentication only encrypts the communication between WarehousePG and the LDAP server.</p><p>See <a href="./client_auth.html">Encrypting Client/Server Connections</a> for information about encrypting client connections.</p><h2 id="examples" tabindex="-1"><a id="exams"></a>Examples <a class="header-anchor" href="#examples" aria-label="Permalink to &quot;&lt;a id=&quot;exams&quot;&gt;&lt;/a&gt;Examples&quot;">​</a></h2><p>These are example entries from an pg_hba.conf file.</p><p>This example specifies LDAP authentication with no encryption between WarehousePG and the LDAP server.</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>host all plainuser 0.0.0.0/0 ldap ldapserver=myldap.com ldapprefix=&quot;uid=&quot; ldapsuffix=&quot;,ou=People,dc=example,dc=com&quot;</span></span></code></pre></div><p>This example specifies LDAP authentication with the STARTTLS and TLS protocol between WarehousePG and the LDAP server.</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>host all tlsuser 0.0.0.0/0 ldap ldapserver=myldap.com ldaptls=1 ldapprefix=&quot;uid=&quot; ldapsuffix=&quot;,ou=People,dc=example,dc=com&quot;</span></span></code></pre></div><p>This example specifies LDAP authentication with a secure connection and TLS/SSL protocol between WarehousePG and the LDAP server.</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>host all ldapsuser 0.0.0.0/0 ldap ldapserver=myldap.com ldapscheme=ldaps ldapprefix=&quot;uid=&quot; ldapsuffix=&quot;,ou=People,dc=example,dc=com&quot;</span></span></code></pre></div><p>This example also specifies LDAP authentication with a secure connection and TLS/SSL protocol between WarehousePG and the LDAP server, using an alternative syntax.</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>host all ldapsuser 0.0.0.0/0 ldap ldapurl=ldaps://myldap.com ldapprefix=&quot;uid=&quot; ldapsuffix=&quot;,ou=People,dc=example,dc=com&quot;</span></span></code></pre></div><p><strong>Parent topic:</strong> <a href="./client_auth.html">Configuring Client Authentication</a></p>`,39)]))}const g=a(n,[["render",o]]);export{u as __pageData,g as default};

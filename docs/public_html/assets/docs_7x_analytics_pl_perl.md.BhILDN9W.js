import{_ as a,c as s,o as n,ag as t}from"./chunks/framework.Ds6Eueu6.js";const h=JSON.parse('{"title":"PL/Perl Language","description":"","frontmatter":{},"headers":[],"relativePath":"docs/7x/analytics/pl_perl.md","filePath":"docs/7x/analytics/pl_perl.md"}'),i={name:"docs/7x/analytics/pl_perl.md"};function l(r,e,p,o,c,d){return n(),s("div",null,e[0]||(e[0]=[t(`<h1 id="pl-perl-language" tabindex="-1">PL/Perl Language <a class="header-anchor" href="#pl-perl-language" aria-label="Permalink to &quot;PL/Perl Language&quot;">​</a></h1><hr><p>This chapter includes the following information:</p><ul><li><a href="#topic2">About WarehousePG PL/Perl</a></li><li><a href="#topic3">WarehousePG PL/Perl Limitations</a></li><li><a href="#topic31">Trusted/Untrusted Language</a></li><li><a href="#topic33">Developing Functions with PL/Perl</a></li><li><a href="#topic35">About Developing PL/Perl Procedures</a></li></ul><h2 id="about-warehousepg-pl-perl" tabindex="-1"><a id="topic2"></a>About WarehousePG PL/Perl <a class="header-anchor" href="#about-warehousepg-pl-perl" aria-label="Permalink to &quot;&lt;a id=&quot;topic2&quot;&gt;&lt;/a&gt;About WarehousePG PL/Perl&quot;">​</a></h2><p>With the WarehousePG PL/Perl extension, you can write user-defined functions and procedures in Perl that take advantage of its advanced string manipulation operators and functions. PL/Perl provides both trusted and untrusted variants of the language.</p><p>PL/Perl is embedded in your WarehousePG distribution. WarehousePG PL/Perl requires Perl to be installed on the system of each database host.</p><p>Refer to the <a href="https://www.postgresql.org/docs/12/plperl.html" target="_blank" rel="noreferrer">PostgreSQL PL/Perl documentation</a> for additional information.</p><h2 id="warehousepg-pl-perl-limitations" tabindex="-1"><a id="topic3"></a>WarehousePG PL/Perl Limitations <a class="header-anchor" href="#warehousepg-pl-perl-limitations" aria-label="Permalink to &quot;&lt;a id=&quot;topic3&quot;&gt;&lt;/a&gt;WarehousePG PL/Perl Limitations&quot;">​</a></h2><p>Limitations of the WarehousePG PL/Perl language include:</p><ul><li>WarehousePG does not support PL/Perl triggers.</li><li>PL/Perl functions cannot call each other directly.</li><li>SPI is not yet fully implemented.</li><li>If you fetch very large data sets using <code>spi_exec_query()</code>, you should be aware that these will all go into memory. You can avoid this problem by using <code>spi_query()/spi_fetchrow()</code>. A similar problem occurs if a set-returning function passes a large set of rows back to WarehousePG via a <code>return</code> statement. Use <code>return_next</code> for each row returned to avoid this problem.</li><li>When a session ends normally, not due to a fatal error, PL/Perl runs any <code>END</code> blocks that you have defined. No other actions are currently performed. (File handles are not automatically flushed and objects are not automatically destroyed.)</li></ul><h2 id="trusted-untrusted-language" tabindex="-1"><a id="topic31"></a>Trusted/Untrusted Language <a class="header-anchor" href="#trusted-untrusted-language" aria-label="Permalink to &quot;&lt;a id=&quot;topic31&quot;&gt;&lt;/a&gt;Trusted/Untrusted Language&quot;">​</a></h2><p>PL/Perl includes trusted and untrusted language variants.</p><p>The PL/Perl trusted language is named <code>plperl</code>. The trusted PL/Perl language restricts file system operations, as well as <code>require</code>, <code>use</code>, and other statements that could potentially interact with the operating system or database server process. With these restrictions in place, any WarehousePG user can create and run functions in the trusted <code>plperl</code> language.</p><p>The PL/Perl untrusted language is named <code>plperlu</code>. You cannot restrict the operation of functions you create with the <code>plperlu</code> untrusted language. Only database superusers have privileges to create untrusted PL/Perl user-defined functions. And only database superusers and other database users that are explicitly granted the permissions can run untrusted PL/Perl user-defined functions.</p><p>PL/Perl has limitations with respect to communication between interpreters and the number of interpreters running in a single process. Refer to the PostgreSQL <a href="https://www.postgresql.org/docs/12/plperl-trusted.html" target="_blank" rel="noreferrer">Trusted and Untrusted PL/Perl</a> documentation for additional information.</p><h2 id="enabling-and-removing-pl-perl-support" tabindex="-1"><a id="topic6"></a>Enabling and Removing PL/Perl Support <a class="header-anchor" href="#enabling-and-removing-pl-perl-support" aria-label="Permalink to &quot;&lt;a id=&quot;topic6&quot;&gt;&lt;/a&gt;Enabling and Removing PL/Perl Support&quot;">​</a></h2><p>You must register the PL/Perl language with a database before you can create and run a PL/Perl user-defined function within that database. To remove PL/Perl support, you must explicitly remove the extension from each database in which it was registered. You must be a database superuser or owner to register or remove trusted languages in WarehousePGs.</p><blockquote><p><strong>Note</strong> Only database superusers may register or remove support for the <em>untrusted</em> PL/Perl language <code>plperlu</code>.</p></blockquote><p>Before you enable or remove PL/Perl support in a database, ensure that:</p><ul><li>Your WarehousePG is running.</li><li>You have sourced <code>greenplum_path.sh</code>.</li><li>You have set the <code>$COORDINATOR_DATA_DIRECTORY</code> and <code>$GPHOME</code> environment variables.</li></ul><h3 id="enabling-pl-perl-support" tabindex="-1"><a id="topic61"></a>Enabling PL/Perl Support <a class="header-anchor" href="#enabling-pl-perl-support" aria-label="Permalink to &quot;&lt;a id=&quot;topic61&quot;&gt;&lt;/a&gt;Enabling PL/Perl Support&quot;">​</a></h3><p>For each database in which you want to enable PL/Perl, register the language using the SQL <a href="./../ref_guide/sql_commands/CREATE_EXTENSION.html">CREATE EXTENSION</a> command. For example, run the following command as the <code>gpadmin</code> user to register the trusted PL/Perl language for the database named <code>testdb</code>:</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>$ psql -d testdb -c &#39;CREATE EXTENSION plperl;&#39;</span></span></code></pre></div><h3 id="removing-pl-perl-support" tabindex="-1"><a id="topic62"></a>Removing PL/Perl Support <a class="header-anchor" href="#removing-pl-perl-support" aria-label="Permalink to &quot;&lt;a id=&quot;topic62&quot;&gt;&lt;/a&gt;Removing PL/Perl Support&quot;">​</a></h3><p>To remove support for PL/Perl from a database, run the SQL <a href="./../ref_guide/sql_commands/DROP_EXTENSION.html">DROP EXTENSION</a> command. For example, run the following command as the <code>gpadmin</code> user to remove support for the trusted PL/Perl language from the database named <code>testdb</code>:</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>$ psql -d testdb -c &#39;DROP EXTENSION plperl;&#39;</span></span></code></pre></div><p>The default command fails if any existing objects (such as functions) depend on the language. Specify the <code>CASCADE</code> option to also drop all dependent objects, including functions that you created with PL/Perl.</p><h2 id="developing-functions-with-pl-perl" tabindex="-1"><a id="topic33"></a>Developing Functions with PL/Perl <a class="header-anchor" href="#developing-functions-with-pl-perl" aria-label="Permalink to &quot;&lt;a id=&quot;topic33&quot;&gt;&lt;/a&gt;Developing Functions with PL/Perl&quot;">​</a></h2><p>You define a PL/Perl function using the standard SQL <a href="./../ref_guide/sql_commands/CREATE_FUNCTION.html">CREATE FUNCTION</a> syntax. The body of a PL/Perl user-defined function is ordinary Perl code. The PL/Perl interpreter wraps this code inside a Perl subroutine.</p><p>You can also create an anonymous code block with PL/Perl. An anonymous code block, called with the SQL <a href="./../ref_guide/sql_commands/DO.html">DO</a> command, receives no arguments, and whatever value it might return is discarded. Otherwise, a PL/Perl anonymous code block behaves just like a function. Only database superusers create an anonymous code block with the untrusted <code>plperlu</code> language.</p><p>The syntax of the <code>CREATE FUNCTION</code> command requires that you write the PL/Perl function body as a string constant. While it is more convenient to use dollar-quoting, you can choose to use escape string syntax (<code>E&#39;&#39;</code>) provided that you double any single quote marks and backslashes used in the body of the function.</p><p>PL/Perl arguments and results are handled as they are in Perl. Arguments you pass in to a PL/Perl function are accessed via the <code>@_</code> array. You return a result value with the <code>return</code> statement, or as the last expression evaluated in the function. A PL/Perl function cannot directly return a non-scalar type because you call it in a scalar context. You can return non-scalar types such as arrays, records, and sets in a PL/Perl function by returning a reference.</p><p>PL/Perl treats null argument values as &quot;undefined&quot;. Adding the <code>STRICT</code> keyword to the <code>LANGUAGE</code> subclause instructs WarehousePG to immediately return null when any of the input arguments are null. When created as <code>STRICT</code>, the function itself need not perform null checks.</p><p>The following PL/Perl function utilizes the <code>STRICT</code> keyword to return the greater of two integers, or null if any of the inputs are null:</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span></span></span>
<span class="line"><span>CREATE FUNCTION perl_max (integer, integer) RETURNS integer AS $$</span></span>
<span class="line"><span>    if ($_[0] &gt; $_[1]) { return $_[0]; }</span></span>
<span class="line"><span>    return $_[1];</span></span>
<span class="line"><span>$$ LANGUAGE plperl STRICT;</span></span>
<span class="line"><span></span></span>
<span class="line"><span>SELECT perl_max( 1, 3 );</span></span>
<span class="line"><span> perl_max</span></span>
<span class="line"><span>----------</span></span>
<span class="line"><span>        3</span></span>
<span class="line"><span>(1 row)</span></span>
<span class="line"><span></span></span>
<span class="line"><span>SELECT perl_max( 1, null );</span></span>
<span class="line"><span> perl_max</span></span>
<span class="line"><span>----------</span></span>
<span class="line"><span></span></span>
<span class="line"><span>(1 row)</span></span></code></pre></div><p>PL/Perl considers anything in a function argument that is not a reference to be a string, the standard WarehousePG external text representation. The argument values supplied to a PL/Perl function are simply the input arguments converted to text form (just as if they had been displayed by a <code>SELECT</code> statement). In cases where the function argument is not an ordinary numeric or text type, you must convert the WarehousePG type to a form that is more usable by Perl. Conversely, the <code>return</code> and <code>return_next</code> statements accept any string that is an acceptable input format for the function&#39;s declared return type.</p><p>Refer to the PostgreSQL <a href="https://www.postgresql.org/docs/12/plperl-funcs.html" target="_blank" rel="noreferrer">PL/Perl Functions and Arguments</a> documentation for additional information, including composite type and result set manipulation.</p><h3 id="built-in-pl-perl-functions" tabindex="-1"><a id="topic3311"></a>Built-in PL/Perl Functions <a class="header-anchor" href="#built-in-pl-perl-functions" aria-label="Permalink to &quot;&lt;a id=&quot;topic3311&quot;&gt;&lt;/a&gt;Built-in PL/Perl Functions&quot;">​</a></h3><p>PL/Perl includes built-in functions to access the database, including those to prepare and perform queries and manipulate query results. The language also includes utility functions for error logging and string manipulation.</p><p>The following example creates a simple table with an integer and a text column. It creates a PL/Perl user-defined function that takes an input string argument and invokes the <code>spi_exec_query()</code> built-in function to select all columns and rows of the table. The function returns all rows in the query results where the <code>v</code> column includes the function input string.</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span></span></span>
<span class="line"><span>CREATE TABLE test (</span></span>
<span class="line"><span>    i int,</span></span>
<span class="line"><span>    v varchar</span></span>
<span class="line"><span>);</span></span>
<span class="line"><span>INSERT INTO test (i, v) VALUES (1, &#39;first line&#39;);</span></span>
<span class="line"><span>INSERT INTO test (i, v) VALUES (2, &#39;line2&#39;);</span></span>
<span class="line"><span>INSERT INTO test (i, v) VALUES (3, &#39;3rd line&#39;);</span></span>
<span class="line"><span>INSERT INTO test (i, v) VALUES (4, &#39;different&#39;);</span></span>
<span class="line"><span></span></span>
<span class="line"><span>CREATE OR REPLACE FUNCTION return_match(varchar) RETURNS SETOF test AS $$</span></span>
<span class="line"><span>    # store the input argument</span></span>
<span class="line"><span>    $ss = $_[0];</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    # run the query</span></span>
<span class="line"><span>    my $rv = spi_exec_query(&#39;select i, v from test;&#39;);</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    # retrieve the query status</span></span>
<span class="line"><span>    my $status = $rv-&gt;{status};</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    # retrieve the number of rows returned in the query</span></span>
<span class="line"><span>    my $nrows = $rv-&gt;{processed};</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    # loop through all rows, comparing column v value with input argument</span></span>
<span class="line"><span>    foreach my $rn (0 .. $nrows - 1) {</span></span>
<span class="line"><span>        my $row = $rv-&gt;{rows}[$rn];</span></span>
<span class="line"><span>        my $textstr = $row-&gt;{v};</span></span>
<span class="line"><span>        if( index($textstr, $ss) != -1 ) {</span></span>
<span class="line"><span>            # match!  return the row.</span></span>
<span class="line"><span>            return_next($row);</span></span>
<span class="line"><span>        }</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>    return undef;</span></span>
<span class="line"><span>$$ LANGUAGE plperl EXECUTE ON COORDINATOR ;</span></span>
<span class="line"><span></span></span>
<span class="line"><span>SELECT return_match( &#39;iff&#39; );</span></span>
<span class="line"><span> return_match</span></span>
<span class="line"><span>---------------</span></span>
<span class="line"><span> (4,different)</span></span>
<span class="line"><span>(1 row)</span></span></code></pre></div><p>Refer to the PostgreSQL PL/Perl <a href="https://www.postgresql.org/docs/12/plperl-builtins.html" target="_blank" rel="noreferrer">Built-in Functions</a> documentation for a detailed discussion of available functions.</p><h3 id="global-values-in-pl-perl" tabindex="-1"><a id="topic331"></a>Global Values in PL/Perl <a class="header-anchor" href="#global-values-in-pl-perl" aria-label="Permalink to &quot;&lt;a id=&quot;topic331&quot;&gt;&lt;/a&gt;Global Values in PL/Perl&quot;">​</a></h3><p>You can use the global hash map <code>%_SHARED</code> to share data, including code references, between PL/Perl function calls for the lifetime of the current session.</p><p>The following example uses <code>%_SHARED</code> to share data between the user-defined <code>set_var()</code> and <code>get_var()</code> PL/Perl functions:</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span></span></span>
<span class="line"><span>CREATE OR REPLACE FUNCTION set_var(name text, val text) RETURNS text AS $$</span></span>
<span class="line"><span>    if ($_SHARED{$_[0]} = $_[1]) {</span></span>
<span class="line"><span>        return &#39;ok&#39;;</span></span>
<span class="line"><span>    } else {</span></span>
<span class="line"><span>        return &quot;cannot set shared variable $_[0] to $_[1]&quot;;</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>$$ LANGUAGE plperl;</span></span>
<span class="line"><span></span></span>
<span class="line"><span>CREATE OR REPLACE FUNCTION get_var(name text) RETURNS text AS $$</span></span>
<span class="line"><span>    return $_SHARED{$_[0]};</span></span>
<span class="line"><span>$$ LANGUAGE plperl;</span></span>
<span class="line"><span></span></span>
<span class="line"><span>SELECT set_var(&#39;key1&#39;, &#39;value1&#39;);</span></span>
<span class="line"><span> set_var</span></span>
<span class="line"><span>---------</span></span>
<span class="line"><span> ok</span></span>
<span class="line"><span>(1 row)</span></span>
<span class="line"><span></span></span>
<span class="line"><span>SELECT get_var(&#39;key1&#39;);</span></span>
<span class="line"><span> get_var</span></span>
<span class="line"><span>---------</span></span>
<span class="line"><span> value1</span></span>
<span class="line"><span>(1 row)</span></span></code></pre></div><p>For security reasons, PL/Perl creates a separate Perl interpreter for each role. This prevents accidental or malicious interference by one user with the behavior of another user&#39;s PL/Perl functions. Each such interpreter retains its own value of the <code>%_SHARED</code> variable and other global state. Two PL/Perl functions share the same value of <code>%_SHARED</code> if and only if they are run by the same SQL role.</p><p>There are situations where you must take explicit steps to ensure that PL/Perl functions can share data in <code>%_SHARED</code>. For example, if an application runs under multiple SQL roles (via <code>SECURITY DEFINER</code> functions, use of <code>SET ROLE</code>, etc.) in a single session, make sure that functions that need to communicate are owned by the same user, and mark these functions as <code>SECURITY DEFINER</code>.</p><h3 id="notes" tabindex="-1"><a id="topic335"></a>Notes <a class="header-anchor" href="#notes" aria-label="Permalink to &quot;&lt;a id=&quot;topic335&quot;&gt;&lt;/a&gt;Notes&quot;">​</a></h3><p>Additional considerations when developing PL/Perl functions:</p><ul><li>PL/Perl internally utilizes the UTF-8 encoding. It converts any arguments provided in other encodings to UTF-8, and converts return values from UTF-8 back to the original encoding.</li><li>Nesting named PL/Perl subroutines retains the same dangers as in Perl.</li><li>Only the untrusted PL/Perl language variant supports module import. Use <code>plperlu</code> with care.</li><li>Any module that you use in a <code>plperlu</code> function must be available from the same location on all WarehousePG hosts.</li></ul><h2 id="about-developing-pl-perl-procedures" tabindex="-1"><a id="topic35"></a>About Developing PL/Perl Procedures <a class="header-anchor" href="#about-developing-pl-perl-procedures" aria-label="Permalink to &quot;&lt;a id=&quot;topic35&quot;&gt;&lt;/a&gt;About Developing PL/Perl Procedures&quot;">​</a></h2><p>A PL/Perl procedure is similar to a PL/Perl function. Refer to <a href="./../admin_guide/query/topics/functions-operators.html#topic28a">User-Defined Procedures</a> for more information on procedures in WarehousePG and how they differ from functions.</p><p>In a PL/Perl procedure, any return value from the Perl code is ignored.</p><p>Output arguments of PL/Perl procedures can be returned as a hash reference:</p><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">CREATE</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> PROCEDURE</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> perl_triple(INOUT a </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">integer</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, INOUT b </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">integer</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">AS</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $$</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    my ($a, $b) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> @_;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {a </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $a </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, b </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $b </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">};</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$$ </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">LANGUAGE</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> plperl;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">CALL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> perl_triple(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">5</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">10</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre></div><p><code>spi_commit()</code> and <code>spi_rollback()</code> can be called only from the top level in a procedure. (Note that it is not possible to run the SQL commands <code>COMMIT</code> or <code>ROLLBACK</code> via <code>spi_exec_query()</code> or similar. Commit and rollback must be done using these functions.) After a transaction is ended, a new transaction is automatically started, so there is no separate function for that.</p><p>Here is an example:</p><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">CREATE</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> PROCEDURE</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> transaction_test1()</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">LANGUAGE</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> plperl</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">AS</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $$</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">foreach my $i (</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">..</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">9</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    spi_exec_query(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;INSERT INTO tbl1 (a) VALUES ($i)&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ($i % </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> ==</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        spi_commit();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">else</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        spi_rollback();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$$;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">CALL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> transaction_test1();</span></span></code></pre></div>`,60)]))}const g=a(i,[["render",l]]);export{h as __pageData,g as default};

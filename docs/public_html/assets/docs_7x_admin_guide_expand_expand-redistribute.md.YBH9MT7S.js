import{_ as a,c as t,o as s,ag as i}from"./chunks/framework.Ds6Eueu6.js";const h=JSON.parse('{"title":"Redistributing Tables","description":"","frontmatter":{},"headers":[],"relativePath":"docs/7x/admin_guide/expand/expand-redistribute.md","filePath":"docs/7x/admin_guide/expand/expand-redistribute.md"}'),n={name:"docs/7x/admin_guide/expand/expand-redistribute.md"};function o(r,e,p,d,l,c){return s(),t("div",null,e[0]||(e[0]=[i(`<h1 id="redistributing-tables" tabindex="-1">Redistributing Tables <a class="header-anchor" href="#redistributing-tables" aria-label="Permalink to &quot;Redistributing Tables&quot;">​</a></h1><hr><p>Redistribute tables to balance existing data over the newly expanded cluster.</p><p>After creating an expansion schema, you can redistribute tables across the entire system with <a href="./../../utility_guide/ref/gpexpand.html">gpexpand</a>. Plan to run this during low-use hours when the utility&#39;s CPU usage and table locks have minimal impact on operations. Rank tables to redistribute the largest or most critical tables first.</p><blockquote><p><strong>Note</strong> When redistributing data, WarehousePG must be running in production mode. WarehousePG cannot be in restricted mode or in coordinator mode. The <a href="./../../utility_guide/ref/gpstart.html">gpstart</a> options <code>-R</code> or <code>-m</code> cannot be specified to start WarehousePG.</p></blockquote><p>While table redistribution is underway, any new tables or partitions created are distributed across all segments exactly as they would be under normal operating conditions. Queries can access all segments, even before the relevant data is redistributed to tables on the new segments. The table or partition being redistributed is locked and unavailable for read or write operations. When its redistribution completes, normal operations resume.</p><ul><li><a href="#topic29">Ranking Tables for Redistribution</a></li><li><a href="#topic30">Redistributing Tables Using gpexpand</a></li><li><a href="#topic31">Monitoring Table Redistribution</a></li></ul><p><strong>Parent topic:</strong> <a href="./../expand/expand-main.html">Expanding a WarehousePG cluster</a></p><h2 id="ranking-tables-for-redistribution" tabindex="-1"><a id="topic29"></a>Ranking Tables for Redistribution <a class="header-anchor" href="#ranking-tables-for-redistribution" aria-label="Permalink to &quot;&lt;a id=&quot;topic29&quot;&gt;&lt;/a&gt;Ranking Tables for Redistribution&quot;">​</a></h2><p>For large systems, you can control the table redistribution order. Adjust tables&#39; <code>rank</code> values in the expansion schema to prioritize heavily-used tables and minimize performance impact. Available free disk space can affect table ranking; see <a href="./expand-planning.html">Managing Redistribution in Large-Scale WarehousePG clusters</a>.</p><p>To rank tables for redistribution by updating <code>rank</code> values in <em><a href="./../../ref_guide/system_catalogs/gp_expansion_tables.html">gpexpand.status_detail</a></em>, connect to WarehousePG using <code>psql</code> or another supported client. Update <em>gpexpand.status_detail</em> with commands such as:</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>=&gt; UPDATE gpexpand.status_detail SET rank=10;</span></span>
<span class="line"><span></span></span>
<span class="line"><span>=&gt; UPDATE gpexpand.status_detail SET rank=1 WHERE fq_name = &#39;public.lineitem&#39;;</span></span>
<span class="line"><span>=&gt; UPDATE gpexpand.status_detail SET rank=2 WHERE fq_name = &#39;public.orders&#39;;</span></span></code></pre></div><p>These commands lower the priority of all tables to <code>10</code> and then assign a rank of <code>1</code> to <code>lineitem</code> and a rank of <code>2</code> to <code>orders</code>. When table redistribution begins, <code>lineitem</code> is redistributed first, followed by <code>orders</code> and all other tables in <em>gpexpand.status_detail</em>. To exclude a table from redistribution, remove the table from the <em>gpexpand.status_detail</em> table.</p><h2 id="redistributing-tables-using-gpexpand" tabindex="-1"><a id="topic30"></a>Redistributing Tables Using gpexpand <a class="header-anchor" href="#redistributing-tables-using-gpexpand" aria-label="Permalink to &quot;&lt;a id=&quot;topic30&quot;&gt;&lt;/a&gt;Redistributing Tables Using gpexpand&quot;">​</a></h2><h3 id="to-redistribute-tables-with-gpexpand" tabindex="-1"><a id="no162282"></a>To redistribute tables with gpexpand <a class="header-anchor" href="#to-redistribute-tables-with-gpexpand" aria-label="Permalink to &quot;&lt;a id=&quot;no162282&quot;&gt;&lt;/a&gt;To redistribute tables with gpexpand&quot;">​</a></h3><ol><li><p>Log in on the coordinator host as the user who will run your WarehousePG cluster, for example, <code>gpadmin</code>.</p></li><li><p>Run the <code>gpexpand</code> utility. You can use the <code>-d</code> or <code>-e</code> option to define the expansion session time period. For example, to run the utility for up to 60 consecutive hours:</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>$ gpexpand -d 60:00:00</span></span></code></pre></div><p>The utility redistributes tables until the last table in the schema completes or it reaches the specified duration or end time. <code>gpexpand</code> updates the status and time in <em><a href="./../../ref_guide/system_catalogs/gp_expansion_status.html">gpexpand.status</a></em> when a session starts and finishes.</p></li></ol><blockquote><p><strong>Note</strong> After completing table redistribution, run the <code>VACUUM ANALYZE</code> and <code>REINDEX</code>commands on the catalog tables to update table statistics, and rebuild indexes. See <a href="./../managing/maintain.html">Routine Vacuum and Analyze</a> in the <em>Administration Guide</em> and <a href="./../../ref_guide/sql_commands/VACUUM.html#er20941"><code>VACUUM</code></a> in the <em>Reference Guide</em>.</p></blockquote><h2 id="monitoring-table-redistribution" tabindex="-1"><a id="topic31"></a>Monitoring Table Redistribution <a class="header-anchor" href="#monitoring-table-redistribution" aria-label="Permalink to &quot;&lt;a id=&quot;topic31&quot;&gt;&lt;/a&gt;Monitoring Table Redistribution&quot;">​</a></h2><p>During the table redistribution process you can query the expansion schema to view:</p><ul><li>a current progress summary, the estimated rate of table redistribution, and the estimated time to completion. Use <em><a href="./../../ref_guide/system_catalogs/catalog_ref-views.html#gpexpandexpansion_progress">gpexpand.expansion_progress</a></em>, as described in <a href="#topic32">Viewing Expansion Status</a>.</li><li>per-table status information, using <em><a href="./../../ref_guide/system_catalogs/gp_expansion_tables.html">gpexpand.status_detail</a></em>. See <a href="#topic33">Viewing Table Status</a>.</li></ul><p>See also <a href="./expand-initialize.html">Monitoring the Cluster Expansion State</a> for information about monitoring the overall expansion progress with the <code>gpstate</code> utility.</p><h3 id="viewing-expansion-status" tabindex="-1"><a id="topic32"></a>Viewing Expansion Status <a class="header-anchor" href="#viewing-expansion-status" aria-label="Permalink to &quot;&lt;a id=&quot;topic32&quot;&gt;&lt;/a&gt;Viewing Expansion Status&quot;">​</a></h3><p>After the first table completes redistribution, <em>gpexpand.expansion_progress</em> calculates its estimates and refreshes them based on all tables&#39; redistribution rates. Calculations restart each time you start a table redistribution session with <code>gpexpand</code>. To monitor progress, connect to WarehousePG using <code>psql</code> or another supported client; query <em>gpexpand.expansion_progress</em> with a command like the following:</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>=# SELECT * FROM gpexpand.expansion_progress;</span></span>
<span class="line"><span>             name             |         value</span></span>
<span class="line"><span>------------------------------+-----------------------</span></span>
<span class="line"><span> Bytes Left                   | 5534842880</span></span>
<span class="line"><span> Bytes Done                   | 142475264</span></span>
<span class="line"><span> Estimated Expansion Rate     | 680.75667095996092 MB/s</span></span>
<span class="line"><span> Estimated Time to Completion | 00:01:01.008047</span></span>
<span class="line"><span> Tables Expanded              | 4</span></span>
<span class="line"><span> Tables Left                  | 4</span></span>
<span class="line"><span>(6 rows)</span></span></code></pre></div><h3 id="viewing-table-status" tabindex="-1"><a id="topic33"></a>Viewing Table Status <a class="header-anchor" href="#viewing-table-status" aria-label="Permalink to &quot;&lt;a id=&quot;topic33&quot;&gt;&lt;/a&gt;Viewing Table Status&quot;">​</a></h3><p>The table <em>gpexpand.status_detail</em> stores status, time of last update, and more facts about each table in the schema. To see a table&#39;s status, connect to WarehousePG using <code>psql</code> or another supported client and query <em>gpexpand.status_detail</em>:</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>=&gt; SELECT status, expansion_started, source_bytes FROM</span></span>
<span class="line"><span>gpexpand.status_detail WHERE fq_name = &#39;public.sales&#39;;</span></span>
<span class="line"><span>  status   |     expansion_started      | source_bytes</span></span>
<span class="line"><span>-----------+----------------------------+--------------</span></span>
<span class="line"><span> COMPLETED | 2017-02-20 10:54:10.043869 |   4929748992</span></span>
<span class="line"><span>(1 row)</span></span></code></pre></div>`,27)]))}const g=a(n,[["render",o]]);export{h as __pageData,g as default};

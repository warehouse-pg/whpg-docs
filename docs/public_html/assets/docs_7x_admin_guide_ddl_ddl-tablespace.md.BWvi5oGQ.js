import{_ as e,c as s,o as t,ag as o}from"./chunks/framework.Ds6Eueu6.js";const b=JSON.parse('{"title":"Creating and Managing Tablespaces","description":"","frontmatter":{},"headers":[],"relativePath":"docs/7x/admin_guide/ddl/ddl-tablespace.md","filePath":"docs/7x/admin_guide/ddl/ddl-tablespace.md"}'),n={name:"docs/7x/admin_guide/ddl/ddl-tablespace.md"};function p(i,a,c,l,d,r){return t(),s("div",null,a[0]||(a[0]=[o(`<h1 id="creating-and-managing-tablespaces" tabindex="-1">Creating and Managing Tablespaces <a class="header-anchor" href="#creating-and-managing-tablespaces" aria-label="Permalink to &quot;Creating and Managing Tablespaces&quot;">​</a></h1><hr><p>Tablespaces allow database administrators to have multiple file systems per machine and decide how to best use physical storage to store database objects. Tablespaces allow you to assign different storage for frequently and infrequently used database objects or to control the I/O performance on certain database objects. For example, place frequently-used tables on file systems that use high performance solid-state drives (SSD), and place other tables on standard hard drives.</p><p>A tablespace requires a host file system location to store its database files. In WarehousePG, the file system location must exist on all hosts including the hosts running the coordinator, standby coordinator, each primary segment, and each mirror segment.</p><p>A tablespace is WarehousePG cluster object (a global object), you can use a tablespace from any database if you have appropriate privileges.</p><blockquote><p><strong>Note</strong> WarehousePG does not support different tablespace locations for a primary-mirror pair with the same content ID. It is only possible to configure different locations for different content IDs. Do not modify symbolic links under the <code>pg_tblspc</code> directory so that primary-mirror pairs point to different file locations; this will lead to erroneous behavior.</p></blockquote><p><strong>Parent topic:</strong> <a href="./../ddl/ddl.html">DDL: Defining Database Objects</a></p><h2 id="creating-a-tablespace" tabindex="-1"><a id="topic13"></a>Creating a Tablespace <a class="header-anchor" href="#creating-a-tablespace" aria-label="Permalink to &quot;&lt;a id=&quot;topic13&quot;&gt;&lt;/a&gt;Creating a Tablespace&quot;">​</a></h2><p>The <code>CREATE TABLESPACE</code> command defines a tablespace. For example:</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>CREATE TABLESPACE fastspace LOCATION &#39;/fastdisk/gpdb&#39;;</span></span></code></pre></div><p>Database superusers define tablespaces and grant access to database users with the <code>GRANT\`\`CREATE</code>command. For example:</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>GRANT CREATE ON TABLESPACE fastspace TO admin;</span></span></code></pre></div><h2 id="using-a-tablespace-to-store-database-objects" tabindex="-1"><a id="topic14"></a>Using a Tablespace to Store Database Objects <a class="header-anchor" href="#using-a-tablespace-to-store-database-objects" aria-label="Permalink to &quot;&lt;a id=&quot;topic14&quot;&gt;&lt;/a&gt;Using a Tablespace to Store Database Objects&quot;">​</a></h2><p>Users with the <code>CREATE</code> privilege on a tablespace can create database objects in that tablespace, such as tables, indexes, and databases. The command is:</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>CREATE TABLE tablename(options) TABLESPACE spacename</span></span></code></pre></div><p>For example, the following command creates a table in the tablespace <em>space1</em>:</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>CREATE TABLE foo(i int) TABLESPACE space1;</span></span></code></pre></div><p>You can also use the <code>default_tablespace</code> parameter to specify the default tablespace for <code>CREATE TABLE</code> and <code>CREATE INDEX</code> commands that do not specify a tablespace:</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>SET default_tablespace = space1;</span></span>
<span class="line"><span>CREATE TABLE foo(i int);</span></span></code></pre></div><p>There is also the <code>temp_tablespaces</code> configuration parameter, which determines the placement of temporary tables and indexes, as well as temporary files that are used for purposes such as sorting large data sets. This can be a comma-separate list of tablespace names, rather than only one, so that the load associated with temporary objects can be spread over multiple tablespaces. A random member of the list is picked each time a temporary object is to be created.</p><p>The tablespace associated with a database stores that database&#39;s system catalogs, temporary files created by server processes using that database, and is the default tablespace selected for tables and indexes created within the database, if no <code>TABLESPACE</code> is specified when the objects are created. If you do not specify a tablespace when you create a database, the database uses the same tablespace used by its template database.</p><p>You can use a tablespace from any database in the WarehousePG cluster if you have appropriate privileges.</p><h2 id="viewing-existing-tablespaces" tabindex="-1"><a id="topic15"></a>Viewing Existing Tablespaces <a class="header-anchor" href="#viewing-existing-tablespaces" aria-label="Permalink to &quot;&lt;a id=&quot;topic15&quot;&gt;&lt;/a&gt;Viewing Existing Tablespaces&quot;">​</a></h2><p>Every WarehousePG cluster has the following default tablespaces.</p><ul><li><code>pg_global</code> for shared system catalogs.</li><li><code>pg_default</code>, the default tablespace. Used by the <em>template1</em> and <em>template0</em> databases.</li></ul><p>These tablespaces use the default system location, the data directory locations created at system initialization.</p><p>To see tablespace information, use the <code>pg_tablespace</code> catalog table to get the object ID (OID) of the tablespace and then use <code>gp_tablespace_location()</code> function to display the tablespace directories. This is an example that lists one user-defined tablespace, <code>myspace</code>:</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>SELECT oid, * FROM pg_tablespace ;</span></span>
<span class="line"><span></span></span>
<span class="line"><span>  oid  |  spcname   | spcowner | spcacl | spcoptions</span></span>
<span class="line"><span>-------+------------+----------+--------+------------</span></span>
<span class="line"><span>  1663 | pg_default |       10 |        |</span></span>
<span class="line"><span>  1664 | pg_global  |       10 |        |</span></span>
<span class="line"><span> 16391 | myspace    |       10 |        |</span></span>
<span class="line"><span>(3 rows)</span></span></code></pre></div><p>The OID for the tablespace <code>myspace</code> is <code>16391</code>. Run <code>gp_tablespace_location()</code> to display the tablespace locations for a system that consists of two segment instances and the coordinator.</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span># SELECT * FROM gp_tablespace_location(16391);</span></span>
<span class="line"><span> gp_segment_id |    tblspc_loc</span></span>
<span class="line"><span>---------------+------------------</span></span>
<span class="line"><span>             0 | /data/mytblspace</span></span>
<span class="line"><span>             1 | /data/mytblspace</span></span>
<span class="line"><span>            -1 | /data/mytblspace</span></span>
<span class="line"><span>(3 rows)</span></span></code></pre></div><p>This query uses <code>gp_tablespace_location()</code> the <code>gp_segment_configuration</code> catalog table to display segment instance information with the file system location for the <code>myspace</code> tablespace.</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>WITH spc AS (SELECT * FROM  gp_tablespace_location(16391))</span></span>
<span class="line"><span>  SELECT seg.role, spc.gp_segment_id as seg_id, seg.hostname, seg.datadir, tblspc_loc </span></span>
<span class="line"><span>    FROM spc, gp_segment_configuration AS seg </span></span>
<span class="line"><span>    WHERE spc.gp_segment_id = seg.content ORDER BY seg_id;</span></span></code></pre></div><p>This is information for a test system that consists of two segment instances and the coordinator on a single host.</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span> role | seg_id | hostname |       datadir        |    tblspc_loc</span></span>
<span class="line"><span>------+--------+----------+----------------------+------------------</span></span>
<span class="line"><span> p    |     -1 | testhost | /data/coordinator/gpseg-1 | /data/mytblspace</span></span>
<span class="line"><span> p    |      0 | testhost | /data/data1/gpseg0   | /data/mytblspace</span></span>
<span class="line"><span> p    |      1 | testhost | /data/data2/gpseg1   | /data/mytblspace</span></span>
<span class="line"><span>(3 rows)</span></span></code></pre></div><h2 id="dropping-tablespaces" tabindex="-1"><a id="topic16"></a>Dropping Tablespaces <a class="header-anchor" href="#dropping-tablespaces" aria-label="Permalink to &quot;&lt;a id=&quot;topic16&quot;&gt;&lt;/a&gt;Dropping Tablespaces&quot;">​</a></h2><p>To drop a tablespace, you must be the tablespace owner or a superuser. You cannot drop a tablespace until all objects in all databases using the tablespace are removed.</p><p>The <code>DROP TABLESPACE</code> command removes an empty tablespace.</p><blockquote><p><strong>Note</strong> You cannot drop a tablespace if it is not empty or if it stores temporary or transaction files.</p></blockquote><h2 id="moving-the-location-of-temporary-or-transaction-files" tabindex="-1"><a id="topic11"></a>Moving the Location of Temporary or Transaction Files <a class="header-anchor" href="#moving-the-location-of-temporary-or-transaction-files" aria-label="Permalink to &quot;&lt;a id=&quot;topic11&quot;&gt;&lt;/a&gt;Moving the Location of Temporary or Transaction Files&quot;">​</a></h2><p>You can move temporary or transaction files to a specific tablespace to improve database performance when running queries, creating backups, and to store data more sequentially.</p><p>The WarehousePG server configuration parameter <code>temp_tablespaces</code> controls the location for both temporary tables and temporary spill files for hash aggregate and hash join queries. Temporary files for purposes such as sorting large data sets are also created in these tablespaces.</p><p><code>temp_tablespaces</code> specifies tablespaces in which to create temporary objects (temp tables and indexes on temp tables) when a <code>CREATE</code> command does not explicitly specify a tablespace.</p><p>Also note the following information about temporary or transaction files:</p><ul><li>You can dedicate only one tablespace for temporary or transaction files, although you can use the same tablespace to store other types of files.</li><li>You cannot drop a tablespace if it used by temporary files.</li></ul>`,44)]))}const g=e(n,[["render",p]]);export{b as __pageData,g as default};

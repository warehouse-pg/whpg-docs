import{_ as a,c as s,o as t,ag as o}from"./chunks/framework.Ds6Eueu6.js";const u=JSON.parse('{"title":"advanced_password_check","description":"","frontmatter":{},"headers":[],"relativePath":"docs/7x/ref_guide/modules/adv_passwd_check.md","filePath":"docs/7x/ref_guide/modules/adv_passwd_check.md"}'),n={name:"docs/7x/ref_guide/modules/adv_passwd_check.md"};function d(i,e,r,p,c,l){return t(),s("div",null,e[0]||(e[0]=[o(`<h1 id="advanced-password-check" tabindex="-1">advanced_password_check <a class="header-anchor" href="#advanced-password-check" aria-label="Permalink to &quot;advanced_password_check&quot;">​</a></h1><hr><p>The <code>advanced_password_check</code> module allows you to strengthen password policies for WarehousePG. It is based on the <code>passwordcheck_extra</code> module, which enhances the PostgreSQL <code>passwordcheck</code> module to support user-defined policies to strengthen <code>passwordcheck</code>&#39;s minimum password requirements.</p><h2 id="loading-the-module" tabindex="-1"><a id="topic_reg"></a>Loading the Module <a class="header-anchor" href="#loading-the-module" aria-label="Permalink to &quot;&lt;a id=&quot;topic_reg&quot;&gt;&lt;/a&gt;Loading the Module&quot;">​</a></h2><p>The <code>advanced_password_check</code> module provides no SQL-accessible functions. To use it, enable the extension as a preloaded library and restart WarehousePG:</p><p>First, check if there are any preloaded shared libraries by running the following command:</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>gpconfig -s shared_preload_libraries</span></span></code></pre></div><p>Use the output of the above command to enable the <code>advanced_password_check</code> module, along any other shared libraries, and restart WarehousePG:</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>gpconfig -c shared_preload_libraries -v &#39;&lt;other_libraries&gt;,advanced_password_check&#39;</span></span>
<span class="line"><span>gpstop -ar</span></span></code></pre></div><p>Finally, install the extension in your database:</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>CREATE EXTENSION advanced_password_check;</span></span></code></pre></div><h2 id="using-the-advanced-password-check-module" tabindex="-1"><a id="topic_using"></a>Using the advanced_password_check Module <a class="header-anchor" href="#using-the-advanced-password-check-module" aria-label="Permalink to &quot;&lt;a id=&quot;topic_using&quot;&gt;&lt;/a&gt;Using the advanced\\_password\\_check Module&quot;">​</a></h2><p><code>advanced_password_check</code> is a WarehousePG module that you can enable and configure to check password strings against one or more user-defined policies. You can configure policies that:</p><ul><li>Set a minimum password string length.</li><li>Set a maximum password string length.</li><li>Set a maximum password age before the password expires.</li><li>Set rules for reusing an old password: the number of days or the number of previous passwords before a user can reuse a password.</li><li>Set the maximum number of failed login attempts before a user is locked, and the number of minutes the user remains locked.</li><li>Define a custom list of special characters.</li><li>Define rules for special character, upper/lower case character, and number inclusion in the password string.</li><li>Use UDFs to manage an exception list for each feature so certain users can bypass the current restrictions.</li></ul><p>The <code>advanced_password_check</code> module defines server configuration parameters that you set to configure password setting policies. These parameters include:</p><table tabindex="0"><thead><tr><th>Parameter Name</th><th>Type</th><th>Default Value</th><th>Description</th></tr></thead><tbody><tr><td>minimum_length</td><td>int</td><td>8</td><td>The minimum allowable length of a WarehousePG password.</td></tr><tr><td>maximum_length</td><td>int</td><td>15</td><td>The maximum allowable length of a WarehousePG password.</td></tr><tr><td>special_chars</td><td>string</td><td>!@#$%^&amp;*()_+{}|&lt;&gt;?=</td><td>The set of characters that WarehousePG considers to be special characters in a password.</td></tr><tr><td>restrict_upper</td><td>bool</td><td>true</td><td>Specifies whether or not the password string must contain at least one upper case character.</td></tr><tr><td>restrict_lower</td><td>bool</td><td>true</td><td>Specifies whether or not the password string must contain at least one lower case character.</td></tr><tr><td>restrict_numbers</td><td>bool</td><td>true</td><td>Specifies whether or not the password string must contain at least one number.</td></tr><tr><td>restrict_special</td><td>bool</td><td>true</td><td>Specifies whether or not the password string must contain at least one special character.</td></tr><tr><td>password_login_attempts</td><td>int</td><td>0</td><td>The number of consecutive failed login attempts before a user is locked. If set to 0, this feature is disabled.</td></tr><tr><td>password_max_age</td><td>int</td><td>0</td><td>The maximum number of days before the password expires. If set to 0, the password does not expire.</td></tr><tr><td>password_reuse_days</td><td>int</td><td>0</td><td>The number of days before a user can reuse a password. If set to 0, the user can reuse any password.</td></tr><tr><td>password_reuse_history</td><td>int</td><td>0</td><td>The number of previous passwords a user cannot reuse. If set to 0, the user can reuse any password.</td></tr><tr><td>lockout_duration</td><td>int</td><td>0</td><td>The number of minutes a user is locked after reaching password_login_attempts. If set to 0, the user is locked indefinitely.</td></tr></tbody></table><p>After you define your password policies, you run the <code>gpconfig</code> command for each configuration parameter that you must set. When you run the command, you must qualify the parameter with the module name. For example, to configure WarehousePG to remove any requirements for a lower case letter in the password string, you run the following command:</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>gpconfig -c advanced_password_check.restrict_lower -v false</span></span></code></pre></div><p>After you set or change module configuration in this manner, you must reload the WarehousePG configuration:</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>gpstop -u</span></span></code></pre></div><p>The <code>advanced_password_check</code> module provides the following user-defined functions (UDF). Specify all function arguments as single-quoted strings.</p><table tabindex="0"><thead><tr><th>Function Signature</th><th>Arguments</th><th>Description</th></tr></thead><tbody><tr><td><code>manage_exception_list(action, role_name, exception_type)</code></td><td>- <code>action</code> can be <code>add</code>, <code>remove</code>, or <code>show</code>. <br>- <code>role_name</code><br>- <code>exception_type</code> can be <code>password_max_age</code>, <code>password_reuse_days</code>, <code>password_reuse_history</code>, or <code>password_login_attempts</code>.</td><td>Adds, removes, and shows roles in the exception list for a policy.</td></tr><tr><td><code>unblock_account(role_name)</code></td><td><code>role_name</code></td><td>Unblocks a role</td></tr><tr><td><code>status()</code></td><td></td><td>Lists active password policies.</td></tr></tbody></table><p>Use the <code>manage_exception_list()</code> function to manage the exception list for a password policy. WarehousePG does not enforce the rules set for the policy for any users specified in the exception list. The function takes three arguments: the action to take, the role name and the name of the exception. The value of <code>action</code> can be <code>add</code>, <code>remove</code>, or <code>show</code>. The value of <code>exception_type</code> can be <code>password_max_age</code>, <code>password_reuse_days</code>, <code>password_reuse_history</code>, <code>password_login_attempts</code>, or an empty string to represent all of the available exception types. When the action is <code>show</code>, you may specify <code>role_name</code> as an empty string to include all roles.</p><p>For example, to add the role <code>user1</code> to the exception list for <code>password_max_age</code>, so the role does not have a password expiration date:</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>SELECT advanced_password_check.manage_exception_list(&#39;add&#39;, &#39;user1&#39;, &#39;password_max_age&#39;);</span></span>
<span class="line"><span></span></span>
<span class="line"><span>role_id | role_name | exception_type </span></span>
<span class="line"><span>---------+-----------+---------------- </span></span>
<span class="line"><span>(0 rows)</span></span></code></pre></div><p>The following example checks all exception lists for all roles:</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>SELECT * FROM advanced_password_check.manage_exception_list(&#39;show&#39;,&#39;&#39;, &#39;&#39;); </span></span>
<span class="line"><span></span></span>
<span class="line"><span>role_id | role_name |     exception_type </span></span>
<span class="line"><span>---------+-----------+------------------------- </span></span>
<span class="line"><span>1826266 | user1     | password_max_age </span></span>
<span class="line"><span>1826267 | user2     | password_reuse_history </span></span>
<span class="line"><span>1826266 | user1     | password_reuse_days </span></span>
<span class="line"><span>1826266 | user1     | password_login_attempts </span></span>
<span class="line"><span>(4 rows)</span></span></code></pre></div><p>Use the <code>unblock_account_role()</code> function to manually unblock a user that reached the limit set by the configuration parameter <code>password_login_attempts</code>. For example:</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>SELECT * FROM advanced_password_check.unblock_account(&#39;user1&#39;); </span></span>
<span class="line"><span></span></span>
<span class="line"><span>unblock_account </span></span>
<span class="line"><span>----------------- </span></span>
<span class="line"><span>(1 row)</span></span></code></pre></div><p>Use the <code>status()</code> function to view the values of all active password policies. For example:</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>SELECT * FROM advanced_password_check.status(); </span></span>
<span class="line"><span></span></span>
<span class="line"><span>           guc           |        value </span></span>
<span class="line"><span>-------------------------+--------------------- </span></span>
<span class="line"><span>special_chars           | !@#$%^&amp;*()_+{}|&lt;&gt;?= </span></span>
<span class="line"><span>restrict_lower          | t </span></span>
<span class="line"><span>restrict_upper          | t </span></span>
<span class="line"><span>restrict_numbers        | t </span></span>
<span class="line"><span>restrict_special        | t </span></span>
<span class="line"><span>minimum_length          | 8 </span></span>
<span class="line"><span>maximum_length          | 15 </span></span>
<span class="line"><span>password_max_age        | 192 </span></span>
<span class="line"><span>password_reuse_days     | 0 </span></span>
<span class="line"><span>password_reuse_history  | 0 </span></span>
<span class="line"><span>password_login_attempts | 0 </span></span>
<span class="line"><span>lockout_duration        | 0 </span></span>
<span class="line"><span>(12 rows)</span></span></code></pre></div><blockquote><p><strong>Note</strong> The password history information is stored in the WarehousePG coordinator host only. In the event of a primary coordinator failure, if you activate the standby coordinator host, the <code>advanced_password_check</code> module will not be able to access the password history information, and it will affect any server configuration parameters or UDFs that involve password history information. For example, a role may reuse a password even if the <code>password_reuse_history</code> is set, as there is no information about previous passwords. If you switch back to the original coordinator host, unless there is data corruption, the password history information will be accessible again.</p></blockquote><h2 id="example" tabindex="-1"><a id="topic_example"></a>Example <a class="header-anchor" href="#example" aria-label="Permalink to &quot;&lt;a id=&quot;topic_example&quot;&gt;&lt;/a&gt;Example&quot;">​</a></h2><p>Suppose that you have defined the following password policies:</p><ul><li>The password must contain a minimum of 10 characters and a maximum of 18.</li><li>The password must contain a mixture of upper case and lower case characters.</li><li>The password must contain at least one of the default special characters.</li><li>The are no requirements that the password contain a number.</li><li>The password must not be the same as the current password.</li><li>The password must expire after three months.</li><li>The user must be blocked during an hour after the third of three unsuccessful login attempts.</li></ul><p>You would run the following commands to configure WarehousePG to enforce these policies:</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>gpconfig -c advanced_password_check.minimum_length -v 10</span></span>
<span class="line"><span>gpconfig -c advanced_password_check.maximum_length -v 18</span></span>
<span class="line"><span>gpconfig -c advanced_password_check.restrict_numbers -v false</span></span>
<span class="line"><span>gpconfig -c advanced_password_check.password_reuse_history -v 1</span></span>
<span class="line"><span>gpconfig -c advanced_password_check.password_max_age -v 90</span></span>
<span class="line"><span>gpconfig -c advanced_password_check.password_login_attempts -v 3</span></span>
<span class="line"><span>gpconfig -c advanced_password_check.lockout_duration -v 60</span></span>
<span class="line"><span>gpstop -u</span></span></code></pre></div><p>After loading the new configuration, passwords that the WarehousePG superuser sets must now follow the policies, and WarehousePG returns an error for every policy that is not met. Note that WarehousePG checks the password string against all of the policies, and concatenates together the messages for any errors that it encounters. For example (line breaks added for better viewability):</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span># testdb=# CREATE role r1 PASSWORD &#39;12345678901112&#39;;</span></span>
<span class="line"><span>ERROR:  Incorrect password format: lower-case character missing, upper-case character</span></span>
<span class="line"><span>missing, special character missing (needs to be one listed in &quot;&lt;list-of-special-chars&gt;&quot;)</span></span></code></pre></div><h2 id="upgrading-the-module" tabindex="-1"><a id="topic_upgrade"></a>Upgrading the Module <a class="header-anchor" href="#upgrading-the-module" aria-label="Permalink to &quot;&lt;a id=&quot;topic_upgrade&quot;&gt;&lt;/a&gt;Upgrading the Module&quot;">​</a></h2><p>You may upgrade the module from a previous version by following the steps below.</p><ol><li><p>Check your existing version of the module by running <code>\\dx</code> from your database.</p></li><li><p>Verify that <code>advanced_password_check</code> is listed as one of the preloaded shared libraries by running the following command:</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>gpconfig -s shared_preload_libraries</span></span></code></pre></div></li><li><p>Update the extension from your database prompt. The following example upgrades to version 1.2:</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>ALTER EXTENSION advanced_password_check UPDATE TO ‘1.2’;</span></span></code></pre></div></li></ol><h2 id="additional-module-documentation" tabindex="-1"><a id="topic_info"></a>Additional Module Documentation <a class="header-anchor" href="#additional-module-documentation" aria-label="Permalink to &quot;&lt;a id=&quot;topic_info&quot;&gt;&lt;/a&gt;Additional Module Documentation&quot;">​</a></h2><p>Refer to the <a href="https://www.postgresql.org/docs/9.4/passwordcheck.html" target="_blank" rel="noreferrer">passwordcheck</a> PostgreSQL documentation for more information about this module.</p>`,44)]))}const m=a(n,[["render",d]]);export{u as __pageData,m as default};

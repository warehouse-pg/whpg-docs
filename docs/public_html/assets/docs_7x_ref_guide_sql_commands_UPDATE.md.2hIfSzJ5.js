import{_ as a,c as t,o as s,ag as o}from"./chunks/framework.Ds6Eueu6.js";const u=JSON.parse('{"title":"UPDATE","description":"","frontmatter":{},"headers":[],"relativePath":"docs/7x/ref_guide/sql_commands/UPDATE.md","filePath":"docs/7x/ref_guide/sql_commands/UPDATE.md"}'),n={name:"docs/7x/ref_guide/sql_commands/UPDATE.md"};function i(c,e,l,d,p,r){return s(),t("div",null,e[0]||(e[0]=[o(`<h1 id="update" tabindex="-1">UPDATE <a class="header-anchor" href="#update" aria-label="Permalink to &quot;UPDATE&quot;">​</a></h1><p>Updates rows of a table.</p><h2 id="synopsis" tabindex="-1"><a id="section2"></a>Synopsis <a class="header-anchor" href="#synopsis" aria-label="Permalink to &quot;&lt;a id=&quot;section2&quot;&gt;&lt;/a&gt;Synopsis&quot;">​</a></h2><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>[ WITH [ RECURSIVE ] &lt;with_query&gt; [, ...] ]</span></span>
<span class="line"><span>UPDATE [ ONLY ] &lt;table_name&gt; [ [ AS ] &lt;alias&gt; ]</span></span>
<span class="line"><span>   SET { &lt;column_name&gt; = { &lt;expression&gt; | DEFAULT } |</span></span>
<span class="line"><span>       ( &lt;column_name&gt; [, ...] ) = [ ROW ] ( { &lt;expression&gt; | DEFAULT } [, ...] ) |</span></span>
<span class="line"><span>       ( &lt;column_name&gt; [, ...] ) = ( &lt;sub-SELECT&gt; )</span></span>
<span class="line"><span>       } [, ...]</span></span>
<span class="line"><span>   [ FROM &lt;from_item&gt; [, ...] ]</span></span>
<span class="line"><span>   [ WHERE &lt;condition&gt; | WHERE CURRENT OF &lt;cursor_name&gt; ]</span></span>
<span class="line"><span>   [ RETURNING * | &lt;output_expression&gt; [ [AS] &lt;output_name&gt; ] [, ...] ]</span></span></code></pre></div><h2 id="description" tabindex="-1"><a id="section3"></a>Description <a class="header-anchor" href="#description" aria-label="Permalink to &quot;&lt;a id=&quot;section3&quot;&gt;&lt;/a&gt;Description&quot;">​</a></h2><p><code>UPDATE</code> changes the values of the specified columns in all rows that satisfy the condition. Only the columns to be modified need be mentioned in the <code>SET</code> clause; columns not explicitly modified retain their previous values.</p><p>There are two ways to modify a table using information contained in other tables in the database: using sub-selects, or specifying additional tables in the <code>FROM</code> clause. Which technique is more appropriate depends on the specific circumstances.</p><p>The optional <code>RETURNING</code> clause causes <code>UPDATE</code> to compute and return value(s) based on each row actually updated. WarehousePG can compute any expression using the table&#39;s columns, and/or columns of other tables mentioned in <code>FROM</code>. The new (post-update) values of the table&#39;s columns are used. The syntax of the <code>RETURNING</code> list is identical to that of the output list of <code>SELECT</code>.</p><p>You must have the <code>UPDATE</code> privilege on the table, or at least on the column(s) that are listed to be updated. You must also have the <code>SELECT</code> privilege on any column whose values are read in the expressions or condition.</p><blockquote><p><strong>Note</strong> As the default, WarehousePG acquires an <code>EXCLUSIVE</code> lock on tables for <code>UPDATE</code> operations on heap tables. When the Global Deadlock Detector is enabled, the lock mode for <code>UPDATE</code> operations on heap tables is <code>ROW EXCLUSIVE</code>. See <a href="./../../admin_guide/dml.html#topic_gdd">Global Deadlock Detector</a>.</p></blockquote><h2 id="parameters" tabindex="-1"><a id="section5"></a>Parameters <a class="header-anchor" href="#parameters" aria-label="Permalink to &quot;&lt;a id=&quot;section5&quot;&gt;&lt;/a&gt;Parameters&quot;">​</a></h2><p>with_query : The <code>WITH</code> clause allows you to specify one or more subqueries that can be referenced by name in the <code>UPDATE</code> query. See <a href="./../../admin_guide/query/topics/CTE-query.html#topic_zhs_r1s_w1b">WITH Queries (Common Table Expressions)</a> and <a href="./SELECT.html">SELECT</a> for details.</p><p>: For an <code>UPDATE</code> command that includes a <code>WITH</code> clause, the clause can only contain <code>SELECT</code> commands, the <code>WITH</code> clause cannot contain a data-modifying command (<code>INSERT</code>, <code>UPDATE</code>, or <code>DELETE</code>).</p><p>: It is possible for the query (<code>SELECT</code> statement) to also contain a <code>WITH</code> clause. In such a case both sets of with_query can be referenced within the <code>UPDATE</code> query, but the second one takes precedence since it is more closely nested.</p><p>table_name : The name (optionally schema-qualified) of the table to update. If <code>ONLY</code> is specified before the table name, matching rows are updated in the named table only. If <code>ONLY</code> is not specified, matching rows are also updated in any tables inheriting from the named table. Optionally, you can specify <code>*</code> after the table name to explicitly indicate that descendant tables are included.</p><p>alias : A substitute name for the target table. When an alias is provided, it completely hides the actual name of the table. For example, given <code>UPDATE foo AS f</code>, the remainder of the <code>UPDATE</code> statement must refer to this table as <code>f</code> not <code>foo</code>.</p><p>column_name : The name of a column in the table named by table_name. The column name can be qualified with a subfield name or array subscript, if needed. Do not include the table&#39;s name in the specification of a target column; for example, <code>UPDATE table_name SET table_name.col = 1</code> is invalid.</p><p>expression : An expression to assign to the column. The expression may use the old values of this and other columns in the table.</p><p>DEFAULT : Set the column to its default value (which will be NULL if no specific default expression has been assigned to it).</p><p>sub-SELECT : A <code>SELECT</code> sub-query that produces as many output columns as are listed in the parenthesized column list preceding it. The sub-query must yield no more than one row when executed. If it yields one row, its column values are assigned to the target columns; if it yields no rows, NULL values are assigned to the target columns. The sub-query can refer to old values of the current row of the table being updated.</p><p>from_item : A table expression allowing columns from other tables to appear in the <code>WHERE</code> condition and the update expressions. This uses the same syntax as the <code>FROM</code> clause of a <a href="./SELECT.html">SELECT</a> statement; for example, you can specify an alias for the table name. Do not repeat the target table as a from_item unless you intend a self-join (in which case it must appear with an alias in the from_item).</p><p>condition : An expression that returns a value of type <code>boolean</code>. Only rows for which this expression returns <code>true</code> will be updated.</p><p>cursor_name : The name of the cursor to use in a <code>WHERE CURRENT OF</code> condition. The row to be updated is the one most recently fetched from the cursor. The cursor must be a non-grouping query on the <code>UPDATE</code>&#39;s target table. Note that <code>WHERE CURRENT OF</code> cannot be specified together with a Boolean condition. See <a href="./DECLARE.html">DECLARE</a> for more information about using cursors with <code>WHERE CURRENT OF</code>.</p><p>: The <code>UPDATE...WHERE CURRENT OF</code> statement can only be run on the server, for example in an interactive psql session or a script. Language extensions such as PL/pgSQL do not have support for updatable cursors.</p><p>output_expression : An expression to be computed and returned by the <code>UPDATE</code> command after each row is updated. The expression may use any column names of the table named by table_name or table(s) listed in <code>FROM</code>. Write <code>*</code> to return all columns.</p><p>output_name : A name to use for a returned column.</p><h2 id="outputs" tabindex="-1"><a id="section5a"></a>Outputs <a class="header-anchor" href="#outputs" aria-label="Permalink to &quot;&lt;a id=&quot;section5a&quot;&gt;&lt;/a&gt;Outputs&quot;">​</a></h2><p>On successful completion, an <code>UPDATE</code> command returns a command tag of the form:</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>UPDATE &lt;count&gt;</span></span></code></pre></div><p>The count is the number of rows updated, including matched rows whose values did not change. If count is 0, no rows were updated by the query (this is not considered an error).</p><p>If the <code>UPDATE</code> command contains a <code>RETURNING</code> clause, the result will be similar to that of a <code>SELECT</code> statement containing the columns and values defined in the <code>RETURNING</code> list, computed over the row(s) updated by the command.</p><h2 id="notes" tabindex="-1"><a id="section6"></a>Notes <a class="header-anchor" href="#notes" aria-label="Permalink to &quot;&lt;a id=&quot;section6&quot;&gt;&lt;/a&gt;Notes&quot;">​</a></h2><p>When a <code>FROM</code> clause is present, the target table is joined to the tables mentioned in the from_item list, and each output row of the join represents an update operation for the target table. When using <code>FROM</code>, ensure that the join produces at most one output row for each row to be modified. In other words, a target row should not join to more than one row from the other table(s). If it does, then only one of the join rows will be used to update the target row, but which one will be used is not readily predictable.</p><p>Because of this indeterminacy, referencing other tables only within sub-selects is safer, though often harder to read and slower than using a join.</p><p>For a partitioned table, all of the child tables are locked during the <code>UPDATE</code> operation when the Global Deadlock Detector is not enabled (the default). Only some of the leaf child tables are locked when the Global Deadlock Detector is enabled. For information about the Global Deadlock Detector, see <a href="./../../admin_guide/dml.html#topic_gdd">Global Deadlock Detector</a>.</p><p>In the case of a partitioned table, updating a row might cause it to no longer satisfy the partition constraint of the containing partition. In that case, if there is some other partition in the partition tree for which this row satisfies its partition constraint, then the row is moved to that partition. If there is no such partition, an error will occur. Behind the scenes, the row movement is actually a <code>DELETE</code> and <code>INSERT</code> operation.</p><p>There is a possibility that a concurrent <code>UPDATE</code> or <code>DELETE</code> on the row being moved will generate a serialization failure error. Suppose session 1 is performing an <code>UPDATE</code> on a partition key, and meanwhile a concurrent session 2 for which this row is visible performs an <code>UPDATE</code> or <code>DELETE</code> operation on this row. In such case, session 2&#39;s <code>UPDATE</code> or <code>DELETE</code> will detect the row movement and raise a serialization failure error (which always returns with an SQLSTATE code &#39;40001&#39;). Applications may wish to retry the transaction if this occurs. In the usual case where the table is not partitioned, or where there is no row movement, session 2 would have identified the newly updated row and carried out the <code>UPDATE/DELETE</code> on this new row version.</p><p>Note that while rows can be moved from local partitions to a foreign-table partition (provided the foreign data wrapper supports tuple routing), they cannot be moved from a foreign-table partition to another partition.</p><h2 id="examples" tabindex="-1"><a id="section7"></a>Examples <a class="header-anchor" href="#examples" aria-label="Permalink to &quot;&lt;a id=&quot;section7&quot;&gt;&lt;/a&gt;Examples&quot;">​</a></h2><p>Change the word <code>Drama</code> to <code>Dramatic</code> in the column <code>kind</code> of the table <code>films</code>:</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>UPDATE films SET kind = &#39;Dramatic&#39; WHERE kind = &#39;Drama&#39;;</span></span></code></pre></div><p>Adjust temperature entries and reset precipitation to its default value in one row of the table <code>weather</code>:</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>UPDATE weather SET temp_lo = temp_lo+1, temp_hi = </span></span>
<span class="line"><span>temp_lo+15, prcp = DEFAULT</span></span>
<span class="line"><span>WHERE city = &#39;San Francisco&#39; AND date = &#39;2016-07-03&#39;;</span></span></code></pre></div><p>Perform the same operation and return the updated entries:</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>UPDATE weather SET temp_lo = temp_lo+1, temp_hi = temp_lo+15, prcp = DEFAULT</span></span>
<span class="line"><span>  WHERE city = &#39;San Francisco&#39; AND date = &#39;2003-07-03&#39;</span></span>
<span class="line"><span>  RETURNING temp_lo, temp_hi, prcp;</span></span></code></pre></div><p>Use the alternative column-list syntax to do the same update:</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>UPDATE weather SET (temp_lo, temp_hi, prcp) = (temp_lo+1, </span></span>
<span class="line"><span>temp_lo+15, DEFAULT)</span></span>
<span class="line"><span>WHERE city = &#39;San Francisco&#39; AND date = &#39;2016-07-03&#39;;</span></span></code></pre></div><p>Increment the sales count of the salesperson who manages the account for Acme Corporation, using the <code>FROM</code> clause syntax (assuming both tables being joined are distributed in WarehousePG on the <code>id</code> column):</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>UPDATE employees SET sales_count = sales_count + 1 FROM </span></span>
<span class="line"><span>accounts</span></span>
<span class="line"><span>WHERE accounts.name = &#39;Acme Corporation&#39;</span></span>
<span class="line"><span>AND employees.id = accounts.id;</span></span></code></pre></div><p>Perform the same operation, using a sub-select in the <code>WHERE</code> clause:</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>UPDATE employees SET sales_count = sales_count + 1 WHERE id =</span></span>
<span class="line"><span>  (SELECT id FROM accounts WHERE name = &#39;Acme Corporation&#39;);</span></span></code></pre></div><p>Update contact names in an <code>accounts</code> table to match the currently assigned salesmen:</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>UPDATE accounts SET (contact_first_name, contact_last_name) =</span></span>
<span class="line"><span>    (SELECT first_name, last_name FROM salesmen</span></span>
<span class="line"><span>     WHERE salesmen.id = accounts.sales_id);</span></span></code></pre></div><p>A similar result could be accomplished with a join:</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>UPDATE accounts SET contact_first_name = first_name,</span></span>
<span class="line"><span>                    contact_last_name = last_name</span></span>
<span class="line"><span>  FROM salesmen WHERE salesmen.id = accounts.sales_id;</span></span></code></pre></div><p>However, the second query may give unexpected results if <code>salesmen.id</code> is not a unique key, whereas the first query is guaranteed to raise an error if there are multiple <code>id</code> matches. Also, if there is no match for a particular <code>accounts.sales_id</code> entry, the first query will set the corresponding name fields to NULL, whereas the second query will not update that row at all.</p><p>Update statistics in a <code>summary</code> table to match the current data:</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>UPDATE summary s SET (sum_x, sum_y, avg_x, avg_y) =</span></span>
<span class="line"><span>    (SELECT sum(x), sum(y), avg(x), avg(y) FROM data d</span></span>
<span class="line"><span>     WHERE d.group_id = s.group_id);</span></span></code></pre></div><p>Attempt to insert a new stock item along with the quantity of stock. If the item already exists, instead update the stock count of the existing item. To do this without failing the entire transaction, use savepoints.</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>BEGIN;</span></span>
<span class="line"><span>-- other operations</span></span>
<span class="line"><span>SAVEPOINT sp1;</span></span>
<span class="line"><span>INSERT INTO wines VALUES(&#39;Chateau Lafite 2003&#39;, &#39;24&#39;);</span></span>
<span class="line"><span>-- Assume the above fails because of a unique key violation,</span></span>
<span class="line"><span>-- so now we issue these commands:</span></span>
<span class="line"><span>ROLLBACK TO sp1;</span></span>
<span class="line"><span>UPDATE wines SET stock = stock + 24 WHERE winename = &#39;Chateau </span></span>
<span class="line"><span>Lafite 2003&#39;;</span></span>
<span class="line"><span>-- continue with other operations, and eventually</span></span>
<span class="line"><span>COMMIT;</span></span></code></pre></div><h2 id="compatibility" tabindex="-1"><a id="section8"></a>Compatibility <a class="header-anchor" href="#compatibility" aria-label="Permalink to &quot;&lt;a id=&quot;section8&quot;&gt;&lt;/a&gt;Compatibility&quot;">​</a></h2><p>This command conforms to the SQL standard, except that the <code>FROM</code> and <code>RETURNING</code> clauses are WarehousePG extensions, as is the ability to use <code>WITH</code> with <code>UPDATE</code>.</p><p>Some other database systems offer a <code>FROM</code> option in which the target table is supposed to be listed again within <code>FROM</code>. That is not how WarehousePG interprets <code>FROM</code>. Be careful when porting applications that use this extension.</p><p>According to the standard, the source value for a parenthesized sub-list of target column names can be any row-valued expression yielding the correct number of columns. WarehousePG only allows the source value to be a <a href="https://www.postgresql.org/docs/12/sql-expressions.html#SQL-SYNTAX-ROW-CONSTRUCTORS" target="_blank" rel="noreferrer">row constructor</a> or a sub-<code>SELECT</code>. You can specify an individual column&#39;s updated value as <code>DEFAULT</code> in the row-constructor case, but not inside a sub-<code>SELECT</code>.</p><h2 id="see-also" tabindex="-1"><a id="section9"></a>See Also <a class="header-anchor" href="#see-also" aria-label="Permalink to &quot;&lt;a id=&quot;section9&quot;&gt;&lt;/a&gt;See Also&quot;">​</a></h2><p><a href="./DECLARE.html">DECLARE</a>, <a href="./DELETE.html">DELETE</a>, <a href="./SELECT.html">SELECT</a>, <a href="./INSERT.html">INSERT</a></p><p><strong>Parent topic:</strong> <a href="./../sql_commands/sql_ref.html">SQL Commands</a></p>`,67)]))}const m=a(n,[["render",i]]);export{u as __pageData,m as default};

import{_ as a,c as t,o as n,ag as s}from"./chunks/framework.Ds6Eueu6.js";const o="/assets/ext-tables-xml.REa2E3-Z.png",i="/assets/02-pipeline.Cz_0cDjn.png",p="/assets/03-gpload-files.Br2fCDT4.jpg",f=JSON.parse('{"title":"Transforming External Data with gpfdist and gpload","description":"","frontmatter":{},"headers":[],"relativePath":"docs/7x/admin_guide/load/topics/transforming-xml-data.md","filePath":"docs/7x/admin_guide/load/topics/transforming-xml-data.md"}'),l={name:"docs/7x/admin_guide/load/topics/transforming-xml-data.md"};function r(c,e,d,h,m,u){return n(),t("div",null,e[0]||(e[0]=[s('<h1 id="transforming-external-data-with-gpfdist-and-gpload" tabindex="-1">Transforming External Data with gpfdist and gpload <a class="header-anchor" href="#transforming-external-data-with-gpfdist-and-gpload" aria-label="Permalink to &quot;Transforming External Data with gpfdist and gpload&quot;">​</a></h1><hr><p>The <code>gpfdist</code> parallel file server allows you to set up transformations that enable WarehousePG external tables to read and write files in formats that are not supported with the <code>CREATE EXTERNAL TABLE</code> command&#39;s <code>FORMAT</code> clause. An <em>input</em> transformation reads a file in the foreign data format and outputs rows to <code>gpfdist</code> in the CSV or other text format specified in the external table&#39;s <code>FORMAT</code> clause. An <em>output</em> transformation receives rows from <code>gpfdist</code> in text format and converts them to the foreign data format.</p><blockquote><p><strong>Note</strong> <code>gpfdist</code> and <code>gpload</code> are compatible only with the WarehousePG major version in which they are shipped. For example, a <code>gpfdist</code> utility that is installed with WarehousePG 6.x cannot be used with WarehousePG 7.x.</p></blockquote><p>This topic describes the tasks to set up data transformations that work with <code>gpfdist</code> to read or write external data files with formats that WarehousePG does not support.</p><ul><li><a href="#topic_mdl_thm_pbb">About gpfdist Transformations</a></li><li><a href="#topic_el5_k12_pbb">Determine the Transformation Schema</a></li><li><a href="#topic77">Write a Transformation</a></li><li><a href="#topic78">Write the gpfdist Configuration File</a></li><li><a href="#topic80">Transfer the Data</a></li><li><a href="#topic83">Configuration File Format</a></li><li><a href="#topic91">XML Transformation Examples</a></li></ul><p><strong>Parent topic:</strong> <a href="./../../load/topics/g-loading-and-unloading-data.html">Loading and Unloading Data</a></p><h2 id="about-gpfdist-transformations" tabindex="-1"><a id="topic_mdl_thm_pbb"></a>About gpfdist Transformations <a class="header-anchor" href="#about-gpfdist-transformations" aria-label="Permalink to &quot;&lt;a id=&quot;topic_mdl_thm_pbb&quot;&gt;&lt;/a&gt;About gpfdist Transformations&quot;">​</a></h2><p>To set up a transformation for a data format, you provide an executable command that <code>gpfdist</code> can call with the name of the file containing data. For example, you could write a shell script that runs an XSLT transformation on an XML file to output rows with columns delimited with a vertical bar (<code>|</code>) character and rows delimited with linefeeds.</p><p>Transformations are configured in a YAML-formatted configuration file passed to <code>gpfdist</code> on the command line.</p><p>If you want to load the external data into a table in the WarehousePG, you can use the <code>gpload</code> utility to automate the tasks to create an external table, run <code>gpfdist</code>, and load the transformed data into the database table.</p><p>Accessing data in external XML files from within the database is a common example requiring transformation. The following diagram shows <em>gpfdist</em> performing a transformation on XML files on an ETL server.</p><p><img src="'+o+`" alt="External Tables using XML Transformations" title="External Tables using XML Transformations"></p><p>Following are the high-level steps to set up a <code>gpfdist</code> transformation for external data files. The process is illustrated with an XML example.</p><ol><li><a href="#topic_el5_k12_pbb">Determine the transformation schema</a>.</li><li><a href="#topic77">Write a transformation</a>.</li><li><a href="#topic78">Write the gpfdist configuration file</a>.</li><li><a href="#topic80">Transfer the data</a>.</li></ol><h2 id="determine-the-transformation-schema" tabindex="-1"><a id="topic_el5_k12_pbb"></a>Determine the Transformation Schema <a class="header-anchor" href="#determine-the-transformation-schema" aria-label="Permalink to &quot;&lt;a id=&quot;topic_el5_k12_pbb&quot;&gt;&lt;/a&gt;Determine the Transformation Schema&quot;">​</a></h2><p>To prepare for the transformation project:</p><ol><li>Determine the goal of the project, such as indexing data, analyzing data, combining data, and so on.</li><li>Examine the source files and note the file structure and element names.</li><li>Choose the elements to import and decide if any other limits are appropriate.</li></ol><p>For example, the following XML file, <em>prices.xml</em>, is a simple XML file that contains price records. Each price record contains two fields: an item number and a price.</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>&lt;?xml version=&quot;1.0&quot; encoding=&quot;ISO-8859-1&quot; ?&gt;</span></span>
<span class="line"><span>&lt;prices&gt;</span></span>
<span class="line"><span>  &lt;pricerecord&gt;</span></span>
<span class="line"><span>    &lt;itemnumber&gt;708421&lt;/itemnumber&gt;</span></span>
<span class="line"><span>    &lt;price&gt;19.99&lt;/price&gt;</span></span>
<span class="line"><span>  &lt;/pricerecord&gt;</span></span>
<span class="line"><span>  &lt;pricerecord&gt;</span></span>
<span class="line"><span>    &lt;itemnumber&gt;708466&lt;/itemnumber&gt;</span></span>
<span class="line"><span>    &lt;price&gt;59.25&lt;/price&gt;</span></span>
<span class="line"><span>  &lt;/pricerecord&gt;</span></span>
<span class="line"><span>  &lt;pricerecord&gt;</span></span>
<span class="line"><span>    &lt;itemnumber&gt;711121&lt;/itemnumber&gt;</span></span>
<span class="line"><span>    &lt;price&gt;24.99&lt;/price&gt;</span></span>
<span class="line"><span>  &lt;/pricerecord&gt;</span></span>
<span class="line"><span>&lt;/prices&gt;</span></span></code></pre></div><p>The goal of this transformation is to import all the data into a WarehousePG readable external table with an integer <code>itemnumber</code> column and a decimal <code>price</code> column.</p><h2 id="write-a-transformation" tabindex="-1"><a id="topic77"></a>Write a Transformation <a class="header-anchor" href="#write-a-transformation" aria-label="Permalink to &quot;&lt;a id=&quot;topic77&quot;&gt;&lt;/a&gt;Write a Transformation&quot;">​</a></h2><p>The transformation specifies what to extract from the data. You can use any authoring environment and language appropriate for your project. For XML transformations choose from technologies such as XSLT, Joost (STX), Java, Python, or Perl, based on the goals and scope of the project.</p><p>In the price example, the next step is to transform the XML data into a two-column delimited text format.</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>708421|19.99</span></span>
<span class="line"><span>708466|59.25</span></span>
<span class="line"><span>711121|24.99</span></span></code></pre></div><p>The following STX transform, called <em>input_transform.stx</em>, performs the data transformation.</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>&lt;?xml version=&quot;1.0&quot;?&gt;</span></span>
<span class="line"><span>&lt;stx:transform version=&quot;1.0&quot;</span></span>
<span class="line"><span>   xmlns:stx=&quot;http://stx.sourceforge.net/2002/ns&quot;</span></span>
<span class="line"><span>   pass-through=&quot;none&quot;&gt;</span></span>
<span class="line"><span>  &lt;!-- declare variables --&gt;</span></span>
<span class="line"><span>  &lt;stx:variable name=&quot;itemnumber&quot;/&gt;</span></span>
<span class="line"><span>  &lt;stx:variable name=&quot;price&quot;/&gt;</span></span>
<span class="line"><span>  &lt;!-- match and output prices as columns delimited by | --&gt;</span></span>
<span class="line"><span>  &lt;stx:template match=&quot;/prices/pricerecord&quot;&gt;</span></span>
<span class="line"><span>    &lt;stx:process-children/&gt;</span></span>
<span class="line"><span>    &lt;stx:value-of select=&quot;$itemnumber&quot;/&gt;    </span></span>
<span class="line"><span>&lt;stx:text&gt;|&lt;/stx:text&gt;</span></span>
<span class="line"><span>    &lt;stx:value-of select=&quot;$price&quot;/&gt;      &lt;stx:text&gt;</span></span>
<span class="line"><span>&lt;/stx:text&gt;</span></span>
<span class="line"><span>  &lt;/stx:template&gt;</span></span>
<span class="line"><span>  &lt;stx:template match=&quot;itemnumber&quot;&gt;</span></span>
<span class="line"><span>    &lt;stx:assign name=&quot;itemnumber&quot; select=&quot;.&quot;/&gt;</span></span>
<span class="line"><span>  &lt;/stx:template&gt;</span></span>
<span class="line"><span>  &lt;stx:template match=&quot;price&quot;&gt;</span></span>
<span class="line"><span>    &lt;stx:assign name=&quot;price&quot; select=&quot;.&quot;/&gt;</span></span>
<span class="line"><span>  &lt;/stx:template&gt;</span></span>
<span class="line"><span>&lt;/stx:transform&gt;</span></span></code></pre></div><p>This STX transform declares two temporary variables, <code>itemnumber</code> and <code>price</code>, and the following rules.</p><ol><li>When an element that satisfies the XPath expression <code>/prices/pricerecord</code> is found, examine the child elements and generate output that contains the value of the <code>itemnumber</code> variable, a <code>|</code> character, the value of the price variable, and a newline.</li><li>When an <code>&lt;itemnumber&gt;</code> element is found, store the content of that element in the variable <code>itemnumber</code>.</li><li>When a &lt;price&gt; element is found, store the content of that element in the variable <code>price</code>.</li></ol><h2 id="write-the-gpfdist-configuration-file" tabindex="-1"><a id="topic78"></a>Write the gpfdist Configuration File <a class="header-anchor" href="#write-the-gpfdist-configuration-file" aria-label="Permalink to &quot;&lt;a id=&quot;topic78&quot;&gt;&lt;/a&gt;Write the gpfdist Configuration File&quot;">​</a></h2><p>The gpfdist configuration is specified as a YAML 1.1 document. It contains rules that gpfdist uses to select a transformation to apply when loading or extracting data.</p><p>This example gpfdist configuration contains the following items that are required for the <em>prices.xml</em> transformation scenario:</p><ul><li>the <code>config.yaml</code> file defining <code>TRANSFORMATIONS</code></li><li>the <code>input_transform.sh</code> wrapper script, referenced in the <code>config.yaml</code> file</li><li>the <code>input_transform.stx</code> joost transformation, called from <code>input_transform.sh</code></li></ul><p>Aside from the ordinary YAML rules, such as starting the document with three dashes (<code>---</code>), a gpfdist configuration must conform to the following restrictions:</p><ol><li>A <code>VERSION</code> setting must be present with the value <code>1.0.0.1</code>.</li><li>A <code>TRANSFORMATIONS</code> setting must be present and contain one or more mappings.</li><li>Each mapping in the <code>TRANSFORMATION</code> must contain: <ul><li>a <code>TYPE</code> with the value &#39;input&#39; or &#39;output&#39;</li><li>a <code>COMMAND</code> indicating how the transformation is run.</li></ul></li><li>Each mapping in the <code>TRANSFORMATION</code> can contain optional <code>CONTENT</code>, <code>SAFE</code>, and <code>STDERR</code> settings.</li></ol><p>The following gpfdist configuration, called <code>config.yaml</code>, applies to the prices example. The initial indentation on each line is significant and reflects the hierarchical nature of the specification. The transformation name <code>prices_input</code> in the following example will be referenced later when creating the table in SQL.</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>---</span></span>
<span class="line"><span>VERSION: 1.0.0.1</span></span>
<span class="line"><span>TRANSFORMATIONS:</span></span>
<span class="line"><span>  prices_input:</span></span>
<span class="line"><span>    TYPE:     input</span></span>
<span class="line"><span>    COMMAND:  /bin/bash input_transform.sh %filename%</span></span></code></pre></div><p>The <code>COMMAND</code> setting uses a wrapper script called <code>input_transform.sh</code> with a <code>%filename%</code> placeholder. When gpfdist runs the <code>prices_input</code> transform, it invokes <code>input_transform.sh</code> with <code>/bin/bash</code> and replaces the <code>%filename%</code> placeholder with the path to the input file to transform. The wrapper script called <code>input_transform.sh</code> contains the logic to invoke the STX transformation and return the output.</p><p>If Joost is used, the Joost STX engine must be installed.</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>#!/bin/bash</span></span>
<span class="line"><span># input_transform.sh - sample input transformation, </span></span>
<span class="line"><span># demonstrating use of Java and Joost STX to convert XML into</span></span>
<span class="line"><span># text to load into WarehousePG.</span></span>
<span class="line"><span># java arguments:</span></span>
<span class="line"><span>#   -jar joost.jar         joost STX engine</span></span>
<span class="line"><span>#   -nodecl                  don&#39;t generate a &lt;?xml?&gt; declaration</span></span>
<span class="line"><span>#   $1                        filename to process</span></span>
<span class="line"><span>#   input_transform.stx    the STX transformation</span></span>
<span class="line"><span>#</span></span>
<span class="line"><span># the AWK step eliminates a blank line joost emits at the end</span></span>
<span class="line"><span>java \\</span></span>
<span class="line"><span>    -jar joost.jar \\</span></span>
<span class="line"><span>    -nodecl \\</span></span>
<span class="line"><span>    $1 \\</span></span>
<span class="line"><span>    input_transform.stx \\</span></span>
<span class="line"><span> | awk &#39;NF&gt;0&#39;</span></span></code></pre></div><p>The <code>input_transform.sh</code> file uses the Joost STX engine with the AWK interpreter. The following diagram shows the process flow as gpfdist runs the transformation.</p><p><img src="`+i+`" alt="gpfdist process flow"></p><h2 id="transfer-the-data" tabindex="-1"><a id="topic80"></a>Transfer the Data <a class="header-anchor" href="#transfer-the-data" aria-label="Permalink to &quot;&lt;a id=&quot;topic80&quot;&gt;&lt;/a&gt;Transfer the Data&quot;">​</a></h2><p>Create the target database tables with SQL statements based on the appropriate schema.</p><p>There are no special requirements for WarehousePG tables that hold loaded data. In the prices example, the following command creates the <code>prices</code> table, where the data is to be loaded.</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>CREATE TABLE prices (</span></span>
<span class="line"><span>  itemnumber integer,       </span></span>
<span class="line"><span>  price       decimal        </span></span>
<span class="line"><span>) </span></span>
<span class="line"><span>DISTRIBUTED BY (itemnumber);</span></span></code></pre></div><p>Next, use one of the following approaches to transform the data with gpfdist.</p><ul><li><code>gpload</code> supports only input transformations, but in many cases is easier to implement.</li><li><code>gpfdist</code> with <code>INSERT INTO SELECT FROM</code> supports both input and output transformations, but exposes details that <code>gpload</code> automates for you.</li></ul><h3 id="transforming-with-gpload" tabindex="-1"><a id="topic81"></a>Transforming with gpload <a class="header-anchor" href="#transforming-with-gpload" aria-label="Permalink to &quot;&lt;a id=&quot;topic81&quot;&gt;&lt;/a&gt;Transforming with gpload&quot;">​</a></h3><p>The WarehousePG <code>gpload</code> utility orchestrates a data load operation using the <code>gpfdist</code> parallel file server and a YAML-formatted configuration file. <code>gpload</code> automates these tasks:</p><ul><li>Creates a readable external table in the database.</li><li>Starts <code>gpfdist</code> instances with the configuration file that contains the transformation.</li><li>Runs <code>INSERT INTO table\\_name SELECT FROM external\\_table</code> to load the data.</li><li>Removes the external table definition.</li></ul><p>Transforming data with <code>gpload</code> requires that the settings <code>TRANSFORM</code> and <code>TRANSFORM_CONFIG</code> appear in the <code>INPUT</code> section of the <code>gpload</code> control file.</p><p>For more information about the syntax and placement of these settings in the <code>gpload</code> control file, see the <em>WarehousePG Reference Guide</em>.</p><ul><li><code>TRANSFORM_CONFIG</code> specifies the name of the gpfdist configuration file.</li><li>The <code>TRANSFORM</code> setting indicates the name of the transformation that is described in the file named in <code>TRANSFORM_CONFIG</code>.</li></ul><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>---</span></span>
<span class="line"><span>VERSION: 1.0.0.1</span></span>
<span class="line"><span>DATABASE: ops</span></span>
<span class="line"><span>USER: gpadmin</span></span>
<span class="line"><span>GPLOAD:</span></span>
<span class="line"><span>  INPUT:</span></span>
<span class="line"><span>    - TRANSFORM_CONFIG: config.yaml</span></span>
<span class="line"><span>    - TRANSFORM: prices_input</span></span>
<span class="line"><span>    - SOURCE:</span></span>
<span class="line"><span>        FILE: prices.xml</span></span></code></pre></div><p>The transformation name must appear in two places: in the <code>TRANSFORM</code> setting of the gpfdist configuration file and in the <code>TRANSFORMATIONS</code> section of the file named in the <code>TRANSFORM_CONFIG</code> section.</p><p>In the <code>gpload</code> control file, the optional parameter <code>MAX_LINE_LENGTH</code> specifies the maximum length of a line in the XML transformation data that is passed to <code>gpload</code>.</p><p>The following diagram shows the relationships between the <code>gpload</code> control file, the gpfdist configuration file, and the XML data file.</p><p><img src="`+p+`" alt="Relationships between gpload files"></p><h3 id="transforming-with-gpfdist-and-insert-into-select-from" tabindex="-1"><a id="topic82"></a>Transforming with gpfdist and INSERT INTO SELECT FROM <a class="header-anchor" href="#transforming-with-gpfdist-and-insert-into-select-from" aria-label="Permalink to &quot;&lt;a id=&quot;topic82&quot;&gt;&lt;/a&gt;Transforming with gpfdist and INSERT INTO SELECT FROM&quot;">​</a></h3><p>With this load method, you perform each of the tasks that <code>gpload</code> automates. You start <code>gpfdist</code>, create an external table, load the data, and clean up by dropping the table and stopping <code>gpfdist</code>.</p><p>Specify the transformation in the <code>CREATE EXTERNAL TABLE</code> definition&#39;s <code>LOCATION</code> clause. For example, the transform is shown in bold in the following command. (Run gpfdist first, using the command <code>gpfdist -c config.yaml</code>).</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>CREATE READABLE EXTERNAL TABLE prices_readable (LIKE prices)</span></span>
<span class="line"><span>   LOCATION (&#39;gpfdist://hostname:8080/prices.xml#transform=prices_input&#39;)</span></span>
<span class="line"><span>   FORMAT &#39;TEXT&#39; (DELIMITER &#39;|&#39;)</span></span>
<span class="line"><span>   LOG ERRORS SEGMENT REJECT LIMIT 10;</span></span></code></pre></div><p>In the command above, change <code>hostname</code> to your hostname. <code>prices_input</code> comes from the <code>gpfdist</code> configuration file.</p><p>The following query then loads the data into the <code>prices</code> table.</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>INSERT INTO prices SELECT * FROM prices_readable;</span></span></code></pre></div><h3 id="configuration-file-format" tabindex="-1"><a id="topic83"></a>Configuration File Format <a class="header-anchor" href="#configuration-file-format" aria-label="Permalink to &quot;&lt;a id=&quot;topic83&quot;&gt;&lt;/a&gt;Configuration File Format&quot;">​</a></h3><p>The gpfdist configuration file uses the YAML 1.1 document format and implements a schema for defining the transformation parameters. The configuration file must be a valid YAML document.</p><p>The gpfdist program processes the document in order and uses indentation (spaces) to determine the document hierarchy and relationships of the sections to one another. The use of white space is significant. Do not use white space for formatting and do not use tabs.</p><p>The following is the basic structure of a configuration file.</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>---</span></span>
<span class="line"><span>VERSION:   1.0.0.1</span></span>
<span class="line"><span>TRANSFORMATIONS: </span></span>
<span class="line"><span>  transformation_name1:</span></span>
<span class="line"><span>    TYPE:      input | output</span></span>
<span class="line"><span>    COMMAND:   command</span></span>
<span class="line"><span>    CONTENT:   data | paths</span></span>
<span class="line"><span>    SAFE:      posix-regex</span></span>
<span class="line"><span>    STDERR:    server | console</span></span>
<span class="line"><span>  transformation_name2:</span></span>
<span class="line"><span>    TYPE:      input | output</span></span>
<span class="line"><span>    COMMAND:   command </span></span>
<span class="line"><span>...</span></span></code></pre></div><p>VERSION : Required. The version of the gpfdist configuration file schema. The current version is 1.0.0.1.</p><p>TRANSFORMATIONS : Required. Begins the transformation specification section. A configuration file must have at least one transformation. When gpfdist receives a transformation request, it looks in this section for an entry with the matching transformation name.</p><p>TYPE : Required. Specifies the direction of transformation. Values are <code>input</code> or <code>output</code>.</p><ul><li><code>input</code>: gpfdist treats the standard output of the transformation process as a stream of records to load into WarehousePG.</li><li><code>output</code> : gpfdist treats the standard input of the transformation process as a stream of records from WarehousePG to transform and write to the appropriate output.</li></ul><p>COMMAND : Required. Specifies the command gpfdist will run to perform the transformation.</p><p>For input transformations, gpfdist invokes the command specified in the <code>CONTENT</code> setting. The command is expected to open the underlying file(s) as appropriate and produce one line of <code>TEXT</code> for each row to load into WarehousePG. The input transform determines whether the entire content should be converted to one row or to multiple rows.</p><p>For output transformations, gpfdist invokes this command as specified in the <code>CONTENT</code> setting. The output command is expected to open and write to the underlying file(s) as appropriate. The output transformation determines the final placement of the converted output.</p><p>CONTENT : Optional. The values are <code>data</code> and <code>paths</code>. The default value is <code>data</code>.</p><ul><li>When <code>CONTENT</code> specifies <code>data</code>, the text <code>%filename%</code> in the <code>COMMAND</code> section is replaced by the path to the file to read or write.</li><li>When <code>CONTENT</code> specifies <code>paths</code>, the text <code>%filename%</code> in the <code>COMMAND</code> section is replaced by the path to the temporary file that contains the list of files to read or write.</li></ul><p>The following is an example of a <code>COMMAND</code> section showing the text <code>%filename%</code> that is replaced.</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>COMMAND: /bin/bash input_transform.sh %filename%</span></span></code></pre></div><p>SAFE : Optional. A <code>POSIX</code> regular expression that the paths must match to be passed to the transformation. Specify <code>SAFE</code> when there is a concern about injection or improper interpretation of paths passed to the command. The default is no restriction on paths.</p><p>STDERR : Optional. The values are <code>server</code> and <code>console</code>.</p><p>This setting specifies how to handle standard error output from the transformation. The default, <code>server</code>, specifies that gpfdist will capture the standard error output from the transformation in a temporary file and send the first 8k of that file to WarehousePG as an error message. The error message will appear as an SQL error. <code>Console</code> specifies that gpfdist does not redirect or transmit the standard error output from the transformation.</p><h2 id="xml-transformation-examples" tabindex="-1"><a id="topic91"></a>XML Transformation Examples <a class="header-anchor" href="#xml-transformation-examples" aria-label="Permalink to &quot;&lt;a id=&quot;topic91&quot;&gt;&lt;/a&gt;XML Transformation Examples&quot;">​</a></h2><p>The following examples demonstrate the complete process for different types of XML data and STX transformations. Files and detailed instructions associated with these examples are in the GitHub repo <code>github.com://greenplum-db/gpdb</code> in the <a href="https://github.com/greenplum-db/gpdb/blob/main/gpMgmt/demo/gpfdist_transform" target="_blank" rel="noreferrer">gpMgmt/demo/gpfdist_transform</a> directory. Read the README file in the <em>Before You Begin</em> section before you run the examples. The README file explains how to download the example data file used in the examples.</p><h3 id="command-based-external-web-tables" tabindex="-1"><a id="topic32"></a>Command-based External Web Tables <a class="header-anchor" href="#command-based-external-web-tables" aria-label="Permalink to &quot;&lt;a id=&quot;topic32&quot;&gt;&lt;/a&gt;Command-based External Web Tables&quot;">​</a></h3><p>The output of a shell command or script defines command-based web table data. Specify the command in the <code>EXECUTE</code> clause of <code>CREATE EXTERNAL WEB TABLE</code>. The data is current as of the time the command runs. The <code>EXECUTE</code> clause runs the shell command or script on the specified coordinator, and/or segment host or hosts. The command or script must reside on the hosts corresponding to the host(s) defined in the <code>EXECUTE</code> clause.</p><p>By default, the command is run on segment hosts when active segments have output rows to process. For example, if each segment host runs four primary segment instances that have output rows to process, the command runs four times per segment host. You can optionally limit the number of segment instances that run the web table command. All segments included in the web table definition in the <code>ON</code> clause run the command in parallel.</p><p>The command that you specify in the external table definition runs from the database and cannot access environment variables from <code>.bashrc</code> or <code>.profile</code>. Set environment variables in the <code>EXECUTE</code> clause. For example:</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>=# CREATE EXTERNAL WEB TABLE output (output text)</span></span>
<span class="line"><span>    EXECUTE &#39;PATH=/home/gpadmin/programs; export PATH; myprogram.sh&#39; </span></span>
<span class="line"><span>    FORMAT &#39;TEXT&#39;;</span></span></code></pre></div><p>Scripts must be executable by the <code>gpadmin</code> user and reside in the same location on the coordinator or segment hosts.</p><p>The following command defines a web table that runs a script. The script runs on each segment host where a segment has output rows to process.</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>=# CREATE EXTERNAL WEB TABLE log_output </span></span>
<span class="line"><span>    (linenum int, message text) </span></span>
<span class="line"><span>    EXECUTE &#39;/var/load_scripts/get_log_data.sh&#39; ON HOST </span></span>
<span class="line"><span>    FORMAT &#39;TEXT&#39; (DELIMITER &#39;|&#39;);</span></span></code></pre></div><h3 id="irs-mef-xml-files-in-demo-directory" tabindex="-1"><a id="topic93"></a>IRS MeF XML Files (In demo Directory) <a class="header-anchor" href="#irs-mef-xml-files-in-demo-directory" aria-label="Permalink to &quot;&lt;a id=&quot;topic93&quot;&gt;&lt;/a&gt;IRS MeF XML Files \\(In demo Directory\\)&quot;">​</a></h3><p>This example demonstrates loading a sample IRS Modernized eFile tax return using a Joost STX transformation. The data is in the form of a complex XML file.</p><p>The U.S. Internal Revenue Service (IRS) made a significant commitment to XML and specifies its use in its Modernized e-File (MeF) system. In MeF, each tax return is an XML document with a deep hierarchical structure that closely reflects the particular form of the underlying tax code.</p><p>XML, XML Schema and stylesheets play a role in their data representation and business workflow. The actual XML data is extracted from a ZIP file attached to a MIME &quot;transmission file&quot; message. For more information about MeF, see <a href="https://www.irs.gov/uac/modernized-e-file-overview" target="_blank" rel="noreferrer">Modernized e-File (Overview)</a> on the IRS web site.</p><p>The sample XML document, <em>RET990EZ_2006.xml</em>, is about 350KB in size with two elements:</p><ul><li>ReturnHeader</li><li>ReturnData</li></ul><p>The &lt;ReturnHeader&gt; element contains general details about the tax return such as the taxpayer&#39;s name, the tax year of the return, and the preparer. The &lt;ReturnData&gt; element contains multiple sections with specific details about the tax return and associated schedules.</p><p>The following is an abridged sample of the XML file.</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt; </span></span>
<span class="line"><span>&lt;Return returnVersion=&quot;2006v2.0&quot;</span></span>
<span class="line"><span>   xmlns=&quot;https://www.irs.gov/efile&quot; </span></span>
<span class="line"><span>   xmlns:efile=&quot;https://www.irs.gov/efile&quot;</span></span>
<span class="line"><span>   xsi:schemaLocation=&quot;https://www.irs.gov/efile&quot;</span></span>
<span class="line"><span>   xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;&gt; </span></span>
<span class="line"><span>   &lt;ReturnHeader binaryAttachmentCount=&quot;1&quot;&gt;</span></span>
<span class="line"><span>     &lt;ReturnId&gt;AAAAAAAAAAAAAAAAAAAA&lt;/ReturnId&gt;</span></span>
<span class="line"><span>     &lt;Timestamp&gt;1999-05-30T12:01:01+05:01&lt;/Timestamp&gt;</span></span>
<span class="line"><span>     &lt;ReturnType&gt;990EZ&lt;/ReturnType&gt;</span></span>
<span class="line"><span>     &lt;TaxPeriodBeginDate&gt;2005-01-01&lt;/TaxPeriodBeginDate&gt;</span></span>
<span class="line"><span>     &lt;TaxPeriodEndDate&gt;2005-12-31&lt;/TaxPeriodEndDate&gt;</span></span>
<span class="line"><span>     &lt;Filer&gt;</span></span>
<span class="line"><span>       &lt;EIN&gt;011248772&lt;/EIN&gt;</span></span>
<span class="line"><span>       ... more data ...</span></span>
<span class="line"><span>     &lt;/Filer&gt;</span></span>
<span class="line"><span>     &lt;Preparer&gt;</span></span>
<span class="line"><span>       &lt;Name&gt;Percy Polar&lt;/Name&gt;</span></span>
<span class="line"><span>       ... more data ...</span></span>
<span class="line"><span>     &lt;/Preparer&gt;</span></span>
<span class="line"><span>     &lt;TaxYear&gt;2005&lt;/TaxYear&gt;</span></span>
<span class="line"><span>   &lt;/ReturnHeader&gt;</span></span>
<span class="line"><span>   ... more data ..</span></span></code></pre></div><p>The goal is to import all the data into a WarehousePG. First, convert the XML document into text with newlines &quot;escaped&quot;, with two columns: <code>ReturnId</code> and a single column on the end for the entire MeF tax return. For example:</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>AAAAAAAAAAAAAAAAAAAA|&lt;Return returnVersion=&quot;2006v2.0&quot;...</span></span></code></pre></div><p>Load the data into WarehousePG.</p><h3 id="witsmltm-files-in-demo-directory" tabindex="-1"><a id="topic94"></a>WITSML™ Files (In demo Directory) <a class="header-anchor" href="#witsmltm-files-in-demo-directory" aria-label="Permalink to &quot;&lt;a id=&quot;topic94&quot;&gt;&lt;/a&gt;WITSML™ Files \\(In demo Directory\\)&quot;">​</a></h3><p>This example demonstrates loading sample data describing an oil rig using a Joost STX transformation. The data is in the form of a complex XML file downloaded from energistics.org.</p><p>The Wellsite Information Transfer Standard Markup Language (WITSML™) is an oil industry initiative to provide open, non-proprietary, standard interfaces for technology and software to share information among oil companies, service companies, drilling contractors, application vendors, and regulatory agencies. For more information about WITSML™, see <a href="https://www.energistics.org/" target="_blank" rel="noreferrer">https://www.energistics.org/</a>.</p><p>The oil rig information consists of a top level <code>&lt;rigs&gt;</code> element with multiple child elements such as <code>&lt;documentInfo&gt;, &lt;rig&gt;</code>, and so on. The following excerpt from the file shows the type of information in the <code>&lt;rig&gt;</code> tag.</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span>
<span class="line"><span>&lt;?xml-stylesheet href=&quot;../stylesheets/rig.xsl&quot; type=&quot;text/xsl&quot; media=&quot;screen&quot;?&gt;</span></span>
<span class="line"><span>&lt;rigs </span></span>
<span class="line"><span> xmlns=&quot;https://www.energistics.org/schemas/131&quot; </span></span>
<span class="line"><span> xmlns:xsi=&quot;https://www.w3.org/2001/XMLSchema-instance&quot; </span></span>
<span class="line"><span> xsi:schemaLocation=&quot;https://www.energistics.org/schemas/131 ../obj_rig.xsd&quot; </span></span>
<span class="line"><span> version=&quot;1.3.1.1&quot;&gt;</span></span>
<span class="line"><span> &lt;documentInfo&gt;</span></span>
<span class="line"><span> ... misc data ...</span></span>
<span class="line"><span> &lt;/documentInfo&gt;</span></span>
<span class="line"><span> &lt;rig uidWell=&quot;W-12&quot; uidWellbore=&quot;B-01&quot; uid=&quot;xr31&quot;&gt;</span></span>
<span class="line"><span>     &lt;nameWell&gt;6507/7-A-42&lt;/nameWell&gt;</span></span>
<span class="line"><span>     &lt;nameWellbore&gt;A-42&lt;/nameWellbore&gt;</span></span>
<span class="line"><span>     &lt;name&gt;Deep Drill #5&lt;/name&gt;</span></span>
<span class="line"><span>     &lt;owner&gt;Deep Drilling Co.&lt;/owner&gt;</span></span>
<span class="line"><span>     &lt;typeRig&gt;floater&lt;/typeRig&gt;</span></span>
<span class="line"><span>     &lt;manufacturer&gt;Fitsui Engineering&lt;/manufacturer&gt;</span></span>
<span class="line"><span>     &lt;yearEntService&gt;1980&lt;/yearEntService&gt;</span></span>
<span class="line"><span>     &lt;classRig&gt;ABS Class A1 M CSDU AMS ACCU&lt;/classRig&gt;</span></span>
<span class="line"><span>     &lt;approvals&gt;DNV&lt;/approvals&gt;</span></span>
<span class="line"><span> ... more data ...</span></span></code></pre></div><p>The goal is to import the information for this rig into WarehousePG.</p><p>The sample document, <em>rig.xml</em>, is about 11KB in size. The input does not contain tabs so the relevant information can be converted into records delimited with a pipe (|).</p><p><code>W-12|6507/7-A-42|xr31|Deep Drill #5|Deep Drilling Co.|John Doe|John.Doe@example.com|</code></p><p>With the columns:</p><ul><li><code>well_uid text</code>, -- e.g. W-12</li><li><code>well_name text</code>, -- e.g. 6507/7-A-42</li><li><code>rig_uid text</code>, -- e.g. xr31</li><li><code>rig_name text</code>, -- e.g. Deep Drill #5</li><li><code>rig_owner text</code>, -- e.g. Deep Drilling Co.</li><li><code>rig_contact text</code>, -- e.g. John Doe</li><li><code>rig_email text</code>, -- e.g. <a href="mailto:John.Doe@example.com" target="_blank" rel="noreferrer">John.Doe@example.com</a></li><li><code>doc xml</code></li></ul><p>Then, load the data into WarehousePG.</p>`,118)]))}const b=a(l,[["render",r]]);export{f as __pageData,b as default};

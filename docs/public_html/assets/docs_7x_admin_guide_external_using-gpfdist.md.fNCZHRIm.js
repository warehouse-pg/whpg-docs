import{_ as t}from"./chunks/ext_tables_multinic.CSkYAbUg.js";import{_ as a}from"./chunks/ext_tables.BRbN9lXc.js";import{_ as s,c as i,o,ag as n}from"./chunks/framework.Ds6Eueu6.js";const b=JSON.parse('{"title":"Using the WarehousePG Parallel File Server (gpfdist)","description":"","frontmatter":{},"headers":[],"relativePath":"docs/7x/admin_guide/external/using-gpfdist.md","filePath":"docs/7x/admin_guide/external/using-gpfdist.md"}'),r={name:"docs/7x/admin_guide/external/using-gpfdist.md"};function d(l,e,p,c,h,g){return o(),i("div",null,e[0]||(e[0]=[n('<h1 id="using-the-warehousepg-parallel-file-server-gpfdist" tabindex="-1">Using the WarehousePG Parallel File Server (gpfdist) <a class="header-anchor" href="#using-the-warehousepg-parallel-file-server-gpfdist" aria-label="Permalink to &quot;Using the WarehousePG Parallel File Server (gpfdist)&quot;">​</a></h1><hr><p>The gpfdist protocol is used in a <code>CREATE EXTERNAL TABLE</code> SQL command to access external data served by the WarehousePG <code>gpfdist</code> file server utility. When external data is served by gpfdist, all segments in the WarehousePG cluster can read or write external table data in parallel.</p><p>This topic describes the setup and management tasks for using gpfdist with external tables.</p><ul><li><a href="#topic_xkt_vjy_4bb">About gpfdist and External Tables</a></li><li><a href="#topic14">About gpfdist Setup and Performance</a></li><li><a href="#topic15">Controlling Segment Parallelism</a></li><li><a href="#topic16">Installing gpfdist</a></li><li><a href="#topic17">Starting and Stopping gpfdist</a></li><li><a href="#topic18">Troubleshooting gpfdist</a></li></ul><p><strong>Parent topic:</strong> <a href="./../external/working-with-file-based-ext-tables.html">Working with External Data</a></p><h2 id="about-gpfdist-and-external-tables" tabindex="-1"><a id="topic_xkt_vjy_4bb"></a>About gpfdist and External Tables <a class="header-anchor" href="#about-gpfdist-and-external-tables" aria-label="Permalink to &quot;&lt;a id=&quot;topic_xkt_vjy_4bb&quot;&gt;&lt;/a&gt;About gpfdist and External Tables&quot;">​</a></h2><p>The <code>gpfdist</code> file server utility is located in the <code>$GPHOME/bin</code> directory on your WarehousePG coordinator host and on each segment host. When you start a <code>gpfdist</code> instance you specify a listen port and the path to a directory containing files to read or where files are to be written. For example, this command runs <code>gpfdist</code> in the background, listening on port 8801, and serving files in the <code>/home/gpadmin/external_files</code> directory:</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>$ gpfdist -p 8801 -d /home/gpadmin/external_files &amp;</span></span></code></pre></div><p>The <code>CREATE EXTERNAL TABLE</code> command <code>LOCATION</code> clause connects an external table definition to one or more <code>gpfdist</code> instances. If the external table is readable, the <code>gpfdist</code> server reads data records from files from in specified directory, packs them into a block, and sends the block in a response to a WarehousePG segment&#39;s request. The segments unpack rows they receive and distribute them according to the external table&#39;s distribution policy. If the external table is a writable table, segments send blocks of rows in a request to gpfdist and gpfdist writes them to the external file.</p><p>External data files can contain rows in CSV format or any delimited text format supported by the <code>FORMAT</code> clause of the <code>CREATE EXTERNAL TABLE</code> command. In addition, <code>gpfdist</code> can be configured with a YAML-formatted file to transform external data files between a supported text format and another format, for example XML or JSON. See &lt;ref&gt; for an example that shows how to use <code>gpfdist</code> to read external XML files into a WarehousePG readable external table.</p><p>For readable external tables, <code>gpfdist</code> uncompresses <code>gzip</code> (<code>.gz</code>) and <code>bzip2</code> (.<code>bz2</code>) files automatically. You can use the wildcard character (*) or other C-style pattern matching to denote multiple files to read. External files are assumed to be relative to the directory specified when you started the <code>gpfdist</code> instance.</p><h2 id="about-gpfdist-setup-and-performance" tabindex="-1"><a id="topic14"></a>About gpfdist Setup and Performance <a class="header-anchor" href="#about-gpfdist-setup-and-performance" aria-label="Permalink to &quot;&lt;a id=&quot;topic14&quot;&gt;&lt;/a&gt;About gpfdist Setup and Performance&quot;">​</a></h2><p>You can run <code>gpfdist</code> instances on multiple hosts and you can run multiple <code>gpfdist</code> instances on each host. This allows you to deploy <code>gpfdist</code> servers strategically so that you can attain fast data load and unload rates by utilizing all of the available network bandwidth and WarehousePG&#39;s parallelism.</p><ul><li>Allow network traffic to use all ETL host network interfaces simultaneously. Run one instance of gpfdist for each interface on the ETL host, then declare the host name of each NIC in the <code>LOCATION</code> clause of your external table definition (see <a href="./creating-external-tables---examples.html">Examples for Creating External Tables</a>).</li></ul><p><img src="'+t+'" alt="External Table Using Single gpfdist Instance with Multiple NICs" title="External Table Using Single gpfdist Instance with Multiple NICs"></p><ul><li>Divide external table data equally among multiple gpfdist instances on the ETL host. For example, on an ETL system with two NICs, run two gpfdist instances (one on each NIC) to optimize data load performance and divide the external table data files evenly between the two gpfdist servers.</li></ul><p><img src="'+a+'" alt="External Tables Using Multiple gpfdist Instances with Multiple NICs" title="External Tables Using Multiple gpfdist Instances with Multiple NICs"></p><blockquote><p><strong>Note</strong> Use pipes (|) to separate formatted text when you submit files to gpfdist. WarehousePG encloses comma-separated text strings in single or double quotes. gpfdist has to remove the quotes to parse the strings. Using pipes to separate formatted text avoids the extra step and improves performance.</p></blockquote><h2 id="controlling-segment-parallelism" tabindex="-1"><a id="topic15"></a>Controlling Segment Parallelism <a class="header-anchor" href="#controlling-segment-parallelism" aria-label="Permalink to &quot;&lt;a id=&quot;topic15&quot;&gt;&lt;/a&gt;Controlling Segment Parallelism&quot;">​</a></h2><p>The <code>gp_external_max_segs</code> server configuration parameter controls the number of segment instances that can access a single gpfdist instance simultaneously. 64 is the default. You can set the number of segments such that some segments process external data files and some perform other database processing. Set this parameter in the <code>postgresql.conf</code> file of your coordinator instance.</p><h2 id="installing-gpfdist" tabindex="-1"><a id="topic16"></a>Installing gpfdist <a class="header-anchor" href="#installing-gpfdist" aria-label="Permalink to &quot;&lt;a id=&quot;topic16&quot;&gt;&lt;/a&gt;Installing gpfdist&quot;">​</a></h2><p>gpfdist is installed in <code>$GPHOME/bin</code> of your WarehousePG coordinator host installation. Run gpfdist on a machine other than the WarehousePG coordinator or standby coordinator, such as on a machine devoted to ETL processing. Running gpfdist on the coordinator or standby coordinator can have a performance impact on query execution. To install gpfdist on your ETL server, get it from the <em>WarehousePG Clients</em> package and follow its installation instructions.</p><h2 id="starting-and-stopping-gpfdist" tabindex="-1"><a id="topic17"></a>Starting and Stopping gpfdist <a class="header-anchor" href="#starting-and-stopping-gpfdist" aria-label="Permalink to &quot;&lt;a id=&quot;topic17&quot;&gt;&lt;/a&gt;Starting and Stopping gpfdist&quot;">​</a></h2><p>You can start gpfdist in your current directory location or in any directory that you specify. The default port is <code>8080</code>.</p><p>From your current directory, type:</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>gpfdist &amp;</span></span></code></pre></div><p>From a different directory, specify the directory from which to serve files, and optionally, the HTTP port to run on.</p><p>To start gpfdist in the background and log output messages and errors to a log file:</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>$ gpfdist -d /var/load_files -p 8081 -l /home/`gpadmin`/log &amp;</span></span></code></pre></div><p>For multiple gpfdist instances on the same ETL host, use a different base directory and port for each instance. For example:</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>$ gpfdist -d /var/load_files1 -p 8081 -l /home/`gpadmin`/log1 &amp;</span></span>\n<span class="line"><span>$ gpfdist -d /var/load_files2 -p 8082 -l /home/`gpadmin`/log2 &amp;</span></span></code></pre></div><p>To stop gpfdist when it is running in the background:</p><p>First find its process id:</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>$ ps -ef | grep gpfdist</span></span></code></pre></div><p>Then stop the process, for example (where 3456 is the process ID in this example):</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>$ kill 3456</span></span></code></pre></div><h2 id="troubleshooting-gpfdist" tabindex="-1"><a id="topic18"></a>Troubleshooting gpfdist <a class="header-anchor" href="#troubleshooting-gpfdist" aria-label="Permalink to &quot;&lt;a id=&quot;topic18&quot;&gt;&lt;/a&gt;Troubleshooting gpfdist&quot;">​</a></h2><p>The segments access gpfdist at runtime. Ensure that the WarehousePG segment hosts have network access to gpfdist. gpfdist is a web server: test connectivity by running the following command from each host in the WarehousePG cluster (segments and coordinator):</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>$ wget http://&lt;gpfdist_hostname&gt;:&lt;port&gt;/&lt;filename&gt;</span></span></code></pre></div><p>The <code>CREATE EXTERNAL TABLE</code> definition must have the correct host name, port, and file names for gpfdist. Specify file names and paths relative to the directory from which gpfdist serves files (the directory path specified when gpfdist started). See <a href="./creating-external-tables---examples.html">Examples for Creating External Tables</a>.</p><p>If you start gpfdist on your system and IPv6 networking is deactivated, gpfdist displays this warning message when testing for an IPv6 port.</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>[WRN gpfdist.c:2050] Creating the socket failed</span></span></code></pre></div><p>If the corresponding IPv4 port is available, gpfdist uses that port and the warning for IPv6 port can be ignored. To see information about the ports that gpfdist tests, use the <code>-V</code> option.</p><p>For information about IPv6 and IPv4 networking, see your operating system documentation.</p><p>When reading or writing data with the <code>gpfdist</code> or <code>gfdists</code> protocol, the <code>gpfdist</code> utility rejects HTTP requests that do not include <code>X-GP-PROTO</code> in the request header. If <code>X-GP-PROTO</code> is not detected in the header request <code>gpfdist</code> returns a 400 error in the status line of the HTTP response header: <code>400 invalid request (no gp-proto)</code>.</p><p>WarehousePG includes <code>X-GP-PROTO</code> in the HTTP request header to indicate that the request is from WarehousePG.</p><p>If the <code>gpfdist</code> utility hangs with no read or write activity occurring, you can generate a core dump the next time a hang occurs to help debug the issue. Set the environment variable <code>GPFDIST_WATCHDOG_TIMER</code> to the number of seconds of no activity to wait before <code>gpfdist</code> is forced to exit. When the environment variable is set and <code>gpfdist</code> hangs, the utility stops after the specified number of seconds, creates a core dump, and sends relevant information to the log file.</p><p>This example sets the environment variable on a Linux system so that <code>gpfdist</code> exits after 300 seconds (5 minutes) of no activity.</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>export GPFDIST_WATCHDOG_TIMER=300</span></span></code></pre></div>',50)]))}const v=s(r,[["render",d]]);export{b as __pageData,v as default};

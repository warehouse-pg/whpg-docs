import{_ as n,c as a,o as s,ag as o}from"./chunks/framework.Ds6Eueu6.js";const h=JSON.parse('{"title":"Using the PgBouncer Connection Pooler","description":"","frontmatter":{},"headers":[],"relativePath":"docs/7x/admin_guide/access_db/pgbouncer.md","filePath":"docs/7x/admin_guide/access_db/pgbouncer.md"}'),t={name:"docs/7x/admin_guide/access_db/pgbouncer.md"};function i(p,e,c,r,l,d){return s(),a("div",null,e[0]||(e[0]=[o(`<h1 id="using-the-pgbouncer-connection-pooler" tabindex="-1">Using the PgBouncer Connection Pooler <a class="header-anchor" href="#using-the-pgbouncer-connection-pooler" aria-label="Permalink to &quot;Using the PgBouncer Connection Pooler&quot;">​</a></h1><hr><p>The PgBouncer utility manages connection pools for PostgreSQL and WarehousePG connections.</p><p>The following topics describe how to set up and use PgBouncer with WarehousePG. Refer to the <a href="https://pgbouncer.github.io" target="_blank" rel="noreferrer">PgBouncer web site</a> for information about using PgBouncer with PostgreSQL.</p><ul><li><a href="#topic_nzk_nqg_cs">Overview</a></li><li><a href="#pgb_migrate">Migrating PgBouncer</a></li><li><a href="#pgb_config">Configuring PgBouncer</a></li><li><a href="#pgb_start">Starting PgBouncer</a></li><li><a href="#topic_manage">Managing PgBouncer</a></li></ul><p><strong>Parent topic:</strong> <a href="./../access_db/accessing-the-database.html">Accessing the Database</a></p><h2 id="overview" tabindex="-1"><a id="topic_nzk_nqg_cs"></a>Overview <a class="header-anchor" href="#overview" aria-label="Permalink to &quot;&lt;a id=&quot;topic_nzk_nqg_cs&quot;&gt;&lt;/a&gt;Overview&quot;">​</a></h2><p>A database connection pool is a cache of database connections. Once a pool of connections is established, connection pooling eliminates the overhead of creating new database connections, so clients connect much faster and the server load is reduced.</p><p>The PgBouncer connection pooler, from the PostgreSQL community, is included in your WarehousePG installation. PgBouncer is a light-weight connection pool manager for WarehousePG and PostgreSQL. PgBouncer maintains a pool for connections for each database and user combination. PgBouncer either creates a new database connection for a client or reuses an existing connection for the same user and database. When the client disconnects, PgBouncer returns the connection to the pool for re-use.</p><p>In order not to compromise transaction semantics for connection pooling, PgBouncer supports several types of pooling when rotating connections:</p><ul><li><p><em>Session pooling</em> - Most polite method. When a client connects, a server connection will be assigned to it for the whole duration the client stays connected. When the client disconnects, the server connection will be put back into the pool. This is the default method.</p></li><li><p><em>Transaction pooling</em> - A server connection is assigned to a client only during a transaction. When PgBouncer notices that transaction is over, the server connection will be put back into the pool.</p></li><li><p><em>Statement pooling</em> - Most aggressive method. The server connection will be put back into the pool immediately after a query completes. Multi-statement transactions are disallowed in this mode as they would break.</p></li></ul><p>You can set a default pool mode for the PgBouncer instance. You can override this mode for individual databases and users.</p><p>PgBouncer supports the standard connection interface shared by PostgreSQL and WarehousePG. The WarehousePG client application (for example, <code>psql</code>) connects to the host and port on which PgBouncer is running rather than the WarehousePG coordinator host and port.</p><p>PgBouncer includes a <code>psql</code>-like administration console. Authorized users can connect to a virtual database to monitor and manage PgBouncer. You can manage a PgBouncer daemon process via the admin console. You can also use the console to update and reload PgBouncer configuration at runtime without stopping and restarting the process.</p><p>PgBouncer natively supports TLS.</p><h2 id="migrating-pgbouncer" tabindex="-1"><a id="pgb_migrate"></a>Migrating PgBouncer <a class="header-anchor" href="#migrating-pgbouncer" aria-label="Permalink to &quot;&lt;a id=&quot;pgb_migrate&quot;&gt;&lt;/a&gt;Migrating PgBouncer&quot;">​</a></h2><p>When you migrate to a new WarehousePG version, you must migrate your PgBouncer instance to that in the new WarehousePG installation.</p><ul><li><p><strong>If you are migrating to a WarehousePG version 5.8.x or earlier</strong>, you can migrate PgBouncer without dropping connections. Launch the new PgBouncer process with the <code>-R</code> option and the configuration file that you started the process with:</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>$ pgbouncer -R -d pgbouncer.ini</span></span></code></pre></div><p>The <code>-R</code> (reboot) option causes the new process to connect to the console of the old process through a Unix socket and issue the following commands:</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>SUSPEND;</span></span>
<span class="line"><span>SHOW FDS;</span></span>
<span class="line"><span>SHUTDOWN;</span></span></code></pre></div><p>When the new process detects that the old process is gone, it resumes the work with the old connections. This is possible because the <code>SHOW FDS</code> command sends actual file descriptors to the new process. If the transition fails for any reason, kill the new process and the old process will resume.</p></li><li><p><strong>If you are migrating to a WarehousePG version 5.9.0 or later</strong>, you must shut down the PgBouncer instance in your old installation and reconfigure and restart PgBouncer in your new installation.</p></li><li><p>If you used stunnel to secure PgBouncer connections in your old installation, you must configure SSL/TLS in your new installation using the built-in TLS capabilities of PgBouncer 1.8.1 and later.</p></li><li><p>If you currently use the built-in PAM LDAP integration, you may choose to migrate to the new native LDAP PgBouncer integration introduced in WarehousePG version 6.22; refer to <a href="#pgb_ldap">Configuring LDAP-based Authentication for PgBouncer</a> for configuration information.</p></li></ul><h2 id="configuring-pgbouncer" tabindex="-1"><a id="pgb_config"></a>Configuring PgBouncer <a class="header-anchor" href="#configuring-pgbouncer" aria-label="Permalink to &quot;&lt;a id=&quot;pgb_config&quot;&gt;&lt;/a&gt;Configuring PgBouncer&quot;">​</a></h2><p>You configure PgBouncer and its access to WarehousePG via a configuration file. This configuration file, commonly named <code>pgbouncer.ini</code>, provides location information for WarehousePGs. The <code>pgbouncer.ini</code> file also specifies process, connection pool, authorized users, and authentication configuration for PgBouncer.</p><p>Sample <code>pgbouncer.ini</code> file contents:</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>[databases]</span></span>
<span class="line"><span>postgres = host=127.0.0.1 port=5432 dbname=postgres</span></span>
<span class="line"><span>pgb_mydb = host=127.0.0.1 port=5432 dbname=mydb</span></span>
<span class="line"><span></span></span>
<span class="line"><span>[pgbouncer]</span></span>
<span class="line"><span>pool_mode = session</span></span>
<span class="line"><span>listen_port = 6543</span></span>
<span class="line"><span>listen_addr = 127.0.0.1</span></span>
<span class="line"><span>auth_type = md5</span></span>
<span class="line"><span>auth_file = users.txt</span></span>
<span class="line"><span>logfile = pgbouncer.log</span></span>
<span class="line"><span>pidfile = pgbouncer.pid</span></span>
<span class="line"><span>admin_users = gpadmin</span></span></code></pre></div><p>Refer to the <a href="./../../utility_guide/ref/pgbouncer-ini.html">pgbouncer.ini</a> reference page for the PgBouncer configuration file format and the list of configuration properties it supports.</p><p>When a client connects to PgBouncer, the connection pooler looks up the the configuration for the requested database (which may be an alias for the actual database) that was specified in the <code>pgbouncer.ini</code> configuration file to find the host name, port, and database name for the database connection. The configuration file also identifies the authentication mode in effect for the database.</p><p>PgBouncer requires an authentication file, a text file that contains a list of WarehousePG users and passwords. The contents of the file are dependent on the <code>auth_type</code> you configure in the <code>pgbouncer.ini</code> file. Passwords may be either clear text or MD5-encoded strings. You can also configure PgBouncer to query the destination database to obtain password information for users that are not in the authentication file.</p><h3 id="pgbouncer-authentication-file-format" tabindex="-1"><a id="pgb_auth"></a>PgBouncer Authentication File Format <a class="header-anchor" href="#pgbouncer-authentication-file-format" aria-label="Permalink to &quot;&lt;a id=&quot;pgb_auth&quot;&gt;&lt;/a&gt;PgBouncer Authentication File Format&quot;">​</a></h3><p>PgBouncer requires its own user authentication file. You specify the name of this file in the <code>auth_file</code> property of the <code>pgbouncer.ini</code> configuration file. <code>auth_file</code> is a text file in the following format:</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>&quot;username1&quot; &quot;password&quot; ...</span></span>
<span class="line"><span>&quot;username2&quot; &quot;md5abcdef012342345&quot; ...</span></span>
<span class="line"><span>&quot;username2&quot; &quot;SCRAM-SHA-256$&lt;iterations&gt;:&lt;salt&gt;$&lt;storedkey&gt;:&lt;serverkey&gt;&quot;</span></span></code></pre></div><p><code>auth_file</code> contains one line per user. Each line must have at least two fields, both of which are enclosed in double quotes (<code>&quot; &quot;</code>). The first field identifies the WarehousePG user name. The second field is either a plain-text password, an MD5-encoded password, or or a SCRAM secret. PgBouncer ignores the remainder of the line.</p><p>(The format of <code>auth_file</code> is similar to that of the <code>pg_auth</code> text file that WarehousePG uses for authentication information. PgBouncer can work directly with this WarehousePG authentication file.)</p><p>Use an MD5 encoded password. The format of an MD5 encoded password is:</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>&quot;md5&quot; + MD5_encoded(&lt;password&gt;&lt;username&gt;)</span></span></code></pre></div><p>You can also obtain the MD5-encoded passwords of all WarehousePG users from the <code>pg_shadow</code> view.</p><p>PostgreSQL SCRAM secret format:</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>SCRAM-SHA-256$&lt;iterations&gt;:&lt;salt&gt;$&lt;storedkey&gt;:&lt;serverkey&gt;</span></span></code></pre></div><p>See the PostgreSQL documentation and RFC 5803 for details on this.</p><p>The passwords or secrets stored in the authentication file serve two purposes. First, they are used to verify the passwords of incoming client connections, if a password-based authentication method is configured. Second, they are used as the passwords for outgoing connections to the backend server, if the backend server requires password-based authentication (unless the password is specified directly in the database’s connection string). The latter works if the password is stored in plain text or MD5-hashed.</p><p>SCRAM secrets can only be used for logging into a server if the client authentication also uses SCRAM, the PgBouncer database definition does not specify a user name, and the SCRAM secrets are identical in PgBouncer and the PostgreSQL server (same salt and iterations, not merely the same password). This is due to an inherent security property of SCRAM: The stored SCRAM secret cannot by itself be used for deriving login credentials.</p><p>The authentication file can be written by hand, but it’s also useful to generate it from some other list of users and passwords. See <code>./etc/mkauth.py</code> for a sample script to generate the authentication file from the <code>pg_shadow</code> system table. Alternatively, use</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>auth_query</span></span></code></pre></div><p>instead of <code>auth_file</code> to avoid having to maintain a separate authentication file.</p><h3 id="configuring-hba-based-authentication-for-pgbouncer" tabindex="-1"><a id="pgb_hba"></a>Configuring HBA-based Authentication for PgBouncer <a class="header-anchor" href="#configuring-hba-based-authentication-for-pgbouncer" aria-label="Permalink to &quot;&lt;a id=&quot;pgb_hba&quot;&gt;&lt;/a&gt;Configuring HBA-based Authentication for PgBouncer&quot;">​</a></h3><p>PgBouncer supports HBA-based authentication. To configure HBA-based authentication for PgBouncer, you set <code>auth_type=hba</code> in the <code>pgbouncer.ini</code> configuration file. You also provide the filename of the HBA-format file in the <code>auth_hba_file</code> parameter of the <code>pgbouncer.ini</code> file.</p><p>Contents of an example PgBouncer HBA file named <code>hba_bouncer.conf</code>:</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>local       all     bouncer             trust</span></span>
<span class="line"><span>host        all     bouncer      127.0.0.1/32       trust</span></span></code></pre></div><p>Example excerpt from the related <code>pgbouncer.ini</code> configuration file:</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>[databases]</span></span>
<span class="line"><span>p0 = port=15432 host=127.0.0.1 dbname=p0 user=bouncer pool_size=2</span></span>
<span class="line"><span>p1 = port=15432 host=127.0.0.1 dbname=p1 user=bouncer</span></span>
<span class="line"><span>...</span></span>
<span class="line"><span></span></span>
<span class="line"><span>[pgbouncer]</span></span>
<span class="line"><span>...</span></span>
<span class="line"><span>auth_type = hba</span></span>
<span class="line"><span>auth_file = userlist.txt</span></span>
<span class="line"><span>auth_hba_file = hba_bouncer.conf</span></span>
<span class="line"><span>...</span></span></code></pre></div><p>Refer to the <a href="https://pgbouncer.github.io/config.html#hba-file-format" target="_blank" rel="noreferrer">HBA file format</a> discussion in the PgBouncer documentation for information about PgBouncer support of the HBA authentication file format.</p><h3 id="configuring-ldap-based-authentication-for-pgbouncer" tabindex="-1"><a id="pgb_ldap"></a>Configuring LDAP-based Authentication for PgBouncer <a class="header-anchor" href="#configuring-ldap-based-authentication-for-pgbouncer" aria-label="Permalink to &quot;&lt;a id=&quot;pgb_ldap&quot;&gt;&lt;/a&gt;Configuring LDAP-based Authentication for PgBouncer&quot;">​</a></h3><p>Starting in WarehousePG version 6.22, PgBouncer supports native LDAP authentication between the <code>psql</code> client and the <code>pgbouncer</code> process. Configuring this LDAP-based authentication is similar to configuring HBA-based authentication for PgBouncer:</p><ul><li>Specify <code>auth-type=hba</code> in the <code>pgbouncer.ini</code> configuration file.</li><li>Provide the file name of an HBA-format file in the <code>auth_hba_file</code> parameter of the <code>pgbouncer.ini</code> file, and specify the LDAP parameters (server address, base DN, bind DN, bind password, search attribute, etc.) in the file.</li></ul><blockquote><p><strong>Note</strong> You may, but are not required to, specify LDAP user names and passwords in the <code>auth-file</code>. When you do <em>not</em> specify these strings in the <code>auth-file</code>, LDAP user password changes require no PgBouncer configuration changes.</p></blockquote><p>If you enable LDAP authentication between <code>psql</code> and <code>pgbouncer</code> and you use <code>md5</code>, <code>password</code>, or <code>scram-sha-256</code> for authentication between PgBouncer and WarehousePG, ensure that you configure the latter password independently.</p><p>Excerpt of an example PgBouncer HBA file named <code>hba_bouncer_for_ldap.conf</code> that specifies LDAP authentication follows:</p><div class="language-pre vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">pre</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>host all user1 0.0.0.0/0 ldap ldapserver=&lt;ldap-server-address&gt; ldapbasedn=&quot;CN=Users,DC=greenplum,DC=org&quot; ldapbinddn=&quot;CN=Administrator,CN=Users,DC=greenplum,DC=org&quot; ldapbindpasswd=&quot;ChangeMe1!!&quot; ldapsearchattribute=&quot;SomeAttrName&quot;</span></span></code></pre></div><p>Refer to the WarehousePG <a href="./../../security_guide/authentication.html#ldap_auth">LDAP Authentication</a> discussion for more information on configuring an HBA file for LDAP.</p><p>Example excerpt from the related <code>pgbouncer.ini</code> configuration file:</p><div class="language-pre vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">pre</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>[databases]</span></span>
<span class="line"><span>* = port = 6000 host=127.0.0.1</span></span>
<span class="line"><span></span></span>
<span class="line"><span>[pgbouncer]</span></span>
<span class="line"><span>listen_addr = 0.0.0.0</span></span>
<span class="line"><span>listen_port = 6432</span></span>
<span class="line"><span></span></span>
<span class="line"><span>auth_type = hba</span></span>
<span class="line"><span>auth_hba_file = hba_bouncer_for_ldap.conf</span></span>
<span class="line"><span>...</span></span></code></pre></div><h4 id="about-specifying-an-encrypted-ldap-password" tabindex="-1"><a id="pgb_ldap_encrypt_passwd"></a>About Specifying an Encrypted LDAP Password <a class="header-anchor" href="#about-specifying-an-encrypted-ldap-password" aria-label="Permalink to &quot;&lt;a id=&quot;pgb_ldap_encrypt_passwd&quot;&gt;&lt;/a&gt;About Specifying an Encrypted LDAP Password&quot;">​</a></h4><p>Starting in WarehousePG version 7.1, PgBouncer supports encrypted LDAP passwords. To utilize an encrypted LDAP password with PgBouncer, you must:</p><ul><li>Place the encrypted password in the <code>\${HOME}/.ldapbindpass</code> file.</li><li>Specify <code>ldapbindpasswd=&quot;$bindpasswd&quot;</code> in the HBA-based authentication file for PgBouncer.</li><li>Specify the file system path to the encryption key in the <code>auth_key_file</code> setting in the <code>pgbouncer.ini</code> configuration file.</li><li>Specify the encryption cipher in the <code>auth_cipher</code> setting in the <code>pgbouncer.ini</code> configuration file.</li></ul><p>The following example commands create an encrypted password and place it in <code>\${HOME}/.ldapbindpass</code>:</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span># generate a key file named ldkeyfile</span></span>
<span class="line"><span>$ openssl rand -base64 256 | tr -d &#39;\\n&#39; &gt; ldkeyfile</span></span>
<span class="line"><span># encrypt the password</span></span>
<span class="line"><span>$ encrypted_passwd=$(echo -n &quot;your_secret_password_here&quot; | openssl enc -aes-256-cbc -base64 -md sha256 -pass file:ldkeyfile</span></span>
<span class="line"><span># copy the encrypted password to required location</span></span>
<span class="line"><span>$ echo -n $encrypted_passwd &gt; &quot;\${HOME}/.ldapbindpass&quot;</span></span></code></pre></div><p>An excerpt of an example PgBouncer HBA file named <code>hba_bouncer_with_ldap_encrypted.conf</code> that specifies LDAP authentication with an encrypted password follows:</p><div class="language-pre vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">pre</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>host all user2 0.0.0.0/0 ldap ldapserver=&lt;ldap-server-address&gt; ldapbindpasswd=&quot;$bindpasswd&quot; ldapbasedn=&quot;CN=Users,DC=greenplum,DC=org&quot; ldapbinddn=&quot;CN=Administrator,CN=Users,DC=greenplum,DC=org&quot; ldapsearchattribute=&quot;SomeAttrName&quot;</span></span></code></pre></div><p>Example excerpt from the related <code>pgbouncer.ini</code> configuration file:</p><div class="language-pre vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">pre</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>[databases]</span></span>
<span class="line"><span>* = port = 6000 host=127.0.0.1</span></span>
<span class="line"><span>[pgbouncer]</span></span>
<span class="line"><span>listen_addr = 0.0.0.0</span></span>
<span class="line"><span>listen_port = 6432</span></span>
<span class="line"><span>auth_type = hba</span></span>
<span class="line"><span>auth_hba_file = hba_bouncer_with_ldap_encrypted.conf</span></span>
<span class="line"><span>auth_key_file = /home/user2/ldkeyfile</span></span>
<span class="line"><span>auth_cipher = -aes-128-ecb</span></span>
<span class="line"><span>...</span></span></code></pre></div><h2 id="starting-pgbouncer" tabindex="-1"><a id="pgb_start"></a>Starting PgBouncer <a class="header-anchor" href="#starting-pgbouncer" aria-label="Permalink to &quot;&lt;a id=&quot;pgb_start&quot;&gt;&lt;/a&gt;Starting PgBouncer&quot;">​</a></h2><p>You can run PgBouncer on the WarehousePG coordinator or on another server. If you install PgBouncer on a separate server, you can easily switch clients to the standby coordinator by updating the PgBouncer configuration file and reloading the configuration using the PgBouncer Administration Console.</p><p>Follow these steps to set up PgBouncer.</p><ol><li><p>Create a PgBouncer configuration file. For example, add the following text to a file named <code>pgbouncer.ini</code>:</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>[databases]</span></span>
<span class="line"><span>postgres = host=127.0.0.1 port=5432 dbname=postgres</span></span>
<span class="line"><span>pgb_mydb = host=127.0.0.1 port=5432 dbname=mydb</span></span>
<span class="line"><span></span></span>
<span class="line"><span>[pgbouncer]</span></span>
<span class="line"><span>pool_mode = session</span></span>
<span class="line"><span>listen_port = 6543</span></span>
<span class="line"><span>listen_addr = 127.0.0.1</span></span>
<span class="line"><span>auth_type = md5</span></span>
<span class="line"><span>auth_file = users.txt</span></span>
<span class="line"><span>logfile = pgbouncer.log</span></span>
<span class="line"><span>pidfile = pgbouncer.pid</span></span>
<span class="line"><span>admin_users = gpadmin</span></span></code></pre></div><p>The file lists databases and their connection details. The file also configures the PgBouncer instance. Refer to the <a href="./../../utility_guide/ref/pgbouncer-ini.html">pgbouncer.ini</a> reference page for information about the format and content of a PgBouncer configuration file.</p></li><li><p>Create an authentication file. The filename should be the name you specified for the <code>auth_file</code> parameter of the <code>pgbouncer.ini</code> file, <code>users.txt</code>. Each line contains a user name and password. The format of the password string matches the <code>auth_type</code> you configured in the PgBouncer configuration file. If the <code>auth_type</code> parameter is <code>plain</code>, the password string is a clear text password, for example:</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>&quot;gpadmin&quot; &quot;gpadmin1234&quot;</span></span></code></pre></div><p>If the <code>auth_type</code> in the following example is <code>md5</code>, the authentication field must be MD5-encoded. The format for an MD5-encoded password is:</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>&quot;md5&quot; + MD5_encoded(&lt;password&gt;&lt;username&gt;)</span></span></code></pre></div></li><li><p>Launch <code>pgbouncer</code>:</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>$ $GPHOME/bin/pgbouncer -d pgbouncer.ini</span></span></code></pre></div><p>The <code>-d</code> option runs PgBouncer as a background (daemon) process. Refer to the <a href="./../../utility_guide/ref/pgbouncer.html">pgbouncer</a> reference page for the <code>pgbouncer</code> command syntax and options.</p></li><li><p>Update your client applications to connect to <code>pgbouncer</code> instead of directly to WarehousePG server. For example, to connect to the WarehousePG named <code>mydb</code> configured above, run <code>psql</code> as follows:</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>$ psql -p 6543 -U someuser pgb_mydb</span></span></code></pre></div><p>The <code>-p</code> option value is the <code>listen_port</code> that you configured for the PgBouncer instance.</p></li></ol><h2 id="managing-pgbouncer" tabindex="-1"><a id="topic_manage"></a>Managing PgBouncer <a class="header-anchor" href="#managing-pgbouncer" aria-label="Permalink to &quot;&lt;a id=&quot;topic_manage&quot;&gt;&lt;/a&gt;Managing PgBouncer&quot;">​</a></h2><p>PgBouncer provides a <code>psql</code>-like administration console. You log in to the PgBouncer Administration Console by specifying the PgBouncer port number and a virtual database named <code>pgbouncer</code>. The console accepts SQL-like commands that you can use to monitor, reconfigure, and manage PgBouncer.</p><p>For complete documentation of PgBouncer Administration Console commands, refer to the <a href="./../../utility_guide/ref/pgbouncer-admin.html">pgbouncer-admin</a> command reference.</p><p>Follow these steps to get started with the PgBouncer Administration Console.</p><ol><li><p>Use <code>psql</code> to log in to the <code>pgbouncer</code> virtual database:</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>$ psql -p 6543 -U username pgbouncer</span></span></code></pre></div><p>The username that you specify must be listed in the <code>admin_users</code> parameter in the <code>pgbouncer.ini</code> configuration file. You can also log in to the PgBouncer Administration Console with the current Unix username if the <code>pgbouncer</code> process is running under that user&#39;s UID.</p></li><li><p>To view the available PgBouncer Administration Console commands, run the <code>SHOW help</code> command:</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>pgbouncer=# SHOW help;</span></span>
<span class="line"><span>NOTICE:  Console usage</span></span>
<span class="line"><span>DETAIL:</span></span>
<span class="line"><span>    SHOW HELP|CONFIG|DATABASES|FDS|POOLS|CLIENTS|SERVERS|SOCKETS|LISTS|VERSION|...</span></span>
<span class="line"><span>    SET key = arg</span></span>
<span class="line"><span>    RELOAD</span></span>
<span class="line"><span>    PAUSE</span></span>
<span class="line"><span>    SUSPEND</span></span>
<span class="line"><span>    RESUME</span></span>
<span class="line"><span>    SHUTDOWN</span></span>
<span class="line"><span>    [...]</span></span></code></pre></div></li><li><p>If you update PgBouncer configuration by editing the <code>pgbouncer.ini</code> configuration file, you use the <code>RELOAD</code> command to reload the file:</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>pgbouncer=# RELOAD;</span></span></code></pre></div></li></ol><h3 id="mapping-pgbouncer-clients-to-warehousepg-server-connections" tabindex="-1"><a id="mapbouncclient"></a>Mapping PgBouncer Clients to WarehousePG Server Connections <a class="header-anchor" href="#mapping-pgbouncer-clients-to-warehousepg-server-connections" aria-label="Permalink to &quot;&lt;a id=&quot;mapbouncclient&quot;&gt;&lt;/a&gt;Mapping PgBouncer Clients to WarehousePG Server Connections&quot;">​</a></h3><p>To map a PgBouncer client to a WarehousePG server connection, use the PgBouncer Administration Console <code>SHOW CLIENTS</code> and <code>SHOW SERVERS</code> commands:</p><ol><li>Use <code>ptr</code> and <code>link</code> to map the local client connection to the server connection.</li><li>Use the <code>addr</code> and the <code>port</code> of the client connection to identify the TCP connection from the client.</li><li>Use <code>local_addr</code> and <code>local_port</code> to identify the TCP connection to the server.</li></ol>`,79)]))}const g=n(t,[["render",i]]);export{h as __pageData,g as default};

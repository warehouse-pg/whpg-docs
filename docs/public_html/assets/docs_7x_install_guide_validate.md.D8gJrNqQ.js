import{_ as t,c as a,o as s,ag as i}from"./chunks/framework.Ds6Eueu6.js";const u=JSON.parse('{"title":"Validating the WHPG Cluster","description":"","frontmatter":{},"headers":[],"relativePath":"docs/7x/install_guide/validate.md","filePath":"docs/7x/install_guide/validate.md"}'),r={name:"docs/7x/install_guide/validate.md"};function o(n,e,d,l,h,p){return s(),a("div",null,e[0]||(e[0]=[i(`<h1 id="validating-the-whpg-cluster" tabindex="-1">Validating the WHPG Cluster <a class="header-anchor" href="#validating-the-whpg-cluster" aria-label="Permalink to &quot;Validating the WHPG Cluster&quot;">​</a></h1><hr><p>Validate your hardware and network performance.</p><p>WarehousePG provides a management utility called <a href="./../utility_guide/ref/gpcheckperf.html">gpcheckperf</a>, which can be used to identify hardware and system-level issues on the machines in your WarehousePG cluster. <a href="./../utility_guide/ref/gpcheckperf.html">gpcheckperf</a> starts a session on the specified hosts and runs the following performance tests:</p><ul><li>Network Performance (<code>gpnetbench*</code>)</li><li>Disk I/O Performance (<code>dd</code> test)</li><li>Memory Bandwidth (<code>stream</code> test)</li></ul><p>Before using <code>gpcheckperf</code>, you must have a trusted host setup between the hosts involved in the performance test. You can use the utility <a href="./../utility_guide/ref/gpssh-exkeys.html">gpssh-exkeys</a> to update the known host files and exchange public keys between hosts if you have not done so already. Note that <code>gpcheckperf</code> calls to <a href="./../utility_guide/ref/gpssh.html">gpssh</a> and <a href="./../utility_guide/ref/gpsync.html">gpsync</a>, so these WarehousePG utilities must be in your <code>$PATH</code>.</p><ul><li><p><strong><a href="./validate.html">Validating Network Performance</a></strong></p></li><li><p><strong><a href="./validate.html">Validating Disk I/O and Memory Bandwidth</a></strong></p></li></ul><p><strong>Parent topic:</strong> <a href="./install_guide/">Installing and Upgrading WarehousePG</a></p><h2 id="validating-network-performance" tabindex="-1"><a id="topic4"></a>Validating Network Performance <a class="header-anchor" href="#validating-network-performance" aria-label="Permalink to &quot;&lt;a id=&quot;topic4&quot;&gt;&lt;/a&gt;Validating Network Performance&quot;">​</a></h2><p>To test network performance, run <a href="./../utility_guide/ref/gpcheckperf.html">gpcheckperf</a> with one of the network test run options: parallel pair test (<code>-r N</code>), serial pair test (<code>-r n</code>), or full matrix test (<code>-r M</code>). The utility runs a network benchmark program that transfers a 5 second stream of data from the current host to each remote host included in the test. By default, the data is transferred in parallel to each remote host and the minimum, maximum, average and median network transfer rates are reported in megabytes (MB) per second. If the summary transfer rate is slower than expected (less than 100 MB/s), you can run the network test serially using the <code>-r n</code> option to obtain per-host results. To run a full-matrix bandwidth test, you can specify <code>-r M</code> which will cause every host to send and receive data from every other host specified. This test is best used to validate if the switch fabric can tolerate a full-matrix workload.</p><p>Most systems in a WarehousePG cluster are configured with multiple network interface cards (NICs), each NIC on its own subnet. When testing network performance, it is important to test each subnet individually. For example, considering the following network configuration of two NICs per host:</p><table tabindex="0"><thead><tr><th>WarehousePG Host</th><th>Subnet1 NICs</th><th>Subnet2 NICs</th></tr></thead><tbody><tr><td>Segment 1</td><td>sdw1-1</td><td>sdw1-2</td></tr><tr><td>Segment 2</td><td>sdw2-1</td><td>sdw2-2</td></tr><tr><td>Segment 3</td><td>sdw3-1</td><td>sdw3-2</td></tr></tbody></table><p>You would create four distinct host files for use with the <a href="./../utility_guide/ref/gpcheckperf.html">gpcheckperf</a> network test:</p><table tabindex="0"><thead><tr><th>hostfile_gpchecknet_ic1</th><th>hostfile_gpchecknet_ic2</th></tr></thead><tbody><tr><td>sdw1-1</td><td>sdw1-2</td></tr><tr><td>sdw2-1</td><td>sdw2-2</td></tr><tr><td>sdw3-1</td><td>sdw3-2</td></tr></tbody></table><p>You would then run <a href="./../utility_guide/ref/gpcheckperf.html">gpcheckperf</a> once per subnet. For example (if testing an <em>even</em> number of hosts, run in parallel pairs test mode):</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>$ gpcheckperf -f hostfile_gpchecknet_ic1 -r N -d /tmp &gt; subnet1.out</span></span>
<span class="line"><span>$ gpcheckperf -f hostfile_gpchecknet_ic2 -r N -d /tmp &gt; subnet2.out</span></span></code></pre></div><p>If you have an <em>odd</em> number of hosts to test, you can run in serial test mode (<code>-r n</code>).</p><p><strong>Parent topic:</strong> <a href="./validate.html">Validating the WHPG Cluster</a></p><h2 id="validating-disk-i-o-and-memory-bandwidth" tabindex="-1"><a id="topic5"></a>Validating Disk I/O and Memory Bandwidth <a class="header-anchor" href="#validating-disk-i-o-and-memory-bandwidth" aria-label="Permalink to &quot;&lt;a id=&quot;topic5&quot;&gt;&lt;/a&gt;Validating Disk I/O and Memory Bandwidth&quot;">​</a></h2><p>To test disk and memory bandwidth performance, run <a href="./../utility_guide/ref/gpcheckperf.html">gpcheckperf</a> with the disk and stream test run options (<code>-r ds</code>). The disk test uses the <code>dd</code> command (a standard UNIX utility) to test the sequential throughput performance of a logical disk or file system. The memory test uses the STREAM benchmark program to measure sustainable memory bandwidth. Results are reported in MB per second (MB/s).</p><h3 id="to-run-the-disk-and-stream-tests" tabindex="-1"><a id="jj161569"></a>To run the disk and stream tests <a class="header-anchor" href="#to-run-the-disk-and-stream-tests" aria-label="Permalink to &quot;&lt;a id=&quot;jj161569&quot;&gt;&lt;/a&gt;To run the disk and stream tests&quot;">​</a></h3><ol><li><p>Log in on the coordinator host as the <code>gpadmin</code> user.</p></li><li><p>Source the <code>greenplum_path.sh</code> path file from your WarehousePG installation. For example:</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>$ source /usr/local/greenplum-db/greenplum_path.sh</span></span></code></pre></div></li><li><p>Create a host file named <code>hostfile_gpcheckperf</code> that has one host name per segment host. Do not include the coordinator host. For example:</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>sdw1</span></span>
<span class="line"><span>sdw2</span></span>
<span class="line"><span>sdw3</span></span>
<span class="line"><span>sdw4</span></span></code></pre></div></li><li><p>Run the <code>gpcheckperf</code> utility using the <code>hostfile_gpcheckperf</code> file you just created. Use the <code>-d</code> option to specify the file systems you want to test on each host (you must have write access to these directories). You will want to test all primary and mirror segment data directory locations. For example:</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>$ gpcheckperf -f hostfile_gpcheckperf -r ds -D \\</span></span>
<span class="line"><span>  -d /data1/primary -d  /data2/primary \\</span></span>
<span class="line"><span>  -d /data1/mirror -d  /data2/mirror</span></span></code></pre></div></li><li><p>The utility may take a while to perform the tests as it is copying very large files between the hosts. When it is finished you will see the summary results for the Disk Write, Disk Read, and Stream tests.</p></li></ol><p><strong>Parent topic:</strong> <a href="./validate.html">Validating the WHPG Cluster</a></p>`,23)]))}const m=t(r,[["render",o]]);export{u as __pageData,m as default};
